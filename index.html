
<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>The Island Programming Language</title>
	<meta name="description" content="Multiparadigm general-purpose programming language, fusing aspects of functional, imperative, object-oriented, and various forms of declarative programming.">
	<meta name="author" content="Rotem Dan">

	<!-- Favicon is courstey of freepik.com -->
	<link rel="shortcut icon" href="icons/oasis-32x32.png" />
	<link rel="stylesheet" href="styles/main.css">
</head>

<body>
<main id="main-content">
<h1 id="top-heading">The <span id="top-heading-island-word">Island</span> Programming Language</h1>
<h2 id="top-subheading">Designed by Rotem Dan</h2>
<h2 id="top-subheading-2">(Work In Progress)</h2>
<p><strong>Island</strong> (originally standing for <strong>I</strong>mmutable, <strong>s</strong>equentia<strong>l</strong> <strong>a</strong>nd <strong>n</strong>on-<strong>d</strong>estructive) is a multiparadigm general-purpose programming language fusing aspects of functional, imperative and  object-oriented programming, as well as incorporating various forms of declarative programming (logic, pattern-driven and knowledge-driven).</p>
<p>It aspires to eventually serve as a practical programming tool for real-world applications, and designed with a strong emphasis on simplicity, clarity and aesthetics.</p>
<p>The core of the language is characterized by a sequential, statement-oriented style. However, the language cannot be formally classified as imperative (it has <strong>no mutable state</strong>), nor as truly functional (it does not promote an idiomatically functional style), or traditionally object-oriented. Instead, it represents a conceptually independent programming approach named <strong>stateless-sequential programming</strong>.</p>
<p>The language also embeds a statically-typed <strong>logic programming subsystem</strong>, that significantly deviates from the Prolog tradition - which mostly concentrates on the centrality of relations - and instead encourages tight interconnections between relations, functions and objects as complementary entities.</p>
<p>A new form of declarative programming, called <strong>knowledge-driven programming</strong>, is introduced. It is currently a part of an ongoing experimental design process and may eventually become fully assimilated into the core of the language, or branch out to a separate, future one, once it becomes sufficiently mature.</p>
<nav class="table-of-contents"><ol><li><a href="#introduction">Introduction</a><ol><li><a href="#design-philosophy">Design philosophy</a></li><li><a href="#main-innovations">Main innovations</a></li><li><a href="#technical-goals-and-constraints">Technical goals and constraints</a></li><li><a href="#syntactic-standards">Syntactic standards</a></li><li><a href="#implementation-state">Implementation state</a></li></ol></li><li><a href="#fundamentals">Fundamentals</a><ol><li><a href="#variables-and-assignment">Variables and assignment</a></li><li><a href="#variable-scoping">Variable scoping</a></li><li><a href="#deferred-initialization">Deferred initialization</a></li><li><a href="#primitive-data-types">Primitive data types</a></li><li><a href="#collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets">Collection types: lists, tuples, dictionaries and sets</a></li><li><a href="#unpacking">Unpacking</a></li></ol></li><li><a href="#subroutines">Subroutines</a><ol><li><a href="#functions-and-predicates">Functions and predicates</a></li><li><a href="#actions">Actions</a></li><li><a href="#computed-variables">Computed variables</a></li><li><a href="#named-and-default-arguments">Named and default arguments</a></li><li><a href="#first-class-methods-and-lexical-closures">First-class methods and lexical closures</a></li><li><a href="#anonymous-methods">Anonymous methods</a></li><li><a href="#single-parameter-anonymous-function-syntax">Single parameter anonymous function syntax</a></li><li><a href="#method-overloading">Method overloading</a></li><li><a href="#function-and-action-types">Function and action types</a></li><li><a href="#rest-parameters">Rest parameters</a></li><li><a href="#arguments-collection">Arguments collection</a></li><li><a href="#partial-application">Partial application</a></li><li><a href="#abstract-method-types">Abstract method types</a></li><li><a href="#strong-and-weak-side-effect-scopes">Strong and weak side-effect scopes</a></li></ol></li><li><a href="#control-flow">Control flow</a><ol><li><a href="#conditionals">Conditionals</a></li><li><a href="#pattern-matching">Pattern matching</a></li><li><a href="#matched-parameters">Matched parameters</a></li><li><a href="#exhaustiveness-checking">Exhaustiveness checking</a></li><li><a href="#single-pattern-matching">Single pattern matching</a></li><li><a href="#loops">Loops</a></li><li><a href="#shorthand-with-expressions-in-continue-and-break-statements">Shorthand with expressions in continue and break statements</a></li></ol></li><li><a href="#streams">Streams</a><ol><li><a href="#stream-methods">Stream methods</a></li><li><a href="#accumulative-streams-and-named-return-variables">Accumulative streams and named return variables</a></li><li><a href="#list-comprehensions">List comprehensions</a></li><li><a href="#stream-comprehensions">Stream comprehensions</a></li><li><a href="#query-comprehensions">Query comprehensions</a></li><li><a href="#for-loops-as-methods">For-loops as methods</a></li></ol></li><li><a href="#compound-and-polymorphic-data-types">Compound and polymorphic data types</a><ol><li><a href="#classes-and-objects">Classes and objects</a></li><li><a href="#extension">Extension</a></li><li><a href="#features">Features</a></li><li><a href="#anonymous-structures">Anonymous structures</a></li><li><a href="#type-companion-objects">Type companion objects</a></li><li><a href="#type-features">Type features</a></li><li><a href="#expansion">Expansion</a></li><li><a href="#generics">Generics</a></li><li><a href="#polymorphic-subtyping-rules-(covariance-and-contravariance)">Polymorphic subtyping rules (covariance and contravariance)</a></li><li><a href="#fixed-fields-and-partially-constructed-objects">Fixed fields and partially constructed objects</a></li></ol></li><li><a href="#concurrency%2C-parallelism-and-lazy-evaluation">Concurrency, parallelism and lazy evaluation</a><ol><li><a href="#computed-variables-and-values">Computed variables and values</a></li><li><a href="#concurrent-and-parallel-execution-with-the-spawn-keyword">Concurrent and parallel execution with the spawn keyword</a></li><li><a href="#automatic-parallelization-via-implicit-spawning">Automatic parallelization via implicit spawning</a></li><li><a href="#delegates-and-structured-effect-concurrency">Delegates and structured effect concurrency</a></li></ol></li><li><a href="#contracts">Contracts</a><ol><li><a href="#contracts-1">Contracts</a></li></ol></li><li><a href="#type-abstractions">Type abstractions</a><ol><li><a href="#refinement-and-assertion-types">Refinement and assertion types</a></li><li><a href="#type-aliases">Type aliases</a></li><li><a href="#choice-types">Choice types</a></li><li><a href="#variant-types">Variant types</a></li><li><a href="#enumerations">Enumerations</a></li><li><a href="#the-nothing-type-and-the-%3F-operator">The nothing type and the ? operator</a></li><li><a href="#the-any-type">The any type</a></li><li><a href="#the-never-type">The never type</a></li><li><a href="#join-types">Join types</a></li><li><a href="#member-and-parameter-type-references">Member and parameter type references</a></li><li><a href="#higher-kinded-features">Higher-kinded features</a></li></ol></li><li><a href="#exception-handling">Exception handling</a><ol><li><a href="#failure-types">Failure types</a></li><li><a href="#returning-the-failure-type-from-a-method">Returning the failure type from a method</a></li><li><a href="#using-try..detect-(action-scopes-only)">Using try..detect (action scopes only)</a></li></ol></li><li><a href="#patterns-and-parsers">Patterns and parsers</a><ol><li><a href="#pattern-methods">Pattern methods</a></li><li><a href="#transactional-execution">Transactional execution</a></li><li><a href="#patterns-in-non-character-streams">Patterns in non-character streams</a></li><li><a href="#lookahead">Lookahead</a></li><li><a href="#abstract-and-higher-order-patterns">Abstract and higher-order patterns</a></li><li><a href="#unpacking-through-a-pattern-method">Unpacking through a pattern method</a></li><li><a href="#wrapping-pattern-expressions-in-pattern-methods">Wrapping pattern expressions in pattern methods</a></li><li><a href="#patterns-in-non-stream-inputs">Patterns in non-stream inputs</a></li></ol></li><li><a href="#logic-programming">Logic programming</a><ol><li><a href="#relations%2C-facts-and-rules">Relations, facts and rules</a></li><li><a href="#relation-predicates%2C-functions-and-streams">Relation predicates, functions and streams</a></li><li><a href="#higher-order-relations">Higher-order relations</a></li><li><a href="#immutability-and-determinism-in-the-logic-programming-subsystem">Immutability and determinism in the logic programming subsystem</a></li></ol></li><li><a href="#knowledge-driven-programming">Knowledge-driven programming</a><ol><li><a href="#introduction-1">Introduction</a></li><li><a href="#contexts%2C-properties-and-mappings">Contexts, properties and mappings</a></li><li><a href="#context-embedding">Context embedding</a></li><li><a href="#default-property-values">Default property values</a></li><li><a href="#mapping-rule-preconditions">Mapping rule preconditions</a></li><li><a href="#precondition-pattern-matching">Precondition pattern matching</a></li><li><a href="#mappers">Mappers</a></li><li><a href="#pseudo-functions">Pseudo-functions</a></li><li><a href="#recursive-instantiation-and-embedding">Recursive instantiation and embedding</a></li><li><a href="#universal-identifiers">Universal identifiers</a></li><li><a href="#semantic-links">Semantic links</a></li><li><a href="#bidirectional-mapping-rules-and-semantic-queries">Bidirectional mapping rules and semantic queries</a></li><li><a href="#semantic-roles">Semantic roles</a></li><li><a href="#roles-and-context-substitution">Roles and context substitution</a></li><li><a href="#instance-types">Instance types</a></li><li><a href="#incremental-instance-initialization">Incremental instance initialization</a></li><li><a href="#anonymous-contexts">Anonymous contexts</a></li><li><a href="#conditionally-knowable-properties">Conditionally knowable properties</a></li><li><a href="#pattern-contexts">Pattern contexts</a></li><li><a href="#anonymous-contexts-as-loop-state">Anonymous contexts as loop state</a></li><li><a href="#role-coupling-and-semantic-indexing">Role coupling and semantic indexing</a></li><li><a href="#context-expansion">Context expansion</a></li><li><a href="#stream-properties">Stream properties</a></li><li><a href="#consistency-and-contradiction-checking">Consistency and contradiction checking</a></li><li><a href="#unit-testing">Unit testing</a></li><li><a href="#reactive-contexts">Reactive contexts</a></li><li><a href="#eli5%3A-illustrative-%22magic-room%22-analogies">ELI5: Illustrative &quot;magic room&quot; analogies</a><ol><li><a href="#contexts%2C-properties-and-mapping-rules">Contexts, properties and mapping rules</a></li><li><a href="#embedded-context">Embedded context</a></li><li><a href="#recursively-embedded-context">Recursively embedded context</a></li><li><a href="#semantic-links-1">Semantic links</a></li><li><a href="#semantic-roles-1">Semantic roles</a></li><li><a href="#semantic-query">Semantic query</a></li><li><a href="#role-coupling-and-semantic-indexing-1">Role coupling and semantic indexing</a></li><li><a href="#anonymous-context">Anonymous context</a></li><li><a href="#context-expansion-1">Context expansion</a></li><li><a href="#invalid-context-instantiation">Invalid context instantiation</a></li><li><a href="#contradictory-mapping-rules">Contradictory mapping rules</a></li></ol></li></ol></li><li><a href="#misc.-topics">Misc. topics</a><ol><li><a href="#lists-and-streams-as-array-index-specifiers">Lists and streams as array index specifiers</a></li><li><a href="#recursion-sugar-and-the-param-modifier">Recursion sugar and the param modifier</a></li><li><a href="#deep-comparison">Deep comparison</a></li></ol></li><li><a href="#design-decisions-still-under-consideration">Design decisions still under consideration</a><ol><li><a href="#syntax-i-would-like-to-improve">Syntax I would like to improve</a></li><li><a href="#built-in-types">Built-in types</a></li></ol></li><li><a href="#todo">TODO</a><ol><li><a href="#namespaces">Namespaces</a></li><li><a href="#modules">Modules</a></li><li><a href="#attributes">Attributes</a></li><li><a href="#infix-operators">Infix operators</a></li><li><a href="#metaprogramming-and-reflection">Metaprogramming and reflection</a></li><li><a href="#symbolic-data-structures">Symbolic data structures</a></li><li><a href="#memoization">Memoization</a></li><li><a href="#compile-time-execution">Compile-time execution</a></li></ol></li><li><a href="#closing-chapter">Closing chapter</a><ol><li><a href="#influences">Influences</a></li><li><a href="#feedback-for-this-document">Feedback for this document</a></li><li><a href="#who-wrote-this%3F">Who wrote this?</a></li><li><a href="#copyrights">Copyrights</a></li></ol></li></ol></nav><section>
<h1 id="introduction">Introduction <a class="header-anchor" href="#introduction">§</a></h1>
<section>
<h2 id="design-philosophy">Design philosophy <a class="header-anchor" href="#design-philosophy">§</a></h2>
<ul>
<li><strong>Programming should be made accessible to every person who wishes to learn it</strong>. A language designer's role is to try to make the language as friendly and approachable as possible. This doesn't mean that powerful abstractions like generics, higher order methods, or other advanced features should be avoided. Instead, try to make the core of the language beginner-friendly, and more advanced features as transparent and unobtrusive as possible, such that users could gradually become familiar with more and more of them as they develop their skills.</li>
<li><strong>A programming language doesn't have to look like math or logic formulas</strong>. The vast majority of real-world programming tasks have weak, if any, resemblance to abstract mathematics. Most programmers would benefit more from comprehensive, domain-specific language features that simplify common tasks, than minimalistic, math-like syntax that is possibly &quot;mathematically beautiful&quot; but either very difficult to understand or becomes unusably complicated even when confronted with routine real-world problems.</li>
<li>Many <strong>common programming traps can be prevented right at the design stage</strong>, either by stricter syntax and semantics, or better tooling and documentation. It is a part of the designer's responsibility to ensure that their language doesn't invite trivial mistakes that frustrate programmers and waste their time.</li>
<li>Many <strong>mundane programming tasks can already be made partially, or fully automated</strong>, or for the very least, drastically simplified. Machine-learning based tools like <a href="https://copilot.github.com/">GitHub Copilot</a> are extremely powerful. However, a significant portion of their contribution is to introduce boilerplate or cut-and-paste code that might be better avoided or replaced with unambiguous, universal semantic references that would enable safe and convenient code reuse, of the kind proposed on the <a href="#universal-identifiers">chapter discussing knowledge-driven programming</a>.</li>
<li>For the most part, <strong>a programming language should be fully designed</strong> before it reaches a full implementation stage. Spend as much time as needed at the design stage (even years, if that's what it takes). Try to cover all possible aspects, including advanced features, until the design matures into a coherent whole.</li>
<li><strong>A programming language is a work of art!</strong> It can be made aesthetically pleasing and enjoyable to use. That doesn't mean this objective is going to be easy to achieve. Beauty requires effort!</li>
</ul>
</section>
<section>
<h2 id="main-innovations">Main innovations <a class="header-anchor" href="#main-innovations">§</a></h2>
<ul>
<li><strong><a href="#loops">Stateless loops</a></strong> (or alternatively <strong>structured loops</strong>) are an approach to iterative control flow that attempts to unify the best of both the imperative and functional idioms. Stateless loops are written in a sequential style but are bound by a strict structure that ensures they can be trivially reduced to tail-recursive functional iteration.</li>
<li><strong><a href="#accumulative-streams-and-named-return-variables">Accumulative generators</a></strong>, as well as <strong>accumulative generator comprehensions</strong> enhance the declarative expressiveness of the language by abstracting over the notion of the &quot;prior&quot; output of a generator. <strong>Named return variables</strong> provide a safe and restricted form of mutability by enabling the return value to be &quot;accumulated&quot; in a write-only fashion, analogous to an accumulative generator.</li>
<li><strong><a href="#fixed-fields-and-partially-constructed-objects">Partial and gradually constructed objects</a></strong> enable the instantiation of classes with one or more missing fields, such that some of the object's functionality becomes inaccessible. The language models this &quot;partial&quot; instantiation through special types that explicitly specify which of its fields are known and which are not.</li>
<li><strong><a href="#patterns-and-parsers">Abstract pattern recognizers</a></strong> are special methods that provide means to specify the recognition and capture of patterns that go well beyond the capabilities of the built-in expression syntax, as well as traditional regular expressions. They can capture arbitrary patterns within any type of input, and be written as polymorphic or higher-order abstractions.</li>
<li><strong><a href="#logic-programming">Class-embedded relations</a></strong> enable logic-programming style relations to be encapsulated within immutable container objects. Relations can be defined using a diverse mixture of programming approaches: rules, predicates, functions and generators.</li>
<li><strong><a href="#knowledge-driven-programming">Knowledge-driven programming</a></strong> is a form of declarative programming where information entities are given precise semantics via universally referenceable schemas, and computations are synthesized at compile-time, by composing chains of inference rules that derive unknown information entities from known ones.</li>
</ul>
</section>
<section>
<h2 id="technical-goals-and-constraints">Technical goals and constraints <a class="header-anchor" href="#technical-goals-and-constraints">§</a></h2>
<ul>
<li><strong>All variables and values should be strictly immutable</strong>. I.e. both variables (locally and globally scoped) and values (primitive and compound objects, including any of their fields) must maintain their initially assigned value, forever.</li>
<li>Adapt common imperative constructs like loops, objects and generators, while maintaining strict adherence to full immutability.</li>
<li>Maintain a strict separation between pure and effect scopes (<code>function</code> vs <code>action</code>).</li>
<li>Types should be inferred whenever possible. Most programs should include only a few explicit type annotations.</li>
<li>Allow for strong static analysis (static and strong typing, advanced type inference, flow analysis, generics and type classes, non-nullable, algebraic, refinement and assertion types, compile-time contracts).</li>
<li>Allow for easy and effective concurrency (lightweight threads, asynchronous generators, automatic parallelization, structured concurrency).</li>
</ul>
</section>
<section>
<h2 id="syntactic-standards">Syntactic standards <a class="header-anchor" href="#syntactic-standards">§</a></h2>
<ul>
<li>Maintain a look-and-feel that's not completely &quot;alien&quot;-looking for the average programmer. It should loosely resemble popular imperative languages like Python, TypeScript and C#.</li>
<li>Aim for maximum simplicity and readability (great syntax does make a difference!). Aim for low-ambiguity, consistent syntax that reads somewhat like plain English (but don't overdo it for its own sake).</li>
<li>Clean syntax: avoid employing unnecessary punctuation like <code>;</code>, <code>:</code>, <code>{</code>, <code>}</code>, <code>(</code>, <code>)</code> and cryptic-looking symbols like <code>$</code>, <code>*</code>, <code>&amp;</code>, <code>#</code>, <code>^</code> etc. Instead, prefer short words like <code>and</code>, <code>or</code>, <code>it</code>, <code>here</code> whenever appropriate.</li>
<li>No noisy double character operators like <code>++</code>, <code>&amp;&amp;</code>, <code>$$</code>, <code>!!</code>, they make the code look too cryptic.</li>
<li>No abbreviated keywords like <code>fun</code> instead of <code>function</code>, <code>int</code> instead of <code>integer</code> etc. These abbreviations don't save that much on typing and many users find them confusing or alienating.</li>
<li>Keywords should be carefully named: what does <code>def</code> mean in Python? <code>cons</code> in Haskell? Even worse: <code>car</code> and <code>cdl</code> in LISP? Put extra effort to find the best possible term that most closely matches the semantics of what it is intended to represent.</li>
<li>Always provide a way to name things: parameters, methods, types, return values, etc. A scalable language aimed towards professional programming tasks <em>must</em> provide naming facilities. It is not an option. Without naming it'd be mostly a &quot;toy&quot; language suitable only for small-to-medium projects.</li>
<li>No unnecessary extra keywords or characters for the programmer to write, like <code>then</code> after <code>if</code> in Pascal, <code>where</code> after <code>class</code> in Haskell, colons (<code>:</code>) to signal a block start in Python, <code>end</code> to end blocks in many languages.</li>
<li>Try to keep consistent locality relationships between clauses and symbols. Orientational metaphors like &quot;data flows from the left to the right&quot; should be respected as much as possible.</li>
<li>Expressive, rather than minimalist, syntax. Don't be afraid to introduce new special keywords if deemed necessary (use context-sensitive awareness to allow identifier names to be used even if they conflict with a keyword that's reserved elsewhere).</li>
</ul>
</section>
<section>
<h2 id="implementation-state">Implementation state <a class="header-anchor" href="#implementation-state">§</a></h2>
<p>The language is currently at an early, design-only stage. A basic parser and compiler have been developed, mostly for the purpose of validating a limited subset of its features (in particular its parsing complexity and the practical efficiency of its looping constructs).</p>
</section>
</section>
<section>
<h1 id="fundamentals">Fundamentals <a class="header-anchor" href="#fundamentals">§</a></h1>
<section>
<h2 id="variables-and-assignment">Variables and assignment <a class="header-anchor" href="#variables-and-assignment">§</a></h2>
<p>Variables are defined using the <code>let</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Types will be inferred using the values provided, but can also be annotated explicitly:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p><strong>Variables can only be assigned once</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span></span>
<span class="line"><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: invalid reassignment of &#39;x&#39;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="variable-scoping">Variable scoping <a class="header-anchor" href="#variable-scoping">§</a></h2>
<p>Variables are accessible from within both their declared scope and any of its nested scopes:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Variables redeclared using an existing name in an inner scope will shadow the ones in the outer scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;Hi&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;Hello&quot;</span></span>
<span class="line"></span></code></pre>
<p>Newly declared variable reusing an existing name will replace the previous one if redeclared in the same scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// This is permitted since the previous binding of &#39;greeting&#39; is not reachable anymore:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;Hi&quot;</span></span>
<span class="line"></span></code></pre>
<p>Shadowing and redeclared variables must receive a type consistent with the previous one:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: shadowing inner variable must be of same type as outer variable</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">25</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: redeclared variable must be of same type as its previous binding</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="deferred-initialization">Deferred initialization <a class="header-anchor" href="#deferred-initialization">§</a></h2>
<p>Initialization can be deferred to a later code position, as long as all branches assign a value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>If a type is not specified, it would be automatically inferred as long as the assigned values share the same underlying type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Type inferred as string</span></span>
<span class="line"></span></code></pre>
<p>This would not work:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> greeting</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">24</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: incompatible types</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="primitive-data-types">Primitive data types <a class="header-anchor" href="#primitive-data-types">§</a></h2>
<p>Island is a <strong>statically typed</strong> language, meaning that every one of its values must be associated with a type that can be determined at compile-time.</p>
<p>Island has a few primitive data types:</p>
<ul>
<li><code>integer</code>: arbitrary precision integer number.</li>
<li><code>decimal</code>: real number (64-bit floating-point).</li>
<li><code>boolean</code>: Boolean value (<code>true</code> or <code>false</code>).</li>
<li><code>string</code>: Unicode character sequence.</li>
</ul>
</section>
<section>
<h2 id="collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets">Collection types: lists, tuples, dictionaries and sets <a class="header-anchor" href="#collection-types%3A-lists%2C-tuples%2C-dictionaries-and-sets">§</a></h2>
<p><strong>Lists</strong> are ordered collections of values, in which every element has the same type. They are defined within square brackets and have 1-based indexes:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numbers: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> listOfLists: List&lt;List&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [[</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">], [</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">e</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">], [</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">f</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">]]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> m1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> numbers[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// m1 is 2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> m2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> listOfLists[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// m2 is &quot;b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Two ways of defining empty lists:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptyList: List&lt;Integer&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptyList </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> List&lt;Integer&gt; []</span></span>
<span class="line"></span></code></pre>
<p>Lists can be extended and concatenated using the concatenation operator <code>|</code> , or a spread expression (<code>[...someList, valueToAppend]</code>, <code>[...someList, ...SomeOtherList]</code>):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// l3 is [3, 4, 5, 6]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> l2  </span><span style="color: #A1A1A1">// l4 is [1, 2, 3, 4, 5, 6]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">11</span><span style="color: #5B5B5B">, ...l1] </span><span style="color: #A1A1A1">// l5 is [10, 11, 1, 2]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l6 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...l5, </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l6 is [10, 11, 1, 2, 100]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l7 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...l1, ...l2] </span><span style="color: #A1A1A1">// l7 is [1, 2, 3, 4, 5, 6]</span></span>
<span class="line"></span></code></pre>
<p>List members can be non-destructively altered using the <code>with</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// l2 is [99, 200, 300, 400]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l2 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">] </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]  </span><span style="color: #A1A1A1">// l3 is [99, 201, 299]</span></span>
<span class="line"></span></code></pre>
<p><code>with</code> expressions can be nested in concatenations or spread expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">500</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l1 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l2 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">600</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// l3 is [90, 200, 900, 400, 500, 600]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [...</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l3 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">], [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, </span><span style="color: #000000">-</span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l4 is [800, 900, 400, 500, 600, -200, 300]</span></span>
<span class="line"></span></code></pre>
<p>Lists can be sliced:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">400</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l2 is [200, 300, 400]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">..] </span><span style="color: #A1A1A1">// l3 is [300, 400]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> l1[..</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// l3 is [100, 200]</span></span>
<span class="line"></span></code></pre>
<p><strong>Tuples</strong> are ordered collections of fixed length in which each member may have a different type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myTuple: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myTuple </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">42</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// myTuple is (&quot;Hi&quot;, 42)</span></span>
<span class="line"></span></code></pre>
<p>Tuple members can be named:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myTuple: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, someNumber: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myTuple </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> someNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">42</span></span>
<span class="line"></span></code></pre>
<p>Island doesn't support 1 or 0 arity tuples:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;x&#39; gets the plain type &#39;integer&#39;`, there&#39;s no single member tuple in Island</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// syntax error, &#39;()&#39; doesn&#39;t mean anything in Island</span></span>
<span class="line"></span></code></pre>
<p><strong>Dictionaries</strong> are unordered collections where keys and values can be of any type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> fruits: Dictionary&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">55</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">lemon</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">95</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> : </span><span style="color: #E65C00">31</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">banana</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> fruitValue </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits[</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// fruitValue = 31</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> isFound1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> fruits </span><span style="color: #A1A1A1">// isFound1 = true</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> isFound2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">avocado</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> fruits </span><span style="color: #A1A1A1">// isFound2 = false</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredFruits2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Equivalent to previous</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> extendedFruits1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">76</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> extendedFruits2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> ...alteredFruits, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">76</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Same but with spread syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Two ways of defining empty dictionaries:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptyDictionary: Dictionary&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{}</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptyDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">{}</span></span>
<span class="line"></span></code></pre>
<p><strong>Sets</strong> are unordered collections containing only unique elements:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> fruits: Set&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">lemon</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">banana</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> fruitValue </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits[</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// fruitValue = true</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> isFound1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> fruits </span><span style="color: #A1A1A1">// isFound1 = true</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> isFound2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">avocado</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> fruits </span><span style="color: #A1A1A1">// isFound2 = false</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">berries</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// no need for { } here</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredFruits2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fruits </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">berries</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">orange</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Equivalent to previous</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> extendedFruits1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> alteredFruits </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> extendedFruits2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> ...alteredFruits, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">mango</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Same but with spread syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Two ways of defining empty sets:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptySet: Set&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{}</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> emptySet </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Set&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">{}</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="unpacking">Unpacking <a class="header-anchor" href="#unpacking">§</a></h2>
<p><strong>Unpacking</strong> (also called <strong>destructuring</strong> in other languages) allows extracting elements from data structures into individual variables:</p>
<p>Unpack a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getList</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> [n1, n2, n3, n4] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getList</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// n1 = 1, n2 = 2, n3 = 3, n4 = 4</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> [x1, x2, ...] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getList</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// n1 = 1, x2 = 2</span></span>
<span class="line"></span></code></pre>
<p>Unpack a tuple:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a, b, c</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// a = 1, b = 2, c = 3</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, _, z</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// x = 1, z = 3</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getTuple</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">  </span><span style="color: #A1A1A1">// n = 1</span></span>
<span class="line"></span></code></pre>
<p>Objects (introduced in a future chapter) are unpacked based on the order of declared members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">25</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f, _, a</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person </span><span style="color: #A1A1A1">// f = &quot;John&quot;, a = 25</span></span>
<span class="line"></span></code></pre>
<p>Lists allow for some additional unpacking patterns:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> values </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Capture head and tail of a list:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> [head, ...tail] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// head = 1, tail = [2, 3, 4, 5]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Capture first, second, and all the rest elements of the list:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> [first, second, ...rest] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// first = 1, second = 2, rest = [3, 4, 5]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Capture first and last elements:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> [firstElement, ..., lastElement] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values </span><span style="color: #A1A1A1">// firstElement = 1, lastElement = 5</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="subroutines">Subroutines <a class="header-anchor" href="#subroutines">§</a></h1>
<p>The Island language has two main subroutine types: functions and actions.</p>
<section>
<h2 id="functions-and-predicates">Functions and predicates <a class="header-anchor" href="#functions-and-predicates">§</a></h2>
<p><strong>Functions</strong> are &quot;pure&quot;, in the sense they do not have side effects (no hidden change of state) and maintain referential transparency (given the same set of arguments, they would always return the same value).</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> sum2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// Short syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> sum3</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, z: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Long syntax</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> z</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> sum3</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Result: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">result</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>A <strong>predicate</strong> is an alternate syntax for a function that returns either <code>true</code> of <code>false</code>. Using <code>predicate</code> instead of <code>function</code> simply ensures the return type will always be <code>boolean</code>.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> areEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// Short syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> areEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Long syntax</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="actions">Actions <a class="header-anchor" href="#actions">§</a></h2>
<p><strong>Actions</strong> extend functions and allow for <em>external</em> effects. Actions can return values but can only be called from other actions (or the topmost scope):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">name: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, age: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Name: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, Age: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> status </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Smith</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">35</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// Prints &quot;Name: John Smith, Age: 35&quot; and returns &quot;OK&quot;</span></span>
<span class="line"></span></code></pre>
<p>Despite allowing for &quot;impure&quot; operations like writing or reading from a file, actions do not allow for side-effects <em>internal</em> to the program itself, since all variables and values are always guaranteed to be immutable. This doesn't prevent, however, mutable state to be weakly &quot;emulated&quot; through, say, reading and writing to external memory:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; readFile</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">myFile.state</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> writeMutableState</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">data: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	writeFile</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">myFile.state</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, data</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> initialData </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">writeMutableState</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">initialData </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631"> changed!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B">ifiedData </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readMutableState</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>The program can read and write to external mutable state. However, the modified data must be read into a new variable (here <code>modifiedData</code>) so the <em>internal</em> state of the program (its variables and values) is never altered.</p>
</section>
<section>
<h2 id="computed-variables">Computed variables <a class="header-anchor" href="#computed-variables">§</a></h2>
<p><strong>Computed variables</strong> are functions that are referenced as if they were plain variables. They are only evaluated when first used:</p>
<p>Short form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> c </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> b </span><span style="color: #A1A1A1">// computed variable &#39;c&#39; is not evaluated at this point</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> c </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;c&#39; is now evaluated to 15 and &#39;x&#39; gets the value 16</span></span>
<span class="line"></span></code></pre>
<p>Long, function like, form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">computed</span><span style="color: #5B5B5B"> c</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> a1 </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> a2</span></span>
<span class="line"></span></code></pre>
<p>We will often collectively refer to functions, actions, and computed variables (and later include class computed fields and indexers) as <strong>methods</strong>, which is just another name for subroutines.</p>
</section>
<section>
<h2 id="named-and-default-arguments">Named and default arguments <a class="header-anchor" href="#named-and-default-arguments">§</a></h2>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printNameAndAge</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Name: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, Age: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">printNameAndAge</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints Name: Anonymous, Age: 12</span></span>
<span class="line"><span style="color: #5B5B5B">printNameAndAge</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">_, </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints Name: Anonymous, Age: 12</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="first-class-methods-and-lexical-closures">First-class methods and lexical closures <a class="header-anchor" href="#first-class-methods-and-lexical-closures">§</a></h2>
<p><strong>First-class methods</strong> is a language feature allowing functions (and actions) to be used similarly to values. They can be assigned to variables, returned from a secondary method, or passed as an argument:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// This function accepts an argument of type &#39;function&#39;</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span></code></pre>
<p>A <strong>lexical closure</strong> allows a method to capture data from its environment:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// This function returns a value of type &#39;function&#39;</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> outerFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> innerFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// x is captured from the outer scope</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> innerFunction</span></span>
<span class="line"></span></code></pre>
<p>In general, a function accepting another function as argument is called a <strong>higher-order function</strong>.</p>
</section>
<section>
<h2 id="anonymous-methods">Anonymous methods <a class="header-anchor" href="#anonymous-methods">§</a></h2>
<p><strong>Anonymous methods</strong>, also known as <strong>lambda expressions</strong> are functions or actions that are defined as expressions and are not bound to any identifier.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sum2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, n2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n2 </span><span style="color: #A1A1A1">// Explicit parameter types</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sum2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n1, n2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n2 </span><span style="color: #A1A1A1">// Implicit parameter types</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> negative </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #5B5B5B">n </span><span style="color: #A1A1A1">// Single explicitly typed parameter</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> negative </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #5B5B5B">n </span><span style="color: #A1A1A1">// Single implicitly typed parameter</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Since &#39;print&#39; is an action &#39;printInQuotes&#39; implicitly becomes a action as well</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> printInQuotes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">&#39;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">s</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">&#39;</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="single-parameter-anonymous-function-syntax">Single parameter anonymous function syntax <a class="header-anchor" href="#single-parameter-anonymous-function-syntax">§</a></h2>
<p>Consider this higher-order function that accepts a list of integers and a single-parameter predicate:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> findFirst</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, selectionPredicate: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>Instead of passing a full anonymous predicate as an argument, e.g.:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> findFirst</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">numbers, number </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; number &gt; </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>The predicate can be shortened to a simpler expression where the <code>it</code> keyword represents its parameter value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> findFirst</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">numbers, </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>The same can be done for a function expecting a function accepting any type parameter, as long as there is only one:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> transform</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, transformer: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> doubledNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> transform</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">numbers, x </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Function call can be simplified to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> doubledNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> transform</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">numbers, </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>In general, any expression involving the <code>it</code> keyword, that's assigned to a placeholder where expected type is a single-parameter function, would be interpreted as an anonymous function (the <code>it</code> keyword is also employed for pattern matching, as we'll see in a future chapter, but the two applications are distinct).</p>
</section>
<section>
<h2 id="method-overloading">Method overloading <a class="header-anchor" href="#method-overloading">§</a></h2>
<p><strong>Overloading</strong> allows defining multiple methods sharing the same name, but with different parameter types.</p>
<p>Methods can be overloaded:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">a</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">b</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> a</span></span>
<span class="line"></span></code></pre>
<p>Overloads can only differ by parameter types, not return types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error</span></span>
<span class="line"></span></code></pre>
<p>Overloaded methods can be compacted to a shorter form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> f</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">a</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">b</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> a</span></span>
<span class="line"></span></code></pre>
<p><em>(The usefulness of this syntax will become more apparent when refinement and assertion types are introduced in a later chapter, stay tuned!)</em></p>
</section>
<section>
<h2 id="function-and-action-types">Function and action types <a class="header-anchor" href="#function-and-action-types">§</a></h2>
<p>Function and action types can be written in several ways:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Short form (unnamed parameters):</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a: </span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Long form (named parameters):</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> f: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, isUnique: </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a: </span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">message: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="rest-parameters">Rest parameters <a class="header-anchor" href="#rest-parameters">§</a></h2>
<p>A method's last parameter, typed as a list, can be prefixed with <code>...</code> to accept all remaining arguments as its members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> sum</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">...numbers: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	numbers.reduce</span><span style="color: #B43AFF">((</span><span style="color: #5B5B5B">sum, number</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; sum </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> number</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> sum</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 = 17</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">multiplier: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, ...numbers: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	numbers.map</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; number </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> multiplier</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r2 = [10, 20, 30, 40, 50]</span></span>
<span class="line"></span></code></pre>
<p>It is also possible to explicitly pass a list to a rest parameter, using <code>...</code> as a suffix instead of a prefix:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">multiplier, ...numbers: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	numbers.map</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; number </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> multiplier</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> multiplyAllBy</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, nums...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r2 = [10, 20, 30, 40, 50]</span></span>
<span class="line"></span></code></pre>
<p>Sometimes it is more convenient to pass arguments bundled together as a tuple. This is possible by applying the <code>...</code> prefix on the tuple passed, and would work even for methods that don't include a rest parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, c: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a, b, c</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> average1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">nums...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// pass nums tuple elements to parameters a, b, c</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> average2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> averageOf3</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, nums[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">]...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// pass nums tuple elements 2..3 to parameters b, c</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="arguments-collection">Arguments collection <a class="header-anchor" href="#arguments-collection">§</a></h2>
<p>The <code>arguments</code> keywords allows getting a tuple bundling all the arguments passed to the current method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printArguments</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">arguments</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">printArguments</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;(1, 4, 5)&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="partial-application">Partial application <a class="header-anchor" href="#partial-application">§</a></h2>
<p>Partial application allows to transform a given method to a new method with one or more of its arguments bound to fixed values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">c</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printTwoNumbers</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// print5AndTwoNumbers has the signature print5AndTwoNumbers(b: integer, c: integer)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print5AndTwoNumbers</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">, </span><span style="color: #000000">-</span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;5 9 -3&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> print5And3AndNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printTwoNumbers</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// print5And3AndNumber has the signature print5And3AndNumber(c: integer)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print5And3AndNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;5 3 1&quot;</span></span>
<span class="line"></span></code></pre>
<p>The <code>with</code> operator can be used to partially apply any subset of parameters, regardless of their declared order:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> partiallyAppliedAction </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">11</span></span>
<span class="line"><span style="color: #A1A1A1">// partiallyAppliedAction has the signature partiallyAppliedAction(a: integer, c: integer)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">partiallyAppliedAction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, c </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">8</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 4, 11, 8</span></span>
<span class="line"><span style="color: #5B5B5B">partiallyAppliedAction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">c </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">6</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: an argument for &#39;a&#39; must be specified</span></span>
<span class="line"></span></code></pre>
<p>Methods may be partially applied any number of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> partiallyAppliedAction2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> partiallyAppliedAction </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">94</span></span>
<span class="line"><span style="color: #A1A1A1">// partiallyAppliedAction2 has the signature partiallyAppliedAction2(c: integer)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">partiallyAppliedAction2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">c </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 94, 11, -4</span></span>
<span class="line"></span></code></pre>
<p>If the target method has multiple overloads, the overload can be disambiguated by including a tuple containing the selected types for the unspecified members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, c: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">c</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, c: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">b.roundToDecimals</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">c.roundToDecimals</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! Ambiguous call. There are two matching overloads!</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> print5AndTwoNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printThreeNumbers</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// OK</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="abstract-method-types">Abstract method types <a class="header-anchor" href="#abstract-method-types">§</a></h2>
<p>The <code>(param1: ParamType, param2: ParamType, ...) =&gt; ReturnType</code> syntax defines abstract method types. An identifier holding a method of this type cannot be directly invoked, only passed around or partially applied:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> PartialIntFunc </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> applyFirstArgument</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f: PartialIntFunc, value: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: PartialIntFunc</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> f</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> sum</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> partiallyAppliedSum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> applyFirstArgument</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sum, </span><span style="color: #E65C00">11</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// Type of partiallyAppliedSum is (b: integer) =&gt; integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">partiallyAppliedSum</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 13</span></span>
<span class="line"></span></code></pre>
<p>In the above example <code>(integer, ...) =&gt; integer</code> represents a function having any number of parameters where the first parameter must be compatible with <code>integer</code> and the return type must be compatible with <code>integer</code>.</p>
<p>Other abstract function type examples:</p>
<ul>
<li><code>(...) =&gt; any</code> represents a function of any number of parameters returning a value of any type other than <code>nothing</code> (the <code>any</code> type is described in detail in a following chapter).</li>
<li><code>(...) =&gt; any?</code> represents a function of any number of parameters returning a value of any type, including <code>nothing</code>.</li>
<li><code>(string, _, integer, _) =&gt; any?</code> represents a function of four parameters where the first parameter must be of type <code>string</code> and third of type integer, and any return type (including <code>nothing</code>).</li>
</ul>
<p><em>Note that due to contravariance of function parameters (described in a future chapter), a function including a parameter of type <code>any?</code>, e.g <code>(any?) =&gt; integer</code> is not assignable from a function of type <code>(T) =&gt; integer</code> where <code>T != any?</code>. Unlike <code>any?</code>, the <code>_</code> type represents a type that is both a super-type of all types and a subtype of all types, so it can substitute for every possible parameter type)</em>.</p>
</section>
<section>
<h2 id="strong-and-weak-side-effect-scopes">Strong and weak side-effect scopes <a class="header-anchor" href="#strong-and-weak-side-effect-scopes">§</a></h2>
<p>Up until now, we've made a clear distinction between &quot;pure&quot; and &quot;side-effect&quot; scopes. Functions encompass purely deterministic computations. Actions, on the other hand, allow for external interaction (I/O, file reads and writes) as well as unpredictable operations (e.g. random number generators, timers etc.).</p>
<p>We can refine the distinction further to distinguish between two main classes of side-effects:</p>
<ol>
<li>Operations inducing clear impact on the external environment. e.g. writing to a file, moving a robot arm, displaying information on the monitor etc.</li>
<li>Operations that only observe or query information from the larger computing environment (e.g. reading an open file or screen pixel data) as well as operations that are unpredictable by nature (measuring time, reading data from a hardware random number generator etc).</li>
</ol>
<p>We can roughly classify the first class as &quot;strong&quot;, since they clearly impact the system and the user at large. The second class could be described as &quot;weak&quot; in the sense that it doesn't actually &quot;do&quot; anything - they pose no &quot;risk&quot; aside from requiring a minor amount of computing resources.</p>
<p>The Island language provides an optional way to explicitly mark those weaker scopes, albeit these are open to the developers' own judgment to be marked as such:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">view action</span><span style="color: #5B5B5B"> getCurrentTime</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p><code>view</code> actions can only call other view actions, as well as functions. They cannot call regular (strong) actions.</p>
</section>
</section>
<section>
<h1 id="control-flow">Control flow <a class="header-anchor" href="#control-flow">§</a></h1>
<section>
<h2 id="conditionals">Conditionals <a class="header-anchor" href="#conditionals">§</a></h2>
<p>The traditional <strong><code>if</code> - <code>else if</code> - <code>else</code></strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> num &lt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"></span></code></pre>
<p>The similar, but more declarative <strong><code>when </code>-<code> otherwise</code></strong> syntax, uses <code>=&gt;</code> to directly return a value from an enclosing method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">   </span><span style="color: #A1A1A1">// Equivalent to &#39;if num == 0 ..&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num </span><span style="color: #A1A1A1">// Equivalent to &#39;else if num &lt; 0 ..&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num     </span><span style="color: #A1A1A1">// Equivalent to &#39;else ..&#39;</span></span>
<span class="line"></span></code></pre>
<p>The most important differences between <code>when</code>-<code>otherwise</code> and <code>if</code>-<code>else if</code>-<code>else</code> are:</p>
<ul>
<li>It can only be used in <code>function</code> (pure computation) contexts.</li>
<li>It must be the only conditional in its enclosing function (surrounding <code>let</code> statements, nested functions and type alias declarations are permitted).</li>
<li>It must include an <code>otherwise</code> clause, or provably exhaust all cases (for more, see a following chapter about exhaustiveness checking).</li>
</ul>
<p><code>when</code>-<code>otherwise</code> clauses can be nested any number of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> nestedWhenExample</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &lt; </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">hey</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">yo</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">no</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">bye</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p><code>when</code>-<code>otherwise</code> can also be written as an expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> abs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: num, </span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num, </span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> gcd</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">: gcd</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b, a </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> b</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>This function uses a structure and a <code>when</code> statement block to convert an integer number on the range <code>1..999</code> to words:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> numToWords</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">999</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numberNames </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">one</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">two</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">three</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">four</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">five</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">6</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">six</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">seven</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">8</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">eight</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">nine</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">ten</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">11</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">eleven</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">thirteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">13</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">thirteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">14</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">fourteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">15</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">fifteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">sixteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">17</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">seventeen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">eighteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">nineteen</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">twenty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">thirty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">fourty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">fifty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">sixty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">seventy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">eighty</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">ninety</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num &lt; </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		numberNames[num]</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> num &lt; </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B43AFF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">div</span><span style="color: #AA6631"> </span><span style="color: #E65C00">10</span><span style="color: #B43AFF">)}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B43AFF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">mod</span><span style="color: #AA6631"> </span><span style="color: #E65C00">10</span><span style="color: #B43AFF">)}</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">.trimWhitespace</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B43AFF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">div</span><span style="color: #AA6631"> </span><span style="color: #E65C00">100</span><span style="color: #B43AFF">)}</span><span style="color: #AA6631"> hundered </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">numToWords</span><span style="color: #B43AFF">(</span><span style="color: #AA6631">num </span><span style="color: #000000">mod</span><span style="color: #AA6631"> </span><span style="color: #E65C00">100</span><span style="color: #B43AFF">)}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">.trimWhitespace</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="pattern-matching">Pattern matching <a class="header-anchor" href="#pattern-matching">§</a></h2>
<p><strong>Pattern matching</strong> is a form of a conditional which inspects one or more target values and their internal component parts. The <code>match</code>-<code>case</code> syntax expands over the traditional <code>switch</code>-<code>case</code> with more expressive control:</p>
<p><em>(<code>it</code> represents the target value, which is <code>num</code> in this example)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// (long statement form)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> abs1</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// (short statement form, &#39;=&gt;&#39; returns a value from the enclosing method)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> abs2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// (expression form)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> absOfVal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> num:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #5B5B5B">num,</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num</span></span>
<span class="line"></span></code></pre>
<p>Match a tuple:
<em>(<code>any</code> matches any value, <code>here</code> contextually matches the corresponding element of the target tuple <code>someTuple</code>)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> tupleMatch</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">someTuple: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">))</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> someTuple</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 1</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &lt; </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B">.length &gt; </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 2</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">O</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 3</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B43AFF">((</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B">    </span><span style="color: #A1A1A1">// returns &quot;Case 1&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B43AFF">((</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns &quot;Case 2&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B43AFF">((</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns &quot;Case 3&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchTuple</span><span style="color: #B43AFF">((</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">OK</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B">  </span><span style="color: #A1A1A1">// returns &quot;No match&quot;</span></span>
<span class="line"></span></code></pre>
<p>Matched elements can be nested, and can be captured using the <code>let</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> nestedTupleMatch</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">someNestedTuple: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)))</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> someNestedTuple</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> name</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 1, </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> num, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 2, </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">num</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Matching over an object (as well as a tuple with named members) introduces its members into the <code>case</code> scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">person: Person</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> person</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> lastName.length &gt; </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 1</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> firstName[</span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">e</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">35</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Case 2</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">No match</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Redd</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns &quot;Case 1&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">33</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns &quot;Case 2&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> matchObject</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">new</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">37</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns &quot;No match&quot;</span></span>
<span class="line"></span></code></pre>
<p>In case the concrete type of the target object may be one of several derived types, the <strong>type can be matched</strong> as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> owner.firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>A secondary syntax uses curly brackets to define a matching structure, which can be nested any amount of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, owner: </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>A third, terser matching syntax uses constructor-like notation, based on the order of declared members (note the varying count of elements in parentheses and the <code>...</code> element signifying the rest of the elements are ignored):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog, Andy!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">180</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p><code>match</code> can be applied to multiple variables, separated by commas:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Animal, person: Person</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal, person</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, Man </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> happinessLevel &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Matching on multiple Boolean expressions allows to concisely specify a decision table:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> hasPromotions</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">repeatCustomer: </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">, hasMemberCard: </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">, orderAmount: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> repeatCustomer, hasMemberCard, orderAmount </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, orderAmount </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1000</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> , </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> , </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B"> , </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">05</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B"> , </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">  </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">10</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">                     </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">freeShipping: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, discountPercent: </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p><code>match</code> cases can be <strong>nested</strong> without needing to introduce a new <code>match</code> declaration. The nested <code>case</code> clauses receive the enclosing match target value, as well as any type or conditional assertions that were made by its ancestors:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimal</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Animal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> barkingLoudness &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Quite dog lucky!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> barkingLoudness &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">7</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Loud dog lucky!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nice dog lucky!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> likesMilk </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nice cat!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">A cat who doesn&#39;t like milk! Who knew?</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Matching over a list allows for the unpacking syntax to be used as a matching pattern:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchList</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">myList: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> myList</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if &#39;myList&#39; is empty</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match first element only if it is smaller than 10 and capture it</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// with the identifier &#39;head&#39;:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> head &lt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element equals 25 and capture the last element as &#39;last&#39;:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, ..., </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> last]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element is greater or equal to 10. Capture the tail</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// of the list with the identifier &#39;tail&#39;:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> ...tail]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Match if first element smaller than 0, second not equals to first,</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// capture them and the rest with the identifers &#39;first&#39;, &#39;second&#39;, &#39;rest&#39;:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> first &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> ...rest]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Find the first member of the list that&#39;s greater than 5:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [..., </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> v &gt; </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...]</span></span>
<span class="line"></span></code></pre>
<p>Using similar syntax, list-typed method parameters can be pattern-matched as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> minimumValue</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[]: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, currentMinimum: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; currentMinimum</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[head, ...tail]: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, currentMinimum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		minimumValue</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">tail, minimum</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">head, currentMinimum</span><span style="color: #B43AFF">))</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="matched-parameters">Matched parameters <a class="header-anchor" href="#matched-parameters">§</a></h2>
<p>Many examples in the previous section had the form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> funcName</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">param1: ...., param2: ....</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> paramX, ....</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"></span></code></pre>
<p>If the outermost scope of a method consists only of a <code>match</code> statement (excluding any <code>let</code>s, nested method or type declarations), the <code>match paramX, ....</code> statement can be omitted and instead integrate directly into the function declaration, by modifying the matched parameters with the <code>match</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal: Animal, </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> person: Person</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, Man </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> happinessLevel &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nothing interesting here</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Observing the above carefully, it may be noticed the <code>: Animal</code> and <code>: Person</code> annotations are not strictly necessary, since the parameter types are being explicitly asserted at every case clause. When this is the case, the type annotations can be omitted and would be inferred by the compiler:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> animal, </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> person</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, Man </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good dog and young man!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Cat </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, Woman </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> happinessLevel &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Old cat and happy woman!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">, Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall horse and a true horseriding lover!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Invalid match argument types!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Note the &#39;otherwise&#39; clause must fail for the parameter types to be properly inferred!</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">//</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Having a non-failing &#39;otherwise&#39; clause would mean that the function</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// could possibly accept any type for &#39;animal&#39; and &#39;person&#39; and still succeed!</span></span>
<span class="line"></span></code></pre>
<p>The <code>matchAnimalAndPerson</code> function type is inferred to include several overloads, corresponding to each valid type combination case. Variants with and without assertion types (introduced in a later chapter) are shown:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Without assertion types, the compiler infers:</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Dog, person: Man</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Cat, person: Woman</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Horse, person: Person</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// With assertion types, the compiler infers:</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Dog </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lucky</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">							  person: Man </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Cat </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &gt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">							  person: Woman </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> happinessLevel &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchAnimalAndPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">animal: Horse </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height &gt; </span><span style="color: #E65C00">180</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">							  person: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> hobby </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Horseriding</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Even without the <code>match</code> modifier, parameter types can still be omitted and asserted in the method body using the <code>is</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> testXY</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x &gt; y </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x &lt; y </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x &gt; y </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x &gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x &lt; y </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// (The omitted &#39;otherwise&#39; clauses are interpreted as fail cases)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Inferred signature:</span></span>
<span class="line"><span style="color: #A1A1A1">// function testXY(x: integer, y: integer)</span></span>
<span class="line"><span style="color: #A1A1A1">// function testXY(x: integer, y: decimal)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="exhaustiveness-checking">Exhaustiveness checking <a class="header-anchor" href="#exhaustiveness-checking">§</a></h2>
<p>The compiler will try to ensure that matched cases include all possible values for a type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> notExhaustive</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">someBoolean: </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> someBoolean</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">OK!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Error! No handling of the case when someBoolean == false</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="single-pattern-matching">Single pattern matching <a class="header-anchor" href="#single-pattern-matching">§</a></h2>
<p>Sometimes it may be useful to match a value against a single pattern. The <code>matches</code> operator allows that:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstTwoElementsAreConsecutive</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	values </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> first, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, ...]</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="loops">Loops <a class="header-anchor" href="#loops">§</a></h2>
<p><strong>Loops</strong> are control flow mechanisms for specifying code to be executed repeatedly.</p>
<p>In Island, <strong>loops are rooted in functional iteration patterns</strong> and describe iterative progression in a more declarative manner than in traditional sequential languages.</p>
<p>Island's <code>for</code> loops maintain immutability for all variables within the scope of <strong>each individual iteration</strong> of the loop.</p>
<p>This is achieved by:</p>
<ul>
<li>Requiring all alterable variables to be declared at the head of the loop.</li>
<li>Requiring all variable alterations to be conducted within a <code>continue</code> or <code>break</code> statement, or within the loop's <code>advance</code> clause.</li>
<li>Requiring variables exposed to the outer scope (after the loop has finished) to be declared with the <code>out</code> modifier.</li>
</ul>
<p>Here's the factorial operation, implemented using a <code>for</code> loop:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"><span style="color: #5B5B5B">		 	</span><span style="color: #A1A1A1">// The continue statement defines the next values of &#39;result&#39; and &#39;i&#39;:</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i, i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span></code></pre>
<p>It may seem, at first, like <code>i</code> and <code>result</code> are no different than mutable variables, since they are repeatedly modified at every iteration, however, they are not actually mutable because they are not real variables!</p>
<p>Since Island loops act a lot like functions, <code>i</code> and <code>result</code> could be thought as being analogous to a function parameter and a return variable. Since the <code>continue</code> statement is only executed at the moment the loop is ready to proceed to its next iteration, it can be seen as if the loop is &quot;restarting&quot; with a different initial state. This is analogous to a function being repeatedly tail-recursively invoked with a different set of arguments.</p>
<p>For comparison, here is equivalent code, translated to a tail-recursive function (reference code lines are in the comments):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for i = 1, out result = 1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// if i &lt;= num</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// continue result = result * i, i = i + 1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i, i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// (implicitly returns)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// return result</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> iterationResult </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterationResult</span></span>
<span class="line"></span></code></pre>
<p>The <code>for</code> loop syntax also allows to define a continuation condition using a <code>while</code> clause and a set of predefined alterations using an <code>advance</code> clause, which are applied after any alterations in a <code>continue</code> statement within the loop body. The <code>factorial</code> function can be rewritten to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// In C-style languages this would be written as:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// int result;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for (int i = 1, result = 1; i &lt;= num; i += 1)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span></code></pre>
<p>Loops can be aborted with the <code>break</code> keyword, which also allows for alterations of <code>out</code> variables:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> boundedFactorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> num </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> i &lt; </span><span style="color: #E65C00">100</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">break</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span></code></pre>
<p>Here's a binary search implemented using a <code>for</code> loop and pattern matching, formatted to allow for better readability:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, target: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length, mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> high</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> values[mid]</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> target</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> mid</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; target</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span></code></pre>
<p>Here's equivalent code translated to a tail-recursive function (original code in comments):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, target: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// for low = 1, high = values.length, mid = (low + high) div 2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ..</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// advance mid = (low + high) div 2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length, mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// while low &lt;= high</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> high</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> values[mid]</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> target</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// return mid</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> mid</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; target</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// continue low = mid + 1</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> high</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #A1A1A1">// continue high = mid - 1</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> low, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// return nothing</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>Loops can be <strong>nested</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> row: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> row </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints [(0, 0), (0, 1), (1, 0), (1, 1)]</span></span>
<span class="line"></span></code></pre>
<p>Nested loops are also reasonably straightforward to translate to recursive form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, result: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> min, row: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; iterateY</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, row </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> row </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> max </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; iterateX</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>However, directly returning from an inner loop would be more tricky to express in recursive form. For example, the following function, which iterates to find a value in a square matrix:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> findFirstInSquareMatrix</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">matrix: List&lt;List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;&gt;, value: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> matrix[x][y] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> value</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span></code></pre>
<p>Would be roughly translated to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> findFirstInSquareMatrix</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">matrix: List&lt;List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;&gt;, value: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> matrix.length</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> matrix[x][y] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> value </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; iterateY</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> iterateY</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> result </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; result</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> x &lt; matrix.length </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; iterateX</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterateX</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>A <strong>local method may capture a variable declared within a loop body</strong>, however, such a function cannot be passed outside of the loop scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> invalidReturnedFunction</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> multiplyBy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">m: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> m </span><span style="color: #A1A1A1">// This is okay</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> multiplyBy</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This is also okay</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> localFunction </span><span style="color: #A1A1A1">// But this is invalid</span></span>
<span class="line"></span></code></pre>
<p><em>(<code>multiplyBy</code> is considered referentially transparent, if seen from within the scope of each loop iteration)</em></p>
<p>Similarly for deferred initialization:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This is invalid</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="shorthand-with-expressions-in-continue-and-break-statements">Shorthand <code>with</code> expressions in <code>continue</code> and <code>break</code> statements <a class="header-anchor" href="#shorthand-with-expressions-in-continue-and-break-statements">§</a></h2>
<p>It is common in <code>continue</code> and <code>break</code> statements to use <code>with</code> to alter one or more of the iteration variables, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, b </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Instead of writing <code>someTuple = someTuple with ...</code>, the <code>with</code> operator can be shortened to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> someTuple </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, b </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="streams">Streams <a class="header-anchor" href="#streams">§</a></h1>
<section>
<h2 id="stream-methods">Stream methods <a class="header-anchor" href="#stream-methods">§</a></h2>
<p>A <strong>stream method</strong> (also called a <strong>generator</strong>) is a form of a subroutine enabling the incremental production of a sequence of values. Calling a stream method returns a <strong>stream object</strong> (also called an <strong>iterator</strong>), which is an object allowing step-wise consumption of the values produced by the stream method.</p>
<p>Stream methods produce values using the <code>yield</code> statement. Streams can be consumed within <code>for</code> loops using the <code>x in stream</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> naturalNumbers</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> naturalNumbers</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Loops forever</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Prints 1, 2, 3, 4, 5, ....</span></span>
<span class="line"></span></code></pre>
<p><strong>Multiple streams</strong> may be consumed within a single <code>for</code> loop. At every iteration, each stream is evaluated once by its order of declaration. The loop will terminate whenever any one of the streams end:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> multiplesOfTwo</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">100</span><span style="color: #5B5B5B">, m </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> multiplesOfTwo</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will repeat 100 times</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Num: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, Multiple: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">m</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Prints:</span></span>
<span class="line"><span style="color: #A1A1A1">// &quot;Num: 1, Multiple: 2&quot;</span></span>
<span class="line"><span style="color: #A1A1A1">// &quot;Num: 2, Multiple: 4&quot;</span></span>
<span class="line"><span style="color: #A1A1A1">// &quot;Num: 3, Multiple: 6&quot;</span></span>
<span class="line"><span style="color: #A1A1A1">// ....</span></span>
<span class="line"><span style="color: #A1A1A1">// &quot;Num: 100, Multiple: 200&quot;</span></span>
<span class="line"></span></code></pre>
<p>A <strong>stream object</strong> is a stateless object, of the form:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	value: T? </span><span style="color: #A1A1A1">// The &#39;?&#39; means &#39;value&#39; may be of type &#39;nothing&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	ended: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">next</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: Stream&lt;T&gt;</span></span>
<span class="line"></span></code></pre>
<p>Calling <code>next()</code> returns a new stream object, and would cause the previous one to be disposed (any attempt to access it would cause a runtime error).</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> numsInRange</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> step0 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> numsInRange</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> step1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> step0.</span><span style="color: #0059E8">next</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// The stream requires an initial next() call to produce its first value.</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">step1.value</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> step2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> step1.</span><span style="color: #0059E8">next</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">step2.value</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints 2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">step1.value</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! step1 object has been disposed when step1.next() was called.</span></span>
<span class="line"></span></code></pre>
<p>The <code>Stream&lt;T&gt;.toList()</code> expansion method accumulates all successive elements of the stream into a list.</p>
<p>Using streams and <code>toList()</code>, a previous example - which enumerates all combinations of two integers in a given range - can now be simplified further:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> enumerateCombinations</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> enumerateCombinations</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">.toList</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>(<em>Note calling <code>toList()</code> on an infinite stream would never terminate and may rapidly consume all machine memory!</em>).</p>
<p>A stream can yield the content of another stream using <code>yield stream</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> a</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> b</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">12</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> c</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> a </span><span style="color: #A1A1A1">// no need for parentheses if stream method has no parameters</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> b</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> value </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> c</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// prints 1, 2, 3, 4, 5, 9, 10, 11, 12</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="accumulative-streams-and-named-return-variables">Accumulative streams and named return variables <a class="header-anchor" href="#accumulative-streams-and-named-return-variables">§</a></h2>
<p>Oftentimes it is useful to be able to make small, incremental alterations to a value, such as when piecing out a string, building an object, sorting a list, or calculating a complex math formula.</p>
<p>Imagine you wanted to create a function that builds a URL string from an object specifying its parts. In an imperative language, that would be easy. You could write something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	var urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// There&#39;s no &#39;var&#39; in Island - this is only meant for illustration</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> urlstring</span></span>
<span class="line"></span></code></pre>
<p>Unfortunately Island doesn't support the <code>var</code> keyword, so how could we approach this?</p>
<p>One option would be to give a different name to <code>urlstring</code> every time we want to change it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> urlstring1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> urlstring2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring1 </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> urlstring3</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring2 </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> urlstringX</span></span>
<span class="line"></span></code></pre>
<p>That looks, well, pretty bad. Couldn't we do better than that?</p>
<p>OK, so how about using an inner stream method?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">.JoinStrings</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Looks a bit better! but a solution like this will only work for simple list concatenations, we want something more flexible that would generalize over to arbitrary computations of a similar nature.</p>
<p>The general pattern seems to be that every yielded value &quot;builds&quot; over the previous one. So maybe the <code>yield</code> statement could provide a &quot;placeholder&quot; variable that would represent the previous value? something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> buildstring</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">.last</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>We'll call this an <strong>accumulative stream</strong>.</p>
<p>However, this still doesn't look pretty (frankly, even more verbose than the previous solution), we've got that nested function, and all those repeated <code>yield prior ..</code>s. Also, do we really need to yield all those intermediate results? There must be a simpler way.</p>
<p>We can take this pattern and make it more implicit by introducing the notion of a <strong>named return variable</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">urlstring: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> urlstring </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// No need to return anything, since the return variable(s) have been explicitly declared</span></span>
<span class="line"></span></code></pre>
<p>But wait a minute! you said Island didn't have <code>var</code>, and here you're using <code>urlstring</code> like it was mutable? what's going on?</p>
<p>The answer is that <code>urlstring</code> is not really mutable because it is not a real variable! It is a placeholder for a <code>yield</code> pattern representing incremental computations. The pattern:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">returnVariable </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> &lt;expression possibly including returnVariable&gt;</span></span>
<span class="line"></span></code></pre>
<p>Is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> &lt;expression possibly including </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"></span></code></pre>
<p>And:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">returnValue: T </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> initialValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> initialValue</span></span>
<span class="line"></span></code></pre>
<p>And finally, returning from the function implicitly returns the last value yielded.</p>
<p>Now we can now allow the <code>resultVariable = resultVariable | something</code> pattern to be shortened to <code>resultVariable |= something</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> urlTostring</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">url: Url</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">urlstring: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.isSecure</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">http://</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> url.hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> url.port </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">		urlstring </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">:</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">url.port</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// No need to return anything, urlstring is returned by default</span></span>
<span class="line"></span></code></pre>
<p>And here you go! looks like reasonable code.</p>
<p>Now let's try to define more precisely what exactly are the constraints on a named return variable:</p>
<p>A <strong>named return variable</strong> is a special variable that:</p>
<ul>
<li><strong>Can</strong> be reassigned multiple times, including from within conditionals and loop bodies.</li>
<li><strong>Can</strong> be passed to any method (including to an action or an object initializer).</li>
<li><strong>Can only</strong> be read from within an expression that is <strong>assigned back to itself</strong>.</li>
<li><strong>Cannot</strong> be accessed from within a nested function or action.</li>
</ul>
<p>Accumulative patterns also allow for several <strong>optimizations</strong> to take place, for example when shuffling a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> shuffle</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, seed: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">suffledValues </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..values.length, rand </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Random</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">seed</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> randIndex </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> rand.range</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, values.length</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		suffledValues </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">			[i] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues[randIndex]</span></span>
<span class="line"><span style="color: #5B5B5B">			[randIndex] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> suffledValues[i]</span></span>
<span class="line"></span></code></pre>
<p>Since <code>suffledValues</code> can only be read for the purpose of modifying itself, there is no need for the <code>with</code> operation to create a new copy of the list every time it is performed, and the intermediate results can be written in-place.</p>
<p>With a named return variable, a previous example can be made simpler:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result: List&lt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span></span>
<span class="line"><span style="color: #5B5B5B">			result </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="list-comprehensions">List comprehensions <a class="header-anchor" href="#list-comprehensions">§</a></h2>
<p><strong>List comprehensions</strong> allow building a list from <code>for</code>-like expressions.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #A1A1A1">// l = [1, 4, 9, 16, 25]</span></span>
<span class="line"></span></code></pre>
<p>A <strong>filtering predicate</strong> can also be added, using the <code>where</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #A1A1A1">// l = [4, 16]</span></span>
<span class="line"></span></code></pre>
<p><strong>Multiple streams</strong> may be consumed concurrently, and each may have a different <code>where</code> clause:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">6</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, j </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> j </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> j]</span></span>
<span class="line"><span style="color: #A1A1A1">// l = [5, 10, 15]</span></span>
<span class="line"></span></code></pre>
<p>Like in <code>for</code> loops, consuming streams of <strong>different lengths</strong> would end whenever the shorter of them ends:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">..</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, j </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">6</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i, j</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #A1A1A1">// l = [(&quot;a&quot;, 1), (&quot;b&quot;, 2), (&quot;c&quot;, 3)]</span></span>
<span class="line"></span></code></pre>
<p>Stream expressions can be <strong>nested</strong>, by successively passing the <code>=&gt;</code> symbol through multiple streams. This allows to further simplify the implementation for the combination enumeration example mentioned earlier:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	[</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> y </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> min..max</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">combinationsOf2</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints [(0, 0), (0, 1), (1, 0), (1, 1)]</span></span>
<span class="line"></span></code></pre>
<p>Similarly to <code>for</code> loops, comprehensions may introduce variables and include <code>while</code> and <code>advance</code> clauses:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sumsOfNaturalsUpTo5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, sum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> sum </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> i</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; sum] </span><span style="color: #A1A1A1">// [1, 3, 6, 10, 15]</span></span>
<span class="line"></span></code></pre>
<p>Comprehensions may be <strong>accumulative</strong>, and make use of the <code>initial</code> and <code>prior</code> keywords:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sumsOfNaturalsUpTo5 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> i]  </span><span style="color: #A1A1A1">// [1, 3, 6, 10, 15]</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="stream-comprehensions">Stream comprehensions <a class="header-anchor" href="#stream-comprehensions">§</a></h2>
<p><strong>Stream comprehensions</strong> use syntax identical to stream comprehensions, excluding the brackets, and create a stream method instead:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> squaresOfEvenNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #A1A1A1">// The type of squaresOfEvenNumbers is &#39;stream () =&gt; integer&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// (Note: since squaresOfEvenNumbers is a stream method with no parameters,</span></span>
<span class="line"><span style="color: #A1A1A1">//  the for..in syntax allows it to be optionally invoked without the parentheses &#39;()&#39;)</span></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> squaresOfEvenNumbers</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints 4, 16, 36, 64, ....</span></span>
<span class="line"></span></code></pre>
<p>Now the factorial example can be simplified to a simple two line function:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	 </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> facSequence </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"><span style="color: #5B5B5B">	 </span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> facSequence</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">.last</span></span>
<span class="line"></span></code></pre>
<p>Here's the infamous &quot;Fizz-Buzz&quot; problem implemented using a stream comprehension and a <code>when</code> expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> fizzBuzz</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, </span><span style="color: #E65C00">15</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Here's a slightly more more efficient version, this time using a match expression instead:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> fizzBuzz</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">:</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Here's a simple bounded sieve of Eratosthenes using a <code>for</code> loop and a list comprehension:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> primesTo</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">max: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..max, nonprimes: Set&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{}</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> nonprimes</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> n</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> multiplesOfN </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> &lt; max</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n]</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> nonprimes </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> multiplesOfN</span></span>
<span class="line"></span></code></pre>
<p>Wouldn't it be nice to make an infinite-length (unbounded) stream which enumerates all prime numbers? This can be achieved by, for each prime encountered, storing a stream enumerating its multiples, and at each step incrementally advancing the collected streams as needed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> primes</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Generates the integer sequence n^2, n^2 + n, n^2 + n + n, n^2 + n + n + n, ...</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> multiplesOf</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> n</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">prior</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> n</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// For n in 2..infinity</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// At each step, advance each stream until a value greater than or equal to n is reached</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #5B5B5B">, nonprimeStreams: List&lt;Stream&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> nonprimeStreams </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> s </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> nonprimeStreams</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; s.skipUntil</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> n</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Search the stream object collection for a stream that reached exactly n</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> nonprimeStreams.includes</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.value </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> n</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// If none found then n is a prime - yield it</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> n</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// Create a new (infinite-length) stream for the multiples of the prime just found</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// and append it to the collection</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> nonprimeStreams </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> multiplesOf</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>List and stream comprehensions allow to easily implement common higher-order sequence processing functions like, <code>map</code>, <code>flatMap</code>, <code>filter</code>, <code>reduce</code> and <code>zip</code>, evaluated either eagerly (through list comprehensions) or lazily (through stream comprehensions). The generality of these operations requires type parameters, which would be introduced in a future chapter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> map&lt;E, R&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStream: Stream&lt;E&gt;, transform: E </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; R</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> valueStream</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; transform</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> flatMap&lt;E, R&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStreams: Stream&lt;Stream&lt;E&gt;&gt;, transform: E </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; R</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">((</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> valueStreams</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; transform</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> filter&lt;E&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStream: Stream&lt;E&gt;, filteringPredicate: E </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> e </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> valueStream </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> filteringPredicate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">e</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; e</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> zip&lt;E1, E2&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">stream1: Stream&lt;E1&gt;, stream2: Stream&lt;E2&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> e1 </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> stream1, e2 </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> stream2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">e1, e2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> accumulate&lt;E, R&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStream: Stream&lt;E&gt;, accumulator: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">R, E</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; R, initialResult: R</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">initial</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> initialResult, e </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> valueStream</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; accumulator</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">e, </span><span style="color: #0059E8">prior</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> reduce&lt;E, R&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStream: Stream&lt;E&gt;, accumulator: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">R, E</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; R, initialResult: R</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	accumulate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">valueStream, accumulator, initialResult</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.last</span></span>
<span class="line"></span></code></pre>
<p><em>Note the use of <code>=</code> and not <code>=&gt;</code> when defining a method using a stream comprehension. Stream comprehensions are expressions that evaluate to stream methods, not values. We don't want a call to <code>map()</code> to return a method, but a stream object. Using the equals operation binds the parameters of the declared function into the comprehension, composing a new function, which returns a stream object when called.</em></p>
</section>
<section>
<h2 id="query-comprehensions">Query comprehensions <a class="header-anchor" href="#query-comprehensions">§</a></h2>
<p>Here's a simple recursive quicksort implementation using pattern matching and list comprehensions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [] </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; []</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pivot </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> items[items.length </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> leftItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> x &lt; pivot</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> rightItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> pivot</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> leftItems </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> rightItems</span></span>
<span class="line"></span></code></pre>
<p>Notice the two list comprehensions of the pattern <code>[(for x in items where &lt;some condition&gt;) =&gt; x]</code> employ a single auxiliary variable <code>x</code> only to represent the value selected by the loop. Using an abbreviated syntax, involving the <code>it</code> keyword, <code>quicksort</code> can be simplified to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [] </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; []</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pivot </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> items[items.length </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> leftItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; pivot]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> rightItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> quicksort</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> pivot]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> leftItems </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> rightItems</span></span>
<span class="line"></span></code></pre>
<p>The expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">[items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; pivot]</span></span>
<span class="line"></span></code></pre>
<p>is an example of a <strong>query comprehension</strong>, which is a simpler, but more limited form of a list or stream comprehension.</p>
<p>Let's see how it works:</p>
<p><code>items</code> is a list of integers, which can also be interpreted as a stream. The stream is then filtered by a predicate specified by a <code>where</code> clause. The predicate is written in an abbreviated form using the <code>it</code> keyword. Finally, like in stream comprehensions, the surrounding brackets indicate the resulting stream should be converted to a list.</p>
<p>It is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">items.filter</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">item </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; item &lt; pivot</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.toList</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>Or using the abbreviated <code>it</code> syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">items.filter</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; pivot</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.toList</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>Since we've now got a short and easy-to-read syntax for <code>filter</code>. Wouldn't it be nice to have one for <code>map</code> as well?</p>
<p>Say I wanted to map a list of integers to their doubled values. With a list comprehension I can write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numbersDoubled </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> numbers</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>but with a query comprehension I'll write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> numbersDoubled </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [numbers </span><span style="color: #0059E8">select</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p><code>where</code> and a <code>select</code> can be combined. This will filter for the even numbers, and then double the result:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbersDoubled </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [numbers </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">select</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>Which is equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">items.filter</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.map</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.toList</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>or</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">items.filter</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.map</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.toList</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="for-loops-as-methods">For-loops as methods <a class="header-anchor" href="#for-loops-as-methods">§</a></h2>
<p>Like comprehensions, <code>for</code>-loops can also be converted to stand-alone methods:</p>
<p>So instead of:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span></code></pre>
<p>We can write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Note the equals operator</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..num </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span></code></pre>
<p>Loop variables marked with <code>out</code> would be treated as return values. If there are more than one, they would be returned as a tuple, arranged by their order of declaration.</p>
</section>
</section>
<section>
<h1 id="compound-and-polymorphic-data-types">Compound and polymorphic data types <a class="header-anchor" href="#compound-and-polymorphic-data-types">§</a></h1>
<section>
<h2 id="classes-and-objects">Classes and objects <a class="header-anchor" href="#classes-and-objects">§</a></h2>
<p>A <strong>class</strong> is a template allowing the creation of object structures, which are also simply called <strong>objects</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Shorter syntax:</span></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, lastName: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span></code></pre>
<p>The <code>with</code> operator can be used to create a new object using the <code>Person</code> class as its template:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Williams</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, Age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">19</span></span>
<span class="line"></span></code></pre>
<p>A class may also be invoked like a constructor method, and would return a new object, whose fields receive the arguments passed to it, by their order of declaration:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Williams</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>One or more class fields may have default values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span></code></pre>
<p>In addition to fields, classes may include functions, actions, computed fields, indexers and default streams:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Fields</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Function (long syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> agePlusSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">something: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> something</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Function (short syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	agePlusSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">something: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; age </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> something</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Action (long syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Action (short syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Computed field (long syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">computed</span><span style="color: #5B5B5B"> description</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Computed field (short syntax)</span></span>
<span class="line"><span style="color: #5B5B5B">	description </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Indexer</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">[</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> index]</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; firstName</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; lastName</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Default stream</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> firstName</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> lastName</span></span>
<span class="line"></span></code></pre>
<p>Member usage examples:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> p </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Catherine</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">41</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">p.agePlusSomething</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 46</span></span>
<span class="line"><span style="color: #5B5B5B">p.printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Catherine Jones, of 41 years of age&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">p.description </span><span style="color: #A1A1A1">// returns &quot;Catherine Jones, of 41 years of age&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">p[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns &quot;Jones&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> m </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> p</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">m</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Catherine&quot; &quot;Jones&quot;</span></span>
<span class="line"></span></code></pre>
<p>A class method can use the <code>this</code> object and the <code>with</code> operator to create a altered copy of its containing object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	getOlderPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">yearsToAdd: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> yearsToAdd</span></span>
<span class="line"></span></code></pre>
<p>Alterations can be applied deeply into the object hierarchy:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Group</span></span>
<span class="line"><span style="color: #5B5B5B">	members: List&lt;Person&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	sharedInterest: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> golfers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Group </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	members </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jane</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">42</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #5B5B5B">	sharedInterest </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Golf</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> deeplyAlteredGroup </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> golfers </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	members[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">].firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Michael</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	members[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">].age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span></span>
<span class="line"></span></code></pre>
<p>The <code>with</code> operator also allows for merging syntax on objects, the following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> deeplyAlteredGroup </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> golfers </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> members: [</span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> firstName: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Michael</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">, </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> age: </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">] </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="extension">Extension <a class="header-anchor" href="#extension">§</a></h2>
<p><strong>Extension</strong> allows a new type to be built on the basis of an existing type.</p>
<p>Classes can only extend a single <strong>base class</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	height: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Shorter syntax:</span></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> height: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span></code></pre>
<p>Extending class can override one or more members of its base class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	description </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> PersonWithHeight </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	height: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	description </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">base.description</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> and </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">height</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> meters tall</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> james </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> PersonWithHeight</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Taylor</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">19</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">8</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">james.printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;James Taylor, of 19 years of age and 1.8 meters tall&quot;</span></span>
<span class="line"><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">james </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;James Taylor, of 19 years of age&quot;</span></span>
<span class="line"></span></code></pre>
<p>If a class does not provide a body to one or more of its methods, it cannot be instantiated, however it can be used as a base class to a secondary class. This kind of class is called an <strong>abstract class</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">abstract class</span><span style="color: #5B5B5B"> AbstractPerson</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">computed</span><span style="color: #5B5B5B"> description</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> ConcretePerson </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> AbstractPerson</span></span>
<span class="line"><span style="color: #5B5B5B">	description </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printDescription</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">description</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="features">Features <a class="header-anchor" href="#features">§</a></h2>
<p>A <strong>feature</strong> (roughly resembling a <strong>mixin</strong> in other languages) is an abstract class-like type specifying a set of required members. Classes may extend any number of features. A feature may optionally provide <strong>default implementations</strong> or values for its members:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	label: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> processLabeledObject</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">obj: Labeled</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	obj.printLabel</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> someEmployee </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> fullName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, label </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">abc123</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">processLabeledObject</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;abc123&quot;</span></span>
<span class="line"></span></code></pre>
<p>Note that since the <code>label</code> field doesn't have a default value it must be explicitly assigned when the object is created. However, in order to initialize a new instance of <code>Employee</code> using the constructor syntax (<code>Employee(....)</code>) the value for the <code>label</code> field must be passed using a named argument, since it doesn't have an inherent order in relation to <code>Employee</code>'s own fields:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> someEmployee </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Employee</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, label </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">abc123</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Default implementations will be overridden if they are implemented by the extending type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Employee: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">label</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">processLabeledObject</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Employee</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, label </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">abc123</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Employee: abc123&quot;</span></span>
<span class="line"></span></code></pre>
<p>If several extended features have methods with <strong>conflicting names or signatures</strong>, the overriding method declaration may specify to which feature it relates to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Runner</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Processor</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Example </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Runner, Processor</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> Runner.start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> Processor.start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>When a an method is overridden in this way, it is not possible to directly call it through the extending class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> test </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Example</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">New Example</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">test.start</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">15</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Which of the two actions should be invoked?</span></span>
<span class="line"></span></code></pre>
<p>Instead, a specific implementation can be invoked by casting the object to one of the feature types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">test </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> Processor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.start</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">15</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>When a similar conflict occurs between two or more fields, it can be resolved in an analogous way:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> FeatureA</span></span>
<span class="line"><span style="color: #5B5B5B">	index: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> FeatureB</span></span>
<span class="line"><span style="color: #5B5B5B">	index: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> ExampleClass </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> FeatureA, FeatureB</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// &#39;Example&#39; has no field named &#39;index&#39;, instead it has:</span></span>
<span class="line"><span style="color: #5B5B5B">	FeatureA.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// default value for FeatureA field</span></span>
<span class="line"><span style="color: #5B5B5B">	FeatureB.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">10</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// default value for FeatureB field</span></span>
<span class="line"></span></code></pre>
<p>Initialization must prefix the field name with the feature it relates to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> test </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> ExampleClass</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Something</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, FeatureA.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, FeatureB.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">20</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>A secondary approach is to introduce an additional field and define the two feature's fields as computed fields that &quot;route&quot; back to it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> ExampleClass </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> FeatureA, FeatureB</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	index: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	FeatureA.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; index</span></span>
<span class="line"><span style="color: #5B5B5B">	FeatureB.index </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; index.toString</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>Now the object can be instantiated normally using the constructor syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> test </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> ExampleClass</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Something</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Features may <strong>extend any number of other features</strong>. A feature may override one or more of its base feature's members. When a feature extends two or more features with conflicting member names, the resolution can be done with a similar approach to the one described above:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Runner</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Processor</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> ExampleFeature </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Runner, Processor</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> Runner.start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> Processor.start</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">speed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>In this case, this means that <code>ExampleFeature</code> doesn't have its own <code>start</code> method. Instead it  modified the default implementations for members of the features it inherited from such that a class which extends <code>ExampleFeature</code> will have different default behaviors when it is cast to <code>Runner</code> or <code>Processor</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> ExampleClass </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> ExampleFeature</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> ExampleClass</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Test</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> Runner</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.start</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">13</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// The invoked implementation of &#39;start&#39; is the one overriden by &#39;ExampleFeature&#39;,</span></span>
<span class="line"><span style="color: #A1A1A1">// not the original one specified in &#39;Runner&#39;.</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="anonymous-structures">Anonymous structures <a class="header-anchor" href="#anonymous-structures">§</a></h2>
<p>A <strong>structure</strong> is a simple object-like container, analogous to a dictionary, but with a fixed set of predefined fields and member types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myStructure </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> url: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://example.com</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, speed: </span><span style="color: #E65C00">9000</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Anonymous structure types</strong> are types that describe a set of required object fields. For example, here's a function that would accept any object-like entity with the fields <code>url: string</code> and <code>speed: integer</code></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeSomeStructure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">s: </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> url: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, speed: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">})</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeSomeStructure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">myStructure</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>An anonymous structure type is different from dictionary or a tuple with named members by the fact that it can structurally match any class or feature with compatible member names and types. This kind of subtyping may be described as a weak form of <strong>structural typing</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> SomeClass</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	url: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	weight: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> instanceOfSomeClass </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> SomeClass</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">SomeName</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">https://example.com</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">10000</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">125</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeSomeStructure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">instanceOfSomeClass</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// This call compiles since SomeClass is assignable to the anonymous structure type</span></span>
<span class="line"><span style="color: #A1A1A1">// { url: string, speed: integer }</span></span>
<span class="line"></span></code></pre>
<p><strong>Structure fields can be added and removed</strong> in an ad-hoc fashion, such that its type signature changes accordingly:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// type of s1 is { a: integer, b: boolean }</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s1 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">new</span><span style="color: #5B5B5B"> c </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// type of s2 is { a: integer, b: boolean, c: string }</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s2 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> b </span><span style="color: #A1A1A1">// type of s3 is { a: integer, c: string }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Note that if the assigned values are constants, like in the above example,</span></span>
<span class="line"><span style="color: #A1A1A1">// the inferred types will be narrowed further via refinement typing:</span></span>
<span class="line"><span style="color: #A1A1A1">// For example, the type of s1 will actually be narrowed to { a: 1, b: false }</span></span>
<span class="line"><span style="color: #A1A1A1">// where &#39;1&#39; and &#39;false&#39; are literal types.</span></span>
<span class="line"></span></code></pre>
<p>This behavior doesn't imply dynamic typing. Whenever a value is altered in this way, its new type is statically inferred during compile-time. There is no runtime type management involved.</p>
<p><strong>Structures may nest other structures</strong>. The nested structures may be similarly modified:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> c: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, d: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"><span style="color: #A1A1A1">// Type of s1 is { a: integer, b: { c: string, d: boolean } }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s1 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">new</span><span style="color: #5B5B5B"> b.e </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">14</span></span>
<span class="line"><span style="color: #A1A1A1">// Type of s2 is { a: integer, b: { c: string, d: boolean, e: decimal } }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> s2 </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> b.c</span></span>
<span class="line"><span style="color: #A1A1A1">// Type of s3 is { a: integer, b: { d: boolean, e: decimal } }</span></span>
<span class="line"></span></code></pre>
<p><strong>Structure fields may be set to computed values</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> a: </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, c </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> b </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">: a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B">: a </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span></code></pre>
<p>The computed (or &quot;lazy&quot;) nature of <code>c</code> is not reflected in the type - the type of <code>s1</code> is nonetheless inferred as <code>{ a: integer, b: boolean, c: integer }</code>. Since structures are always read-only, it doesn't really matter whether a value is memorized or computed via a function.</p>
</section>
<section>
<h2 id="type-companion-objects">Type companion objects <a class="header-anchor" href="#type-companion-objects">§</a></h2>
<p><strong>Type companion objects</strong> (which may also be described as dedicated <strong>static member structures</strong>) are special objects that may share the same name as a class (or act as <strong>singleton objects</strong>). They are used to provide data and functionality that are not associated with a particular instance of a class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Vector2</span></span>
<span class="line"><span style="color: #5B5B5B">	x: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	y: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Vector2</span></span>
<span class="line"><span style="color: #5B5B5B">	zero </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Vector2, b: Vector2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		sqrt</span><span style="color: #B43AFF">((</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.x</span><span style="color: #B43AFF">)</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B43AFF">)</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2.zero </span><span style="color: #A1A1A1">// z = (0, 0)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> d </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Vector2.distance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Vector2</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Vector2</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">9</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// d = 8.485</span></span>
<span class="line"></span></code></pre>
<p><strong>Operators</strong> are functions using symbols as a calling mechanism. Operators can only be defined on type companions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Point</span></span>
<span class="line"><span style="color: #5B5B5B">	x: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	y: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Point</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Point</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b.x, a.y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Point</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.x </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.x, a.y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> b.y</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Point</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Point</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #5B5B5B">a.x, </span><span style="color: #000000">-</span><span style="color: #5B5B5B">b.y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sumOfPoints </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> Point</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// sumOfPoints equals Point(-1, 9)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> differenceOfPoints </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// differenceOfPoints equals Point(5, 1)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="type-features">Type features <a class="header-anchor" href="#type-features">§</a></h2>
<p>A <strong>type feature</strong> (also known as a <strong>type class</strong> in other languages) is a feature consisting only of type object members and operators and which consequently abstracts over different <strong>types</strong> (rather than instances of types). For example, a feature abstracting over all types supporting the <code>==</code> operator would be defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Equatable&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: T, y: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"></span></code></pre>
<p>In the following example, both <code>Point</code> and <code>Person</code> implement the <code>Equatable</code> feature:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Point</span></span>
<span class="line"><span style="color: #5B5B5B">	x: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	y: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Point </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Equatable&lt;Point&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Point, b: Point</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.x, a.y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b.x, b.y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Equatable&lt;Person&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Person, b: Person</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.fullName, a.age</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b.fullName, b.age</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> areEqual&lt;T </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Equatable&lt;T&gt;&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: T, b: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> b</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;true&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;true&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">areEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John Doe</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">24</span><span style="color: #B43AFF">)))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: couldn&#39;t find a type for T</span></span>
<span class="line"></span></code></pre>
<p>Here's a monoid type feature (representing an associative binary operation with identity element):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Monoid</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">this</span></span>
<span class="line"><span style="color: #5B5B5B">	identity: </span><span style="color: #0059E8">this</span></span>
<span class="line"></span></code></pre>
<p><em>(Note the <code>this</code> type would contextually refer to the concrete type of the object implementing the feature, not to the <code>Monoid</code> abstraction)</em></p>
<p>Multiple type features used as constraints:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> propertyOf3Sums&lt;T </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Monoid </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Equatable&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: T, b: T, c: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">((</span><span style="color: #5B5B5B">a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> T.identity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">((</span><span style="color: #5B5B5B">b </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> c</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> T.identity</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Using a type alias and a join type we can define a type that <strong>combines both instance and type members</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Equatable</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> EquatablePerson </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Equatable </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="expansion">Expansion <a class="header-anchor" href="#expansion">§</a></h2>
<p><strong>Expansion</strong> introduces new members to an existing class, feature or type object, and can be performed any number of times:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	fullname </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	anonymous </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	haveSameFirstName</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: Person, p2: Person</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; p1.firstName </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> p2.firstName</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Person, b: Person</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a.firstName, a.lastName, a.age</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b.firstName, b.lastName, b.age</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Expansion can add any member kind apart from instance fields (though it can add type object fields):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	favoriteNumber: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// ERROR: This will not work</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	andy </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Andy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">22</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	angela </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anegla</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jones</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">25</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// But this will work</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	ben </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Ben</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">23</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// And so will this</span></span>
<span class="line"></span></code></pre>
<p>Class expansions can <strong>extend features</strong>, as well as override their default implementations:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Employee</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	label: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Employee </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	label </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; fullName</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Great Employee: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">label</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Expansions can <strong>add members to features</strong>, as long as they provide default values or implementations:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	label: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printLabel</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">label</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> Labeled</span></span>
<span class="line"><span style="color: #5B5B5B">	reversedLabel </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; label.reversed</span></span>
<span class="line"></span></code></pre>
<p>Expansions are designed such that they never change the behavior of code outside of their own scope. This is ensured by several <strong>precedence rules</strong>.</p>
<p>For class or type object members added through an expansion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5b5b5b">overriden members &gt; feature default implementations &gt; expansion members
</span></span></code></pre>
<p>For feature members added through an expansion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5b5b5b">any feature members with same name and signature (including in features other than the expanded one) &gt; feature expansion members
</span></span></code></pre>
<p>This means that if <code>X</code> and <code>Y</code> are features, and <code>Z</code> extends both <code>X</code> and <code>Y</code>, and <code>X</code> is expanded with a method that also exists in <code>Y</code>, <code>X</code>'s expansion will be shadowed by <code>Y</code>'s implementation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> X</span></span>
<span class="line"><span style="color: #5B5B5B">	someField: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> X</span></span>
<span class="line"><span style="color: #5B5B5B">	someFunction</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">X!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Y</span></span>
<span class="line"><span style="color: #5B5B5B">	someFunction</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Y!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Z </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> X, Y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> test</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">z: Z</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> z.someFunction</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// There is no conflict here, this is will always return &quot;Y!&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="generics">Generics <a class="header-anchor" href="#generics">§</a></h2>
<p><strong>Generic typing</strong> (also known as <strong>parametric polymorphism</strong>) allows types and methods to refer to unknown, or partially known, types, which can vary and are determined individually at each class instantiation or method call.</p>
<p>A <strong>type parameter</strong> is introduced using the <code>&lt;T&gt;</code> notation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Pair&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	a: T</span></span>
<span class="line"><span style="color: #5B5B5B">	b: T</span></span>
<span class="line"></span></code></pre>
<p>The unknown type parameter (named <code>T</code> in this example) can accept any type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfIntegers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfstrings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfBooleans </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Including the <code>Pair</code> type itself:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfPairs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair&lt;Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span></span>
<span class="line"></span></code></pre>
<p>The type argument e.g. <code>&lt;integer&gt;</code> is not required if it <strong>can be inferred</strong> from the constructor arguments, this simplifies the above to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfIntegers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfstrings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfBooleans </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pairOfPairs </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">c</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">d</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span></span>
<span class="line"></span></code></pre>
<p><em>(Note: Unlike C#, Java, TypeScript, and several other languages, the Island language does not allow both generic and non-generic types sharing a common identifier. This enables to safely omit the type argument with no chance of ambiguity)</em></p>
<p>Methods can accept and infer type arguments as well:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstOfPair&lt;A&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p: Pair&lt;A&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; p.a</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> firstInteger </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstOfPair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns 1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> firststring </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstOfPair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns a</span></span>
<span class="line"></span></code></pre>
<p>Type parameters can have <strong>constraints</strong>, which enforce a minimum assignability requirement:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> loveAffair&lt;T </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: T, b: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> loves </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">b.name</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Mike</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #B43AFF">))</span></span>
<span class="line"><span style="color: #A1A1A1">// l = &quot;Angela loves Mike&quot;</span></span>
<span class="line"></span></code></pre>
<p>Note that applying a type as a constraint is subtly different than specifying the type directly, especially in the case where the type parameter is used in multiple places:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Fruit </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	weight: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Fruit</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">))</span></span>
<span class="line"><span style="color: #A1A1A1">// Error! could not find a binding for type parameter T.</span></span>
<span class="line"></span></code></pre>
<p>Even though both the types <code>Person</code> and <code>Fruit</code> satisfy the <code>Named</code> feature, the <code>T</code> type parameter can only be instantiated by a single type, therefore a compilation error is emitted.</p>
<p>Alternatively, if the <code>Named</code> feature was used directly as <code>a</code> and <code>b</code>'s parameter types, the code would compile successfully:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> loveAffair2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: Named, b: Named</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> loves </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">b.name</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> loveAffair2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">21</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Fruit</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Apple</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works!</span></span>
<span class="line"><span style="color: #A1A1A1">// l = &quot;Angela loves Apple&quot;</span></span>
<span class="line"></span></code></pre>
<p><strong>Multiple constraints</strong> may be applied to a type parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Printable</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printMe</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Fruit </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named, Printable</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	weight: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printMe</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">A </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">a.name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> weighing </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">weight</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">kg</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printNamedThing&lt;T </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Printable&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; a.printMe</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">printNamedThing</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Fruit</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Banana</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;A Banana weighing 0.5kg&quot;</span></span>
<span class="line"></span></code></pre>
<p>Type parameters can have <strong>default values</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> transformToPair&lt;T, R </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">v1: T, v2: T</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">R, R</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> transformToPair</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">42</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">53</span><span style="color: #5B5B5B">, </span><span style="color: #000000">-</span><span style="color: #E65C00">14</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">7</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;T&#39; inferred as decimal, &#39;R&#39; defaults to integer</span></span>
<span class="line"><span style="color: #A1A1A1">// &#39;result&#39; has the type &#39;(integer, integer)&#39;</span></span>
<span class="line"></span></code></pre>
<p>Island supports <strong>implicit type parameters</strong>, meaning that generic types referenced without the introduction of type parameters will accept any type argument, given it satisfies their constraint set:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: Pair, p2: Pair</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>which would be roughly equivalent to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstsOfPairs&lt;A, B&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: Pair&lt;A&gt;, p2: Pair&lt;B&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">A, B</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p><code>p1</code> and <code>p2</code> can accept any instances of <code>Pair</code>, including ones with incompatible types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r = (1, &quot;a&quot;)</span></span>
<span class="line"></span></code></pre>
<p>This is not always desirable. In case <code>p1</code> and <code>p2</code> are expected to have compatible instantiations of <code>Pair</code>, a type parameter must be introduced:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstsOfPairs&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: Pair&lt;T&gt;, p2: Pair&lt;T&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Pair</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, Pair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: p1 and p2 must have compatible types!</span></span>
<span class="line"></span></code></pre>
<p>Type associations may be defined ad-hoc, such that they only describe relationships between different polymorphic entities, but are not actually exposed as parameters. This kind of typing is called <strong>existential typing</strong>.</p>
<p>By introducing an existential type <code>U</code>, it is possible to simplify the previous example to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> firstsOfPairs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: Pair&lt;</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> U&gt;, p2: Pair&lt;</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> U&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1.a, p2.a</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>This means that <code>p1</code> and <code>p2</code> must have a compatible type instantiation (which is &quot;code-named&quot; <code>U</code>). However, an assignment for <code>U</code> cannot be explicitly specified when <code>firstOfPairs</code> is invoked.</p>
</section>
<section>
<h2 id="polymorphic-subtyping-rules-(covariance-and-contravariance)">Polymorphic subtyping rules (covariance and contravariance) <a class="header-anchor" href="#polymorphic-subtyping-rules-(covariance-and-contravariance)">§</a></h2>
<p>When assigning a value to a plain variable of a given type, the value would be assignable to it only if the target type is identical to, or more general than the type of the value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a1: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Animal</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works: identical types</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a2: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">34</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Doesn&#39;t work: unrelated types</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a3: Animal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Cat</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works: target type is more general than assigned value type</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a4: Cat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Animal</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Doesn&#39;t work: target type is more specific than assigned value type</span></span>
<span class="line"></span></code></pre>
<p>It may seem, at first, like this is the only manner in which types can relate to each other: after all, it doesn't make sense that an any <code>Animal</code> type would substitute a <code>Cat</code> type. However, there are cases where this is exactly what happens!</p>
<p>Here are two function types, one accepting an <code>Animal</code> parameter type, the other a <code>Cat</code> parameter type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> GiveMeAnimal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> GiveMeCat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Now ponder this carefully: do you think that <code>GiveMeCat</code> should assign to <code>GiveMeAnimal</code>? <code>GiveMeAnimal</code> should assign to <code>GiveMeCat</code>? or maybe both should assign to each other? or neither one to any?</p>
<p>Let's go through it again:</p>
<ul>
<li>The type <code>GiveMeCat</code> describes a function that accepts a <code>Cat</code> object, and returns a string.</li>
<li>The type <code>GiveMeAnimal</code> describes a function that accepts an <code>Animal</code> object, and returns a string.</li>
</ul>
<p><code>GiveMeAnimal</code> is more permissive, it will accept any animal, however <code>GiveMeCat</code> is more strict, and will only accept a cat.</p>
<p>If you attempted to assign a function of type <code>GiveMeCat</code> to a variable of type <code>GiveMeAnimal</code> you'd take a strict function and put in a placeholder designated for a more permissive function:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> giveMeAnimal: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeAnimal </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello cat!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Because &#39;giveMeAnimal&#39; accepts any animal, passing a dog as argument should work,</span></span>
<span class="line"><span style="color: #A1A1A1">// but would it make any sense?</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> giveMeAnimal</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Dog</span><span style="color: #B43AFF">())</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Would return &quot;Hello cat!&quot; ??!!</span></span>
<span class="line"></span></code></pre>
<p>However, if you assigned <code>GiveMeAnimal</code> to <code>GiveMeCat</code>, it would, surprisingly, make more sense:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> giveMeCat: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Cat</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeCat </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Animal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello animal!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Seems to work, but why?</span></span>
<span class="line"></span></code></pre>
<p>This phenomenon is called <strong>contravariance</strong> (substitution of general with specific) and the more &quot;intuitive&quot; substitution rule, mentioned in the context of plain variables, is called <strong>covariance</strong> (substitution of specific with general).</p>
<p>It turns out that when thinking about functions: return types (&quot;out&quot; positions) are covariant, however, parameter types (&quot;in&quot; positions) are contravariant.</p>
<p>Sometimes we may wish to constrain type parameters so that they can only be used in one of these positions. This is possible with the <code>in</code> and <code>out</code> modifiers:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> LookupTable&lt;</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> K, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> V&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getValue</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">key: K</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: V</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="fixed-fields-and-partially-constructed-objects">Fixed fields and partially constructed objects <a class="header-anchor" href="#fixed-fields-and-partially-constructed-objects">§</a></h2>
<p>Consider this definition of the <code>Person</code> class :</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">enumeration</span><span style="color: #5B5B5B"> Gender </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> Male, Female</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	gender: Gender</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	titleAndLastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #0059E8">when</span><span style="color: #AA6631"> gender </span><span style="color: #000000">==</span><span style="color: #AA6631"> Gender.Male: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Mr.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">, </span><span style="color: #0059E8">otherwise</span><span style="color: #AA6631">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Ms.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	fullNameAndAge </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">fullName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Say we wanted to derive a class for a person who must be male and whose last name must be &quot;Smith&quot;. In the traditional object-oriented style this can be done by extending <code>Person</code> and fixing the <code>lastName</code> and <code>gender</code> fields to the constant values <code>&quot;Smith&quot;</code> and <code>Male</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> MrSmith </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">final</span><span style="color: #5B5B5B"> lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">final</span><span style="color: #5B5B5B"> gender </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Gender.Male</span></span>
<span class="line"></span></code></pre>
<p>A major limitation of this approach is that it can only work with values that are known at compile-time. What if we wanted to &quot;partially apply&quot; the <code>Person</code> class with some arbitrary values for <code>lastName</code> and <code>gender</code> that are only known at run-time?</p>
<p>This can be done using the <code>with</code> operator:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> mrSmith </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> lastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Smith</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, gender </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Gender.Male</span></span>
<span class="line"></span></code></pre>
<p>Because some of <code>mrSmith</code>'s fields (namely <code>firstName</code> and <code>age</code>) are missing (and don't have default values), a full instance of <code>Person</code> could not be constructed. Instead, the resulting value - <code>mrSmith</code> is not an object of type <code>Person</code>, but of the type <code>partial Person with lastName, gender</code>.</p>
<p>Wouldn't it be nice if we could call some of the partially constructed object's methods? Unfortunately since methods may access the <code>this</code> object (either implicitly or explicitly), there's no general, formal guarantee they wouldn't attempt to access uninitialized fields. However, in the common case, where the methods never pass the <code>this</code> object to an external method, the requirements of each method can be determined automatically:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	titleAndLastName </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #0059E8">when</span><span style="color: #AA6631"> gender </span><span style="color: #000000">==</span><span style="color: #AA6631"> Gender.Male: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Mr.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">, </span><span style="color: #0059E8">otherwise</span><span style="color: #AA6631">: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Ms.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	fullNameAndAge </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">fullName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>The computed field <code>titleAndLastName</code> can be called for <code>mrSmith</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mrSmith.titleAndLastName</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Mr. Smith&quot;</span></span>
<span class="line"></span></code></pre>
<p>However trying to reference <code>fullName</code> would result in a compilation error, since it requires <code>firstName</code> to be initialized:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mrSmith.fullName</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: &#39;fullName&#39; uses member &#39;firstName&#39;, which is not defined for type &#39;partial Person with lastName, gender&#39;</span></span>
<span class="line"></span></code></pre>
<p>In case a member passes the <code>this</code> object explicitly, the receiving function must annotate its parameter with a compatible <code>partial</code> type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMePartialPerson</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p: </span><span style="color: #0059E8">partial</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> gender, lastName</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	somethingElse </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; giveMePartialPerson</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>We could continue adding more information to the object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">mrSmith.firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #A1A1A1">// The type of &#39;mrSmith&#39; has now changed to &#39;partial Person with firstName, lastName, gender&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mrSmith.fullName</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;John Smith&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mrSmith.fullNameAndAge</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! &#39;fullNameAndAge&#39; uses member &#39;age&#39;, which is not defined for type &#39;partial Person with firstName, lastName, gender&#39;</span></span>
<span class="line"></span></code></pre>
<p>Finally, when we add a value for <code>age</code>, the object becomes fully constructed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">mrSmith.age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">28</span></span>
<span class="line"><span style="color: #A1A1A1">// mrSmith finally receives the type &#39;Person&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mrSmith.fullNameAndAge</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;John Smith, of 28 years of age&quot;</span></span>
<span class="line"></span></code></pre>
<p>An alternative, but more limited, way to achieve a similar effect is to partially apply the constructor call:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Point</span></span>
<span class="line"><span style="color: #5B5B5B">	x: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	y: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> pointWhereXEquals1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Point</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// The type of &#39;pointWhereXEquals1&#39; is &#39;partial Point with x&#39;</span></span>
<span class="line"></span></code></pre>
<p>Here's a different use case.</p>
<p>Say we had an object representing a database, and that has the fields <code>connection</code> and <code>name</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Database</span></span>
<span class="line"><span style="color: #5B5B5B">	connection: ServerConnection</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> query</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">, sql: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> verifyConnection</span><span style="color: #B43AFF">({</span><span style="color: #5B5B5B"> connection </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		connection.verify</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>For every new database object we wanted to create, we'd have to re-specify which server connection it uses:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> connectServer</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">localhost:5555</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">admin</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">1234</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB1</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB2</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection, name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB3</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>With a partially constructed object, the <code>connection</code> field can be fixed once and then the resulting object reused:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> connectServer</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">localhost:5555</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">admin</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">1234</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Database </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> connection </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myConnection</span></span>
<span class="line"><span style="color: #A1A1A1">// The type of &#39;databaseWithMyConnection&#39; is &#39;partial Database with connection&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">databaseWithMyConnection.verifyConnection</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works!</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB1</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB2</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> db3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> databaseWithMyConnection </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DB3</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>In case some fields have default values but the desired behavior is to have those fields undefined on the partial object, their default values <strong>can be &quot;erased&quot;</strong> by explicitly applying the <code>no</code> modifier within the <code>with</code> expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	planetResidence </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Earth</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> angelaFromUnknownPlanet </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> planetResidence</span></span>
<span class="line"></span></code></pre>
<p><strong>Features can be partial</strong> as well, however since features cannot be instantiated directly the <code>partial</code> type modifier is only effectively usable for specifying a subset of a feature's fields that are expected to be known. For instance:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	alias: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	id: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printThingName</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">thing: </span><span style="color: #0059E8">partial</span><span style="color: #5B5B5B"> Named </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name, id</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Name: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">thing.name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, Id: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">thing.id</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="concurrency%2C-parallelism-and-lazy-evaluation">Concurrency, parallelism and lazy evaluation <a class="header-anchor" href="#concurrency%2C-parallelism-and-lazy-evaluation">§</a></h1>
<section>
<h2 id="computed-variables-and-values">Computed variables and values <a class="header-anchor" href="#computed-variables-and-values">§</a></h2>
<p>Remember computed fields in a class?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	fullName </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">firstName</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">lastName</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p><code>fullName</code> is only evaluated when it is called (and possibly the result is then stored for subsequent calls).</p>
<p>Using a computed variable, we could make a local variable that behaves in a similar way:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// The type of z is a plain integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">z</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints 3</span></span>
<span class="line"></span></code></pre>
<p><code>z</code> is a variable bound to a value of type <code>integer</code>, but its value would only be calculated when it is first used.</p>
<p>With this approach, however, <code>z</code> will lose its <code>computed</code> characteristic when it is passed to a method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> w </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">z, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// z will be evaluated before makePair is called</span></span>
<span class="line"><span style="color: #A1A1A1">// w is equal to (3, 5)</span></span>
<span class="line"></span></code></pre>
<p>A second approach would be define the value itself (not the variable) as computed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, value2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value1, value2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">compute</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"><span style="color: #A1A1A1">// &#39;z&#39; still has the plain type &#39;integer&#39;</span></span>
<span class="line"><span style="color: #A1A1A1">// The &#39;computed&#39; characteristic is only tracked internally, in the runtime</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> w </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> makePair</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">z, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// z will not be evaluated here</span></span>
<span class="line"><span style="color: #A1A1A1">// w has the value (compute 1 + 2, 5)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> v </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> w[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;compute 1 + 2&#39; is finally evaluated to 3 and v gets the value 4</span></span>
<span class="line"></span></code></pre>
<p>This behavior is called <strong>lazy evaluation</strong>. We can postpone the evaluation of <code>compute 1 + 2</code> only to the point where it is actually needed. It can be passed to methods or stored in variables and objects, but will only be evaluated when it is a part of a complex expression that is immediately (eagerly) evaluated.</p>
<p>Computed values can be <strong>composed</strong> together:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">compute</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> s </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">compute</span><span style="color: #5B5B5B"> sqrt</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">z</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;z&#39; is not evaluated but composed with the computation &#39;sqrt(....)&#39;</span></span>
<span class="line"><span style="color: #A1A1A1">// s now equals &#39;compute sqrt(1 + 2)&#39;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="concurrent-and-parallel-execution-with-the-spawn-keyword">Concurrent and parallel execution with the <code>spawn</code> keyword <a class="header-anchor" href="#concurrent-and-parallel-execution-with-the-spawn-keyword">§</a></h2>
<p>When then <code>spawn</code> keyword is added to a function call, the function is immediately executed in a separate thread. When the returned value of the spawned method is first read, execution may block if the method had not yet completed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> heavyCalculation</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> heavyCalculation</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// The function heavyCalculations() starts on a seperate thread</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> somethingUnrelated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will execute even if heavyCalculations() has not completed</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// This may block until heavyCalculations() returns and x receives a value</span></span>
<span class="line"></span></code></pre>
<p><strong>Multiple functions</strong> may be spawned at the same time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Will block until r1 received a value and exeute even if r2 hasn&#39;t yet</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Blocks until r2 receives a value</span></span>
<span class="line"></span></code></pre>
<p>The <code>wait</code> statement can be used to explicitly wait for a particular value to become available:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> r2</span></span>
<span class="line"></span></code></pre>
<p>For convenience, the <code>wait</code> keyword can also be used as a modifier. The following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, </span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> r2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculation1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculation2</span><span style="color: #B43AFF">())</span></span>
<span class="line"></span></code></pre>
<p>As demonstrated, applying <code>spawn</code> to a simple function call, it is possible to compute an <strong>individual value</strong> in the background. Using streams, it is also possible to instead compute a <strong>sequence of values</strong> in background.</p>
<p>This will evaluate a stream method in a background thread and save the yielded values to disk as soon as they arrive:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> heavyCalculations</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> result </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> heavyCalculations</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	somethingUnrelated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will execute even if &#39;result&#39; has not yet received a value</span></span>
<span class="line"><span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until &#39;result&#39; receives a value</span></span>
<span class="line"></span></code></pre>
<p>Analogously to the single-value approach, we can spawn multiple streams and iterate both of them at the same time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result1, result2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until result1 receives a value, and will execute even if result2 didn&#39;t</span></span>
<span class="line"><span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This will block until result2 receives a value</span></span>
<span class="line"></span></code></pre>
<p>Sometimes the lazy behavior isn't desirable, and it is preferred to wait until one or all of the streams produce a value before the body of the loop is entered. The <code>wait</code> keyword will cause execution to block until the reference variable(s) receive a value.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result1, result2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> result1, result2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// This will only execute once both result1 and result receive a value</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Congratulations, we have new results!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>For convenience, the <code>wait</code> keyword can also be integrated as a modifier to the loop variable:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> result1, </span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> result2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// This will only execute when both result1 and result receive a value</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Congratulations, we have new results!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Sometimes we want to allow for results to evaluate as soon as any one of several computations yields a value. By adding the <code>any</code> modifier to the variable, a single result is received whenever any one of the streams yields a value.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Note both streams should have compatible return types,</span></span>
<span class="line"><span style="color: #A1A1A1">// otherwise &#39;result&#39; will receive a choice type (introduced at later chapter)</span></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> result </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">heavyCalculations1</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, heavyCalculations2</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	writeToDisk</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>The <code>spawn</code> keyword can also be used in stream and list comprehensions.</p>
<p>This will define a stream method that computes an unbounded series of primes in the background:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> backgroundPrimes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> p </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> calculatePrimes</span><span style="color: #B43AFF">())</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; p</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="automatic-parallelization-via-implicit-spawning">Automatic parallelization via implicit spawning <a class="header-anchor" href="#automatic-parallelization-via-implicit-spawning">§</a></h2>
<p>Since <code>function</code>s and <code>stream</code>s are pure computations, spawning may be performed automatically by the compiler, without any need for explicit annotation in the code, since execution of these methods does not carry any impact beyond the scope of their internal running context.</p>
<p>This means that normal code may be internally transformed during compilation to include <code>spawn</code> modifiers based on the compiler's own judgement. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> anotherFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> a </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> someStream</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>May be transformed to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> someFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> anotherFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> a </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">spawn</span><span style="color: #5B5B5B"> someStream</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>In the case of a stream, the compiler may also choose to precompute one or more future elements ahead of time (that is, in parallel to the execution of the loop body), since doing so would have no impact on the program's behavior (aside from possible slight increase in memory use).</p>
</section>
<section>
<h2 id="delegates-and-structured-effect-concurrency">Delegates and structured effect concurrency <a class="header-anchor" href="#delegates-and-structured-effect-concurrency">§</a></h2>
<p><code>spawn</code> allows pure functions and streams to be easily parallelized. Since pure computations have no side-effects, there's no need for much careful considerations when applying it. The worst that can happen is that performance may be degraded due to excessive overhead, when managed inappropriately.</p>
<p>When dealing with concurrency and parallelism involving effects, however, the situation becomes more subtle. If it was possible to freely &quot;spawn&quot; actions, that would open up several potential issues:</p>
<ul>
<li>If an action could be freely spawned to execute in a separate thread, would its execution be let to &quot;invisibly&quot; continue forever? even long after execution has left the original caller's scope?</li>
<li>How would it be possible to conduct two-way communication with the spawned action? Perhaps by passing it a channel? but are free-form channels, which can be duplicated and moved everywhere, really a good fit for a safe and strict language like Island?</li>
</ul>
<p>For these reasons, instead of free-form threading and channeling, Island provides <em>delegates</em> (no relation to C# or Kotlin delegates), which are worker-like action subroutines that are designed to follow a strict pattern of <em>structured concurrency and messaging</em>.</p>
<p>A <strong>delegate method</strong> (analogous to a stream method) is an action which once called, returns a <strong>delegate object</strong> (analogous to a stream object) that can be used for two-way communication with it via an embedded channel.</p>
<p>Here's a simple example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> MyDelegate</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">repeat</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> name &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>The above delegate has both incoming and outgoing channels. An incoming one of type <code>string</code>, and an outgoing one, also of type <code>string</code>.</p>
<p><code>.... &lt;- in</code> reads a message from the incoming channel.
<code>out &lt;- ....</code> writes a message to the outgoing channel.</p>
<p>Calling <code>MyDelegate</code> returns an object of type <code>Delegate&lt;string, string&gt;</code>. This object allows its caller scope to interactively communicate with it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myDelegate </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> MyDelegate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">myDelegate &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Adam</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Sends &quot;Adam&quot; to the incoming channel</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result1 &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> myDelegate </span><span style="color: #A1A1A1">// Receives the result &quot;Hello Adam!&quot; from the outgoing channel</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">myDelegate &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tom</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Sends &quot;Tom&quot; to the incoming channel</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result2 &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> myDelegate </span><span style="color: #A1A1A1">// Receives the result &quot;Hello Tom!&quot; from the outgoing channel</span></span>
<span class="line"></span></code></pre>
<p>A delegate's outgoing channel <strong>may be consumed by a <code>for</code> loop</strong>, in a manner similar to a stream:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> MyDelegate</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// This delegate only has an outgoing channel.</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// It is, in a sense, very similar to a stream, only that it may also</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// produce side-effects, by invoking actions or spawning further delegates.</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span></span>
<span class="line"><span style="color: #5B5B5B">		greetingChan &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> greeting </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> myDelegate</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Prints &quot;Hello 1&quot;, &quot;Hello 2&quot;, &quot;Hello 3&quot;, ....</span></span>
<span class="line"></span></code></pre>
<p>Similarly to how multiple parallel streams can be consumed using the <code>any</code> modifier, an incoming message can be consumed as soon as it's received from any of two or more delegates:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> KeyEvents</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: KeyEvent</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> MouseEvents</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: MouseEvent</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> inputEvent </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">KeyEvents</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, MouseEvents</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// &#39;inputEvent&#39; has type &#39;KeyEvent or MouseEvent&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> KeyEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> MouseEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>In real-world applications, however, it is sometimes the case that event sources are required to be dynamically subscribed and unsubscribed from throughout the program's runtime. This can be achieved by iterating over a dynamic collection of delegates (in this example a dictionary) and altering the collection in progressive iterations of the loop:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> eventSources </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">kEvents</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: KeyEvents</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> event </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> eventSources</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> KeyEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Keyboard event!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Now listening to mouse events instead!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> eventSources </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> [</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">kEvents</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #5B5B5B">			[</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">mEvents</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> MouseEvents</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> MouseEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Mouse event!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Channel type references can be used to disambiguate messages from different channels sharing the same base type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> ProducesStrings</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> AlsoProducesStrings</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> stringMessage </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">ProducesStrings</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, AlsoProducesStrings</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Superficially, &#39;stringMessage&#39; has type &#39;string&#39;. However, by matching over references</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// to the delegate channels&#39; identifiers, the correct case can be selected:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> ProducesStrings.</span><span style="color: #0059E8">out</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> AlsoProducesStrings.</span><span style="color: #0059E8">out</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>A delegate executes in parallel to the calling thread, but is <strong>bound to the lifetime of its object</strong>. Once its object goes out of scope, its execution immediately terminates. It cannot be spawned and then &quot;forgotten&quot;:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> someConditionIsTrue</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> longRunningDelegate </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> LongRunningDelegate</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Delegate starts on a parallel thread</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// &#39;longRunningDelegate&#39; scope ends here</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// The delegate execution&#39;s may have been abruptly terminated since its</span></span>
<span class="line"><span style="color: #A1A1A1">// object is no longer in scope!</span></span>
<span class="line"></span></code></pre>
<p>Messages received from its outgoing channel are evaluated asynchronously, similarly to how individual values yielded from a spawned stream only become potentially &quot;blocking&quot; towards the current thread once they are first read.</p>
<p>By using the <code>wait</code> modifier, it is possible to convert a delegate call to a synchronous-like method invocation, in an <code>await</code>-like fashion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">delegate</span><span style="color: #5B5B5B"> readTextFileInBackground</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">fileName: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> fileContent</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// &#39;return fileContent&#39; can also be interchangably used here</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Execution waits until a message is received</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> text &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> readTextFileInBackground</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">data.txt</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Note that at this point, the delegate is terminated immediately after it sends its</span></span>
<span class="line"><span style="color: #A1A1A1">// first message. If the delegate body included additional code after &#39;out &lt;- fileContent&#39;,</span></span>
<span class="line"><span style="color: #A1A1A1">// this code would not be executed, or alternatively a compile/run-time error may be issued</span></span>
<span class="line"><span style="color: #A1A1A1">// (depending on settings)</span></span>
<span class="line"></span></code></pre>
<p>By default, messages are delivered asynchronously:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">myDelegate &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Some data</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// message will be buffered if receiver is busy</span></span>
<span class="line"><span style="color: #5B5B5B">.... </span><span style="color: #A1A1A1">// any subsequent code is immediately executed</span></span>
<span class="line"></span></code></pre>
<p>To ensure the message has been successfully delivered before execution proceeds, the <code>wait</code> modifier can be similarly used:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">wait</span><span style="color: #5B5B5B"> myDelegate &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Some data</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// execution will wait until message is delivered</span></span>
<span class="line"><span style="color: #5B5B5B">.... </span><span style="color: #A1A1A1">// any subsequent code will only be run only after the message is accepted by the delegate</span></span>
<span class="line"></span></code></pre>
<p>A delegate object <strong>cannot be copied, only moved</strong>. Move semantics ensure that its channels can communicate with only one single endpoint at a time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myDelegate </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> MyDelegate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> myDelegate2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> myDelegate </span><span style="color: #A1A1A1">// Delegate object now only reachable via myDelegate2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">myDelegate2 &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nancy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works</span></span>
<span class="line"><span style="color: #5B5B5B">myDelegate &lt;</span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Nancy</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Fails at compile-time</span></span>
<span class="line"></span></code></pre>
<p>Whenever a delegate, or any of the secondary delegates it spawns, encounters an unhandled failure, the resulting <strong>failure object will be immediately captured and propagated</strong> to its outgoing channel. A convenient way to handle these failures is to add a <code>Failure</code> match case handler when messages are read via a <code>match</code> statement.</p>
<p>In this example, the <code>Failure</code> type becomes a hidden component of the choice type inferred for <code>anyEvent</code>. Failures will be caught from either <code>KeyEvents</code>, <code>MouseEvents</code> or any one of the delegates they encapsulate:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> inputEvent </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">KeyEvents</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">, MouseEvents</span><span style="color: #B43AFF">())</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// &#39;inputEvent&#39; has type &#39;KeyEvent or MouseEvent (or Failure)&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> KeyEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> MouseEvent</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Failure </span><span style="color: #A1A1A1">// Failure type can be further specialized, like to &#39;Failure&lt;IO&gt;&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="contracts">Contracts <a class="header-anchor" href="#contracts">§</a></h1>
<section>
<h2 id="contracts-1">Contracts <a class="header-anchor" href="#contracts-1">§</a></h2>
<p>The <code>assert</code> statement can evaluate arbitrary assertions. It is evaluated both during compile-time and run-time, as needed.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> b</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, x</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// compiler error</span></span>
<span class="line"></span></code></pre>
<p>It can be positioned anywhere, including in the global scope:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> z &gt; </span><span style="color: #E65C00">5</span></span>
<span class="line"></span></code></pre>
<p>It may include function and predicate calls (but not action calls):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> nonzero</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> nonzero</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">b</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> b</span></span>
<span class="line"></span></code></pre>
<p>It can reference the returned value as well, if declared as a named return variable (these types of assertions would always be evaluated after the function has returned):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> doSomeMath</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> result &gt; x</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>The immutability property could potentially ease the analysis of more complex scenarios at compile-time, using a more advanced theorem prover:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> result &gt; </span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">a: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B">, b: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> b </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> a </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> b &lt; </span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// &#39;r1&#39; is always greater than 5, regardless of argument passed to &#39;someMath1&#39;:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">???</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Compiler error regardless of the value of &#39;r1&#39; and the second argument:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, ???</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="type-abstractions">Type abstractions <a class="header-anchor" href="#type-abstractions">§</a></h1>
<section>
<h2 id="refinement-and-assertion-types">Refinement and assertion types <a class="header-anchor" href="#refinement-and-assertion-types">§</a></h2>
<p><strong>Refinement types</strong> can be seen as simple contracts annotated into the type itself:</p>
<p>The following two function declarations are practically equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">assert</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> someMath1</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Since Island values and variables are strictly read-only after initialization, only one assertion check is needed to ensure the validity of a contract throughout the lifetime of the object and its binding variable. Types of operations between refined types can be inferred during compile-time (if feasible):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">10</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> z </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> y </span><span style="color: #A1A1A1">// z&#39;s type is -50..0</span></span>
<span class="line"></span></code></pre>
<p>Refinement types can include more complex Boolean expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> someMath2</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #000000">-</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">20</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #000000">-</span><span style="color: #E65C00">16</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">16</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Refinement types can apply to strings, using regular expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> properIdentifiersOnly</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>More complex assertions can be included in a type by referencing a <strong>predicate function</strong>, which must accept a single argument and a return type of <code>boolean</code>. These kinds of types are called <strong>assertion types</strong>.</p>
<p>Assertion types, for the most part, cannot be checked during compile-time and would require a run-time call each time a variable of the type is initialized. The predicate's parameter type (which can be any type, including a refinement type) would be used to determine the base underlying type used at compile-time:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> MultipleOf10</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: MultipleOf10</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Since <code>MultipleOf10</code> represents both a method identifier and a type, it naturally lends for the <code>is</code> operator to be used as an alternative syntax to assert over its truth-value:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> val: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Note that &#39;val&#39; has been declared with the type &#39;integer&#39;, not &#39;MultipleOf10&#39;</span></span>
<span class="line"><span style="color: #A1A1A1">// The following type assertion depends on the runtime value of &#39;val&#39;:</span></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> val </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> MultipleOf10 </span><span style="color: #A1A1A1">// practical alternative to writing MultipleOf10(val)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Like any other method, assertion types can accept type arguments:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> ShortList&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">list: List&lt;T&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; list.Length &lt; </span><span style="color: #E65C00">100</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: ShortList&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>A less powerful, but more concise way to define assertion types employs the <code>where</code> clause, used similarly to the <code>match</code> predicate syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> something</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>These capabilities enable overload resolution to include rudimentary <code>match</code>-like predicates:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Person</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Using the compact overloading syntax would resemble more of the <code>match</code>/<code>case</code> structure. The following is semantically equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">person</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>However, note that unlike <code>match</code> statements, overloading assumes the given argument set must satisfy one of the overloads, thus an analogous <code>otherwise</code> fallback is not needed. In case of a matching failure not caught during compile-time, a run-time error would be thrown.</p>
<p>Here's recursive Fibonacci implemented using overloading and refinement types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> fibonacci</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">..</span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Passing a number smaller than 1, e.g. <code>fibonacci(0)</code> would cause a runtime error (alternatively an overload like <code>(num: integer where num &lt; 1) =&gt; throw ....</code> could be added to provide more specialized error handling).</p>
<p>Compare with a single function matching over <code>num</code> as a parameter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> num</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Passing <code>fibonacci(0)</code>, would cause a compile-time error.</p>
<p>Also note that in both approaches, calling:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fibonacci</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Would cause <code>result</code> to have the literal type <code>1</code> as the return value could be inferred at compile-time.</p>
<p>Simple literal types like &quot;Animal&quot;, '5' or 'true' can alternatively be stated without an identifier:</p>
<p>This would further simplify a previous example to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">person</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Having no identifiers, the first two parameters can still accept named arguments by being referenced by their index:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">doSomething</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, owner </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lea</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">,</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Johnson</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">16</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// prints &quot;Hello young animal lover!&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="type-aliases">Type aliases <a class="header-anchor" href="#type-aliases">§</a></h2>
<p>A <strong>type alias</strong> defines a new name for a type expression.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> MyDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"></span></code></pre>
<p>It may include type parameters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> MyDictionary&lt;T, U&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Dictionary&lt;T, </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">T, U</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"></span></code></pre>
<p>By default, type aliases are <strong>structural</strong>, meaning differently named type aliases representing equivalent types are interchangeable with each other.</p>
<p>This is not always desirable, say, when aliasing the <code>decimal</code> type to represent different currencies:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> Dollars </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iWantDollars</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">money: Dollars</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> euros: Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">iWantDollars</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">euros</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// No error!</span></span>
<span class="line"></span></code></pre>
<p>To ensure <code>Dollars</code> and <code>Euros</code> would not be interchangeable with each other one can add the <code>unique</code> modifier. This would define the aliases as <strong>nominal</strong> (unique) types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">unique type</span><span style="color: #5B5B5B"> Dollars </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #0059E8">unique type</span><span style="color: #5B5B5B"> Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iWantDollars</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">money: Dollars</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> euros: Euros </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> Euros </span><span style="color: #A1A1A1">// Explicit cast needed here</span></span>
<span class="line"><span style="color: #5B5B5B">iWantDollars</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">euros</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error! incompatible types</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="choice-types">Choice types <a class="header-anchor" href="#choice-types">§</a></h2>
<p>A <strong>choice type</strong> (also called a <strong>union</strong> or a <strong>sum type</strong>) defines a type that may hold one of several different types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"></span></code></pre>
<p>Choice types can disambiguated at runtime, using a type assertion:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Or using pattern matching:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: IntegerOrString </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> x</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Choice types may <strong>include any type</strong>, including primitives, templates, features, other choice types or even refinement types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> CanBeManyThings </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Cat </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">10</span></span>
<span class="line"></span></code></pre>
<p>Like any type alias, choice types may <strong>include type parameters</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> AnyCollection&lt;T&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> List&lt;T&gt; </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Dictionary&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, T&gt; </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> Set&lt;T&gt;</span></span>
<span class="line"></span></code></pre>
<p>Choice types may be <strong>self-referencing</strong>, which allows modeling complex recursive structures like a binary tree:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">unique type</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> V </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree&lt;V&gt;?, rightNode: BinaryTree&lt;V&gt;?</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="variant-types">Variant types <a class="header-anchor" href="#variant-types">§</a></h2>
<p>In the final example of the previous section we've used a choice type to define a binary tree type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">unique type</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> V </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree&lt;V&gt;?, rightNode: BinaryTree&lt;V&gt;?</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>One issue with this approach is that pattern matching to discriminate between a leaf and internal node is rather involved and error prone:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> leafOrInternal&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> tree: BinaryTree&lt;T&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> T</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">leaf!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">BinaryTree&lt;T&gt;?, BinaryTree&lt;T&gt;?</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">internal!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Wouldn't it be nicer if we could give those two possibilities names, to ease on pattern matching? It would be also nice to declare the type in a more organized way.</p>
<p>This is possible with variant types. A <strong>variant type</strong> (also called a <strong>tagged union</strong>) is a unique (nominal) choice type where each member has its own name.</p>
<p>With a variant type, pattern matching over a binary tree becomes much easier:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	Leaf: V</span></span>
<span class="line"><span style="color: #5B5B5B">	Internal: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">leftNode: BinaryTree&lt;V&gt;?, rightNode: BinaryTree&lt;V&gt;?</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> leafOrInternal&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> tree: BinaryTree&lt;T&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Leaf</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">leaf!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Internal</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">internal!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Values of variant members can be assigned, matched and extracted using the <code>VariantMemberName(value)</code> syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> traverseBinaryTree&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> tree: BinaryTree&lt;T&gt;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Leaf</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> value</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Tuple typed variant members don&#39;t require the extra parentheses</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// e.g. instead of Internal((let left, let right))</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">//    we can write Internal(let left, let right)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Internal</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> left, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> right</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> left </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> traverseBinaryTree</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">left</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> right </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> traverseBinaryTree</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">right</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Variant types allow for including members with <strong>duplicate types</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> Currency</span></span>
<span class="line"><span style="color: #5B5B5B">	USDollar: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Euro: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Yen: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> money: Currency </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Euro</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">45</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Variant types with members of tuple types allow including a <code>where</code> clause, in which the tuple's member names are introduced. In practice this appears similarly to how objects are matched:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> PersonOrCar</span></span>
<span class="line"><span style="color: #5B5B5B">	Person: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">name: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, height: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	Car: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">brand: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, maxSpeed: </span><span style="color: #0059E8">decimal</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getResponseString</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> personOrCar: PersonOrCar</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> height </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall person</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Car </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> maxSpeed </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fast car</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Same as above using the constructor-style syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getResponseString</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> personOrCar: PersonOrCar</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tall person</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Car</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span><span style="color: #5B5B5B">, ...</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fast car</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Members may individually include their own set of type parameters (this is related to the notion of a <strong>generalized algebraic data type</strong>):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> PairOrTriple</span></span>
<span class="line"><span style="color: #5B5B5B">	Pair&lt;T&gt;: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: T, y: T</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	Triple&lt;V&gt;: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: V, y: V, z: V</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> matchPairOrTriple</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> pairOrTriple: PairOrTriple</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi James</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">XYZ</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">123</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">123</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Pair&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> &gt; </span><span style="color: #E65C00">100</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Good</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Triple&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">55</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">55</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Triple&lt;</span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">OK!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Not interesting</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Variant types can be <strong>extended</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> Currency</span></span>
<span class="line"><span style="color: #5B5B5B">	USDollar: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Euro: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Yen: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> ExtendedCurrency </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Currency</span></span>
<span class="line"><span style="color: #5B5B5B">	CanadianDollar: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	PoundSterling: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> ExtendedMoreCurrency </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> ExtendedCurrency</span></span>
<span class="line"><span style="color: #5B5B5B">	SwedishKrona: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	SwissFranc: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span></code></pre>
<p>An extended variant type is a <strong>super-type</strong> of the variant it inherits from. This is the opposite relationship when compared to class inheritance, which creates a subtype.</p>
<p>For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">money: Currency</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Currency.Euro</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span></span>
<span class="line"><span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">ExtendedCurrency.CanadianDollar</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// doesn&#39;t work</span></span>
<span class="line"></span></code></pre>
<p>However:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">money: ExtendedCurrency</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Currency.Euro</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span></span>
<span class="line"><span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">ExtendedCurrency.CanadianDollar</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// works</span></span>
<span class="line"><span style="color: #5B5B5B">giveMeMoney</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">ExtendedMoreCurrency.SwissFranc</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// doesn&#39;t work</span></span>
<span class="line"></span></code></pre>
<p>An extending variant type may <strong>override</strong> one or more members, as long as the overriding type is a super-type of the original:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> WordKind</span></span>
<span class="line"><span style="color: #5B5B5B">	ActionWord: TransitiveVerb</span></span>
<span class="line"><span style="color: #5B5B5B">	ObjectWord: Noun</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> ExtendedWordKind </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> WordKind</span></span>
<span class="line"><span style="color: #5B5B5B">	ActionWord: Verb </span><span style="color: #A1A1A1">// Verb is a super-type of TransitiveVerb</span></span>
<span class="line"></span></code></pre>
<p>Variants may contain <strong>untyped members</strong>, which can be useful for representing possibilities or states that don't carry any data with them:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> Currency</span></span>
<span class="line"><span style="color: #5B5B5B">	USDollar: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Euro: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	Unknown</span></span>
<span class="line"></span></code></pre>
<p>Variant types may <strong>embed class declarations</strong> for one or more of their members. Declaring <code>Internal</code> as an embedded class now allows to implement a specialized <code>traverse</code> method for the <code>Internal</code> member:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	Leaf: V</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	Internal: </span><span style="color: #0059E8">class</span></span>
<span class="line"><span style="color: #5B5B5B">		leftNode: BinaryTree&lt;V&gt;?</span></span>
<span class="line"><span style="color: #5B5B5B">		rightNode: BinaryTree&lt;V&gt;?</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		hasChildren </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">leftNode, rightNode</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">nothing</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> traverse</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> leftNode?.traverse</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> rightNode?.traverse</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
<p>Like classes, variants may have <strong>companion type objects</strong>, which also enable them to support type features:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Here, &#39;this&#39; type substitutes for &#39;BinaryTree&lt;V&gt;&#39;:</span></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt; </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Comparable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;, Equatable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> traverse</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> tree: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Leaf</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> value</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Internal</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> tree.iterate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> compare</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">t1: </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">, t2: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">operator</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">t1: </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">, t2: </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>Individual members of the variant may also receive their own <strong>dedicated type objects</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Here, &#39;this&#39; type substitutes for &#39;BinaryTree&lt;V&gt;&#39;:</span></span>
<span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> BinaryTree&lt;V&gt; </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Comparable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;, Equatable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Here, &#39;this&#39; type substitutes for &#39;BinaryTree&lt;V&gt;.Leaf&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Leaf </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Comparable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;, Equatable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// And here, &#39;this&#39; type substitutes for &#39;BinaryTree&lt;V&gt;.Internal&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Internal </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Comparable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;, Equatable&lt;</span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="enumerations">Enumerations <a class="header-anchor" href="#enumerations">§</a></h2>
<p>An <strong>enumeration</strong> is a type expressing a choice between a set of identifiers associated with constant values. By default, enumeration members receive integer values following the sequence <code>1, 2, 3, ...</code></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">enumeration</span><span style="color: #5B5B5B"> StatusCode </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> Waiting, OK, Failed</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> alertStatus </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> status: StatusCode</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Waiting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Still waiting..</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> OK </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Everything is OK!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Failed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Damn, failed :(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Enumerations are special forms of variant types where each member must receive a unique type (which can also be a literal type like <code>4</code>, <code>&quot;hello&quot;</code> or <code>true</code>).</p>
<p>Here is <code>StatusCode</code> equivalently expressed as its underlying variant type:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">variant</span><span style="color: #5B5B5B"> StatusCode </span><span style="color: #A1A1A1">// 1, 2, 3 are literal *types*</span></span>
<span class="line"><span style="color: #5B5B5B">	Waiting: </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	OK: </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	Failed: </span><span style="color: #E65C00">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> status: StatusCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> StatusCode.OK</span></span>
<span class="line"></span></code></pre>
<p>Enumeration members can have integer values other than the <code>1, 2, 3, ...</code> sequence. If a member value is explicitly specified, all following members without explicit values are automatically incremented relative to it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">enumeration</span><span style="color: #5B5B5B"> HttpStatusCode</span></span>
<span class="line"><span style="color: #5B5B5B">	OK </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">200</span></span>
<span class="line"><span style="color: #5B5B5B">	Created  </span><span style="color: #A1A1A1">// = 201</span></span>
<span class="line"><span style="color: #5B5B5B">	Accepted </span><span style="color: #A1A1A1">// = 202</span></span>
<span class="line"><span style="color: #5B5B5B">	MultipleChices </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">300</span></span>
<span class="line"><span style="color: #5B5B5B">	MovedPermanently </span><span style="color: #A1A1A1">// = 301</span></span>
<span class="line"><span style="color: #5B5B5B">	Found 			 </span><span style="color: #A1A1A1">// = 302</span></span>
<span class="line"><span style="color: #5B5B5B">	BadRequest </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">400</span></span>
<span class="line"><span style="color: #5B5B5B">	Unauthorized	 </span><span style="color: #A1A1A1">// = 401</span></span>
<span class="line"><span style="color: #5B5B5B">	PaymentRequired  </span><span style="color: #A1A1A1">// = 402</span></span>
<span class="line"></span></code></pre>
<p>Enumerations can have members of types other than <code>integer</code>, however, in this case all member values have to be explicitly specified:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">enumeration</span><span style="color: #5B5B5B"> Direction</span></span>
<span class="line"><span style="color: #5B5B5B">	Up </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">UP</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	Down </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">DOWN</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	Left </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">LEFT</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	Right </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">RIGHT</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="the-nothing-type-and-the-%3F-operator">The <code>nothing</code> type and the <code>?</code> operator <a class="header-anchor" href="#the-nothing-type-and-the-%3F-operator">§</a></h2>
<p>So far we've occasionally used the <code>nothing</code> keyword, but hadn't really got into the details of what it really is.</p>
<p><code>nothing</code> may look superficially similar to <code>null</code> in other languages. However, in Island <code>nothing</code> is not primarily a value, but a type.</p>
<p>Take for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> computeSomething</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> num</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// can also be written as &#39;integer?&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> num </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;nothing&#39; here acts somewhat like &#39;null&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> computeSomething</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type and value does &#39;x&#39; receive?</span></span>
<span class="line"></span></code></pre>
<p><code>return nothing</code> might seem like a value named <code>nothing</code> is being returned from the function (similarly to, say <code>return null</code> would in other languages). However, in practice, what is really happening is that <code>x</code> receives the type <code>nothing</code> which by default has <strong>a single empty value</strong> which is also called <code>nothing</code> (this behavior is similar to a concept known as the <strong>unit type</strong>).</p>
<p>Actions that don't return any value can be optionally annotated as returning <code>nothing</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printHelloWorld</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;nothing&#39; here acts like &#39;void&#39; in the C family of languages</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello World!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Trying the read the result of a method returning only <code>nothing</code> (either annotated as such or not) will fail, since the <code>nothing</code> type doesn't contain any useful information by itself:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> printHelloWorld</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: &#39;printHelloWorld()&#39; returns only &#39;nothing&#39;</span></span>
<span class="line"></span></code></pre>
<p>The <code>nothing</code> type is designed such that there is very little you can do with it. However, it is at times a very useful tool when defining optional parameters or capturing &quot;soft&quot; failures when returning from methods.</p>
<p>The question mark symbol (<code>?</code>) would modify a type to become a choice type including <code>nothing</code> as one of its options. It would work on any type, including a type that already is a choice type, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> Number </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> PossiblyNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Number? </span><span style="color: #A1A1A1">// PossiblyNumber = integer or decimal or nothing</span></span>
<span class="line"></span></code></pre>
<p>The <code>?</code> symbol can also be used in several other ways:</p>
<p>The <strong>null-conditional operator</strong> applies member access <code>?.</code>, index access <code>?[]</code> or method call <code>?()</code> only if the preceding expression fragment evaluates to a value that is not of type <code>nothing</code>, otherwise, the entire enclosing expression evaluates to <code>nothing</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Address</span></span>
<span class="line"><span style="color: #5B5B5B">	city: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	street: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	houseNumber: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	address: Address </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">	petNames: List&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Jimmy Jones</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, address </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B">, petNames </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> houseNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person.address?.houseNumber </span><span style="color: #A1A1A1">// houseNumber = nothing</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> firstPetName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> person.petNames?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// firstPetName = nothing</span></span>
<span class="line"></span></code></pre>
<p><em>Some notes on possible confusion with terminology used by other languages: In Island the unit type is called <code>nothing</code> and the bottom type is called <code>never</code> (introduced in a following chapter). In Scala the unit type is called <code>Unit</code> and the bottom type <code>Nothing</code>. However Haskell uses the term <code>Nothing</code> in its option type to represent the option of having &quot;No value&quot;, which is closer to the semantics intended here.</em></p>
</section>
<section>
<h2 id="the-any-type">The <code>any</code> type <a class="header-anchor" href="#the-any-type">§</a></h2>
<p>The <code>any</code> type (roughly representing the <strong>top type</strong>). It is equivalent to a choice type including of all the types in the language, except <code>nothing</code> and <code>never</code> (<code>any?</code> would include <code>nothing</code> as well) .</p>
<p>Note this is not the same as a dynamic type, because it requires an explicit type assertion or a cast in order to be used for any meaningful purpose:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> whatIsThis</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">any</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">integer!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">decimal!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">string!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">boolean!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> List&lt;</span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">list of booleans!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">I don&#39;t know?</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Assigning from a value having the <code>any</code> type could also be done using an explicit cast:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span></code></pre>
<p>However assigning a value of the wrong type would produce a compile or runtime error:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">hello</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> y: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">as</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="the-never-type">The <code>never</code> type <a class="header-anchor" href="#the-never-type">§</a></h2>
<p>The <code>never</code> type represents the result of a computation that either never terminates, or always fails:</p>
<p>For example, if a <code>for</code> loop, running inside a <code>function</code> context, does not alter any of its variables and does not have any stopping condition, it is guaranteed to never terminate, and consequently the function would never return!</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> neverEndingFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// never terminates!</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> neverEndingFunction</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type is x?</span></span>
<span class="line"></span></code></pre>
<p>In this case you may think the compiler should just raise an error (it will). However, <code>x</code> will also get the <code>never</code> type, which would be useful to allow more errors to be reported down the road.</p>
<p>Sometimes there are only particular cases where the function never returns:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> maybeNeverEndingFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> num &gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">continue</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> mysteryValue: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mysteryFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> maybeNeverEndingFunction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mysteryValue</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// what type is x?</span></span>
<span class="line"></span></code></pre>
<p>If <code>num &lt;= 0</code> the function would return immediately with the value <code>1</code>. However, when <code>num &gt; 0</code> it will never terminate.</p>
<p>So <code>x</code> receives the type <code>integer or never</code>, which roughly means &quot;if x has a value, it is of type <code>integer</code>, but it may also never get to the point where receives any value&quot;.</p>
<p>The <code>never</code> type is also known as the <strong>bottom type</strong>, meaning it is a type that has no values, and behaves somewhat like the empty set Ø.</p>
</section>
<section>
<h2 id="join-types">Join types <a class="header-anchor" href="#join-types">§</a></h2>
<p>A <strong>join type</strong> (also called an <strong>intersection type</strong>) allows combining multiple features in a convenient form:</p>
<p>If we wanted to write a function that accepts a parameter of a type implementing the two features <code>Named</code> and <code>Numbered</code> we could do something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Numbered</span></span>
<span class="line"><span style="color: #5B5B5B">	id: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> NamedAndNumbered </span><span style="color: #0059E8">extends</span><span style="color: #5B5B5B"> Named, Numbered</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeNamedAndNumbered</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value: NamedAndNumbered</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Using a join type, this can be shortened to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Named</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">feature</span><span style="color: #5B5B5B"> Numbered</span></span>
<span class="line"><span style="color: #5B5B5B">	id: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> giveMeNamedAndNumbered</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value: Named </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> Numbered</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="member-and-parameter-type-references">Member and parameter type references <a class="header-anchor" href="#member-and-parameter-type-references">§</a></h2>
<p>Object or tuple type references may include references to members, method parameter or return types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	data: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B">, id: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> processMe</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">someData: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, moreData: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: Set&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> n: Person.name </span><span style="color: #A1A1A1">// n receives the type string</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> d: Person.data[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// d receives the type boolean</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> id: Person.data.id </span><span style="color: #A1A1A1">// id receives the type string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> p: Person.processMe.params </span><span style="color: #A1A1A1">// p receives the tuple type (someData: integer, moreData: string)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> md: Person.processMe.moreData </span><span style="color: #A1A1A1">// md receieves the type string (might be a choice type if overloaded)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r: Person.processMe.</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r receives the type Set&lt;string&gt;</span></span>
<span class="line"></span></code></pre>
<p>Same for methods outside of a class:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> myFunc</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B">: List&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> t: myFunc.p1 </span><span style="color: #A1A1A1">// t gets the type (integer, boolean)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r: myFunc.p1.</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r gets the type List&lt;string&gt;</span></span>
<span class="line"></span></code></pre>
<p>Referring to the types of companion object members is possible through the <code>(object Type)</code> syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	bestPerson: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Cleopatra</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> best: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">object</span><span style="color: #5B5B5B"> Person</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.bestPerson </span><span style="color: #A1A1A1">// best receives the type string</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="higher-kinded-features">Higher-kinded features <a class="header-anchor" href="#higher-kinded-features">§</a></h2>
</section>
</section>
<section>
<h1 id="exception-handling">Exception handling <a class="header-anchor" href="#exception-handling">§</a></h1>
<section>
<h2 id="failure-types">Failure types <a class="header-anchor" href="#failure-types">§</a></h2>
<p>So far we've used <code>nothing</code> to represent failure cases, i.e. cases where the function doesn't succeed and instead returns an empty return value.</p>
<p>Sometimes we wish to be more specific and provide a more detailed report on what exactly went wrong. This is made possible by the <strong>failure type</strong>, which is a type representing a failed computation, and may also include further information.</p>
<p>Consider this case:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// What should be the type of &#39;r&#39;?</span></span>
<span class="line"></span></code></pre>
<p>One approach would be to return <code>nothing</code> when <code>y</code> is 0:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, someInt</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;r1&#39; gets type integer or &#39;nothing&#39;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;r2&#39; gets type &#39;nothing&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: &#39;r1&#39; may be of type &#39;nothing&#39;!</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: &#39;r2&#39; is of type &#39;nothing&#39;!</span></span>
<span class="line"></span></code></pre>
<p>However, that would mean that in every computation done with <code>divide</code> we would have to use a type assertion to check if the result type is not <code>nothing</code> and then proceed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r3</span></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> r1 </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">	r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span></span>
<span class="line"></span></code></pre>
<p>Alternatively, the <strong>Failure type</strong> is a special type designated to represent failures.</p>
<p>Island has two approaches to using the failure type:</p>
<ol>
<li>Returned directly from a method, as a part of a choice type, and then optionally assert on through the returned value. This is the only approach permittable for a function.</li>
<li>Use the <code>fail</code> statement to raise an exception, together with a <code>try</code>..<code>detect</code> block to capture the error in a caller scope. This is only possible in action scopes.</li>
</ol>
</section>
<section>
<h2 id="returning-the-failure-type-from-a-method">Returning the failure type from a method <a class="header-anchor" href="#returning-the-failure-type-from-a-method">§</a></h2>
<p>The failure type possesses a special &quot;vanishing&quot; quality when included inside of a choice type. If the choice type contains only a single type that is not of type <code>Failure</code> then no assertion is needed for the variable to be used as if it could only have that type.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Divide by zero!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, someInt</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;r1&#39; gets type &#39;integer (or Failure&lt;string&gt;)&#39;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B">ide</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;r2&#39; gets type &#39;Failure&lt;string&gt;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Works! no type assertion needed!</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> r4 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> r2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Error: &#39;r2&#39; is of type &#39;Failure&lt;string&gt;&#39;</span></span>
<span class="line"></span></code></pre>
<p>Note that if the result of the operation is immediately unpacked, the failure can still be asserted for any one of the unpacked variables:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> getKeyOrFail</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">key: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, dict: </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">age: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, bestFriend: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">})</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">when</span><span style="color: #5B5B5B"> key </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> dict </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; dict[key]</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Key &#39;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">key</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">&#39; not found!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> someDictionary </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Linda</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Mary</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">,  </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alan</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">34</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anton</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">age, bestFriend</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getKeyOrFail</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, someDictionary</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> age </span><span style="color: #0059E8">is</span><span style="color: #5B5B5B"> Failure</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Couldn&#39;t find </span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631"> in the dictionary!: </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age </span><span style="color: #0059E8">as</span><span style="color: #AA6631"> Failure&lt;</span><span style="color: #0059E8">string</span><span style="color: #AA6631">&gt;</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="using-try..detect-(action-scopes-only)">Using <code>try</code>..<code>detect</code> (action scopes only) <a class="header-anchor" href="#using-try..detect-(action-scopes-only)">§</a></h2>
<p>The second approach, available only in action scopes (due to its reliance on side-effects), uses a <code>try</code>..<code>detect</code> block and behaves very similarly to <code>try</code>..<code>catch</code> in mainstream imperative languages:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> readLineFromFile</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f: File</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> f.exists</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">fail</span><span style="color: #5B5B5B"> IOFailure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">File not found</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> f.ReadLine</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> example</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f: File</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> line </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readLineFromFile</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">f</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">line</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">detect</span><span style="color: #5B5B5B"> failure: IOFailure</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">failure.message</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="patterns-and-parsers">Patterns and parsers <a class="header-anchor" href="#patterns-and-parsers">§</a></h1>
<section>
<h2 id="pattern-methods">Pattern methods <a class="header-anchor" href="#pattern-methods">§</a></h2>
<p>We've previously introduced a syntax for list, tuple and object patterns, which can be used for pattern matching in conditional statements and expressions, such as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> myList</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> head &lt; </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, ...]</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">25</span><span style="color: #5B5B5B">, ..., </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> last]</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">here</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> ...tail]</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> first &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> ...rest]</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [..., </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> v &gt; </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ...]</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p><strong>Pattern methods</strong> generalize over this feature, and allow to define arbitrary pattern recognizers via special-purpose subroutine-like helpers.</p>
<p>Pattern methods can also be used as a full replacement for string regular expressions.</p>
<p>For instance, we'll look at a regular expression that captures a phone number pattern. Conventionally we'll define something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/^</span><span style="color: #5B5B5B">[\</span><span style="color: #000000">+</span><span style="color: #5B5B5B">]?[ ]?</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]?[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">[ ]?\</span><span style="color: #B43AFF">((</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">\</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">[ ]?</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">\</span><span style="color: #000000">-</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">$</span><span style="color: #000000">/</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Example matching string: &quot;+1 (534) 953-6345&quot;</span></span>
<span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">800</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> lineNumber</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>With a pattern method, we could instead write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> PhoneNumberPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">800</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> lineNumber</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>Where <code>PhoneNumberPattern</code> would be a pattern method defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> PhoneNumberPattern</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">countryCode, areaCode, prefix, lineNumber</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">+</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	countryCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">(</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	areaCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept optional</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	prefix </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	lineNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Digit, </span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span></code></pre>
<p>A pattern method is written similarly to a standard method only it employs the <code>accept</code> keyword which implicitly &quot;advances&quot; the recognizer whenever a pattern is matched:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">.... </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> .... </span><span style="color: #A1A1A1">// Require the next member of the stream to match the given pattern and return it</span></span>
<span class="line"><span style="color: #5B5B5B">.... </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept optional</span><span style="color: #5B5B5B"> ....  </span><span style="color: #A1A1A1">// Try to match the given pattern and return it, or skip if failed</span></span>
<span class="line"><span style="color: #0059E8">accept end</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Accept only if the stream ended</span></span>
<span class="line"></span></code></pre>
<p>In the above example, <code>Repeated</code> and <code>Digit</code> are references to secondary pattern methods.</p>
<p><code>Digit</code> can be defined as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> Digit</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	value </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">0</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">1</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">2</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">3</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">4</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">6</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">7</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">8</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">9</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">}</span></span>
<span class="line"></span></code></pre>
<p><code>accept if ....</code> will accept only if the given condition is satisfied. The <code>it</code> keyword represents the target captured value (in <code>string</code> it defaults to a single character). In general in <code>accept &lt;pattern&gt; if it ....</code> <code>it</code> would represent the subsequence captured by the pattern.</p>
<p><code>Repeated</code> is a more complex, higher-order pattern method parameterized over any underlying pattern, as well as for any stream type (which includes strings). Its implementation is included in a future section about abstract patterns.</p>
</section>
<section>
<h2 id="transactional-execution">Transactional execution <a class="header-anchor" href="#transactional-execution">§</a></h2>
<p>The <code>try</code>... <code>else try</code>...<code>else</code> block enables a limited form of <strong>transactional execution</strong> where multiple branches are attempted in turn until one of them succeeds (or otherwise the input is rejected). Whenever a rejection occurs within a branch, its assignments are rolled back.</p>
<p>Here's an illustrative example which will recognize and parse a date with any one of <code>&quot;/&quot;</code>, <code>&quot;-&quot;</code> or <code>&quot;.&quot;</code> as separator characters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> Date</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Will recognize a date like &quot;21/5/1999&quot; or &quot;13-7-2020&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	day </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">31</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	year </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Date </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> year </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2005</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
<p>Pattern methods can recognize and parse patterns that go well beyond the constraints of regular languages.</p>
<p>We could rewrite the previous example such that the pattern method would be parameterized by an arbitrary set of separator characters:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> Date</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">seperatorCharacterSet: Set&lt;</span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	day </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">31</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> seperator </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> seperatorCharacterSet</span></span>
<span class="line"><span style="color: #5B5B5B">	month </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> separator </span><span style="color: #A1A1A1">// The accepted character must be the same as the one previously captured</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	year </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> Date</span><span style="color: #B43AFF">({</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">/</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">-</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">})</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">12</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> year </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2005</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="patterns-in-non-character-streams">Patterns in non-character streams <a class="header-anchor" href="#patterns-in-non-character-streams">§</a></h2>
<p>Pattern methods can be used for arbitrary streams. Here it is used to recognize patterns in sequences of various types:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Recognizes a sequence of exactly three primes p1, p2, p3</span></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> ThreePrimes</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">3</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Recognizes 2, 4, 6, 8, 10, ....</span></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> EvenNaturalNumberSeries</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbers </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">n </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.. </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> n </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; n</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> evenNumbers</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Recognizes a stream of ascending twin prime tuples like:</span></span>
<span class="line"><span style="color: #A1A1A1">// (3, 5), (5, 7), (11, 13), (29, 31), ....</span></span>
<span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> IntegerPair </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, second: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> TwinPrimesSequence</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;IntegerPair&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> TwinPrimes </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;IntegerPair&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.second </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.first </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.first</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.second</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> previousLowPrime </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p1, _</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> TwinPrimes </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">.first &gt; previousLowPrime</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> previousLowPrime </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> p1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">accept end</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">break</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="lookahead">Lookahead <a class="header-anchor" href="#lookahead">§</a></h2>
<p>Sometimes it is useful to &quot;peek&quot; on one or more upcoming elements of the stream without advancing its position.</p>
<p>The <code>expect</code> keyword acts similarly to <code>accept</code>, only without advancing the current position in the stream.</p>
<p>For example in order to define a pattern that parses the content of a simplified HTML <code>&lt;title&gt;</code> element:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> TitleXMLElement</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">&lt;title&gt;</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">repeat</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">&lt;/title&gt;</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">break</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// break out of the loop without advancing the read position</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Letter</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">&lt;/title&gt;</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// since the stream position has not advanced, this should always succeed</span></span>
<span class="line"></span></code></pre>
<p>More generally, this approach can be used to define a pattern which would accept anything until a stop pattern is encountered. This example relies on a higher-order pattern, which is introduced in the next section:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> AnythingUntil&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">StopPattern: </span><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">results: List&lt;T&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">repeat</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> StopPattern</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">break</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// break out of the loop without advancing the read position</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			results </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">any</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// &#39;results&#39; acts similarly to a named return variable</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// It can be incrementally updated,</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #A1A1A1">// However, it can only be read when assigned back to itself</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="abstract-and-higher-order-patterns">Abstract and higher-order patterns <a class="header-anchor" href="#abstract-and-higher-order-patterns">§</a></h2>
<p>The <code>match</code> syntax can also apply to abstract pattern types.</p>
<p>An abstract pattern may be expressed using a polymorphic type signature like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> MyAbstractPattern </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">pattern</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"></span></code></pre>
<p>And then can be used to parameterize a function over any pattern that matches a given type signature. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> recognizeThis</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">str: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, p: MyAbstractPattern, expectedValues: </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">boolean</span><span style="color: #B43AFF">))</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> p </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> expectedValues:</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> MyPattern</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value, ok</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	value </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> IntegerNumber</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631"> </span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Yes</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		ok </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">No</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		ok </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">recognizeThis</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">42 Yes</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, MyPattern, </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">42</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">recognizeThis</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">10 No</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, MyPattern, </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">))</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// returns false</span></span>
<span class="line"></span></code></pre>
<p>Here's an implementation of the <code>Repeated</code> pattern mentioned in a previous section. It defines a higher-order pattern accepting an abstract pattern of polymorphic type.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> AnyPattern&lt;T&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">pattern</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> Repeated&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p: AnyPattern&lt;T&gt;, minTimes: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, maxTimes: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">results: List&lt;T&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> minTimes </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..minTimes</span></span>
<span class="line"><span style="color: #5B5B5B">			results </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> p</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> _ </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> minTimes..maxTimes</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">			results </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> p</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">break</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> Repeated&lt;T&gt;</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p: AnyPattern&lt;T&gt;, times: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">results: List&lt;T&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> []</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Stream&lt;T&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	results </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> Repeated</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">p, times, times</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="unpacking-through-a-pattern-method">Unpacking through a pattern method <a class="header-anchor" href="#unpacking-through-a-pattern-method">§</a></h2>
<p>Since pattern methods may reject some inputs, it is not possible to directly unpack via a pattern, say, with this kind of hypothetical syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5/11/1972</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">Date </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> str </span><span style="color: #A1A1A1">// What would be assigned if the string is rejected?</span></span>
<span class="line"></span></code></pre>
<p>Instead, the <code>matches</code> operator, which was mentioned in a previous chapter, allows to conditionally &quot;unpack&quot; through the pattern, as well as safely handle the case where the input is rejected:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> str </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5/11/1972</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> str </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> Date </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">day, month, year</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="wrapping-pattern-expressions-in-pattern-methods">Wrapping pattern expressions in pattern methods <a class="header-anchor" href="#wrapping-pattern-expressions-in-pattern-methods">§</a></h2>
<p>A simple pattern expression, like one that's used in <code>match</code> statements and expressions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> first &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> ...rest]</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>can be made reusable by wrapping it in a pattern method:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> SomeListPattern</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, second, rest</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt; </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// note the &#39;=&#39; operator</span></span>
<span class="line"><span style="color: #5B5B5B">	[first &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, second </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> first, ...rest]</span></span>
<span class="line"></span></code></pre>
<p>and then applied via its method name and signature:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> SomeListPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, second, rest</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="patterns-in-non-stream-inputs">Patterns in non-stream inputs <a class="header-anchor" href="#patterns-in-non-stream-inputs">§</a></h2>
<p>The previous section suggests pattern methods may also describe simpler patterns, which could accept non-stream inputs like tuples, objects, or even unary values like integers or decimals, as well, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> SuccessiveNumbers</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, second</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	[first, second </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>Or even:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> EvenNumber</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"></span></code></pre>
<p>We can extend conventional pattern methods to support this as well, but that would mean there would only one <code>accept</code> or <code>reject</code> statement allowed (since there is only one input value):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> SuccessiveNumbers</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, second</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, second</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span></code></pre>
<p>Here's a pattern method that tests if a number is a composite (non-prime) and captures its prime factors:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> CompositeNumber</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">primeFactors, isHighlyComposite</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> number </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> </span><span style="color: #000000">not</span><span style="color: #5B5B5B"> isPrime</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">it</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	primeFactors </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getPrimeFactors</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	isHighlyComposite </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> isHighlyComposite</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> printPrimalityInfo</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> someNumber: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> PrimeNumber</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Prime!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> CompositeNumber </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> factors, </span><span style="color: #0059E8">false</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Composite! with prime factors </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">factors</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// (CompositeNumber pattern doesn&#39;t need to be recomputed since previous result is cached)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> CompositeNumber </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> factors, </span><span style="color: #0059E8">true</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Highly composite! with prime factors </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">factors</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">printPrimalityInfo</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">97</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Prime!&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">printPrimalityInfo</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">100</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Composite! with prime factors 2, 5&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">printPrimalityInfo</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">60</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Highly composite! with prime factors 2, 3, 5&quot;</span></span>
<span class="line"></span></code></pre>
<p>Now there may be times where we wish to apply this kind of simple unary pattern matching to input types that are conventionally interpreted as streams, like <code>string</code>s, <code>List</code>s or even abstract <code>Stream&lt; &gt;</code> objects. For these cases, <code>accept all</code> enables the entire (or remaining) input to be captured all at once:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> FirstCharacterSameAsLast</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">first, last</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Accept when string is empty</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">accept end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		first </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">		last </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">try</span></span>
<span class="line"><span style="color: #5B5B5B">		[first, ..., last] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">accept all</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// The entire string is consumed here</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Reject if first and last characters don&#39;t match</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> first </span><span style="color: #000000">!=</span><span style="color: #5B5B5B"> last</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">reject</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="logic-programming">Logic programming <a class="header-anchor" href="#logic-programming">§</a></h1>
<section>
<h2 id="relations%2C-facts-and-rules">Relations, facts and rules <a class="header-anchor" href="#relations%2C-facts-and-rules">§</a></h2>
<p>Island provides a statically typed logic programming system integrating closely with the rest of the language.</p>
<p>The <code>relation</code> declaration defines a relation, which, in a sense, expands over the concept of a function and provides a way to express and query multi-directional dependencies between its parameters (also referred to as <em>terms</em>).</p>
<p>With respect to its output, a relation is, in practice, a lot like a stream method yielding a sequence of tuples where each tuple in the sequence represent a satisfying assignment for its terms.</p>
<p>A <code>relation fact</code> statement defines a fact, which is like an axiom containing a combination of term values that is always true.</p>
<p>A <code>relation rule</code> defines a conjunction of one or more clauses (also called goals) where a set of input arguments (which may be either assigned or unassigned) are flowed through them. If a goal cannot be satisfied with the given arguments the inference engine backtracks to the previous goal and proceeds with its next satisfying assignment. This continues either until the final goal is satisfied or all the possible alternatives are exhausted.</p>
<p>Here's the classic parent-siblings example expressed in Island's logic programming syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">class</span><span style="color: #5B5B5B"> Family</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Parent</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Tom</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Siblings</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sibiling1: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, sibling2: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Parent</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> someParent, sibling1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">someParent, sibling2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			NotEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> family </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Family</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Remember that since Parent returns a stream</span></span>
<span class="line"><span style="color: #A1A1A1">// Getting its first result would require stepping once through the stream</span></span>
<span class="line"><span style="color: #A1A1A1">// The &#39;exists&#39; expansion property returns true if a stream yields at least one value</span></span>
<span class="line"><span style="color: #A1A1A1">// The &#39;first&#39; expansion property returns the first value yielded</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Angela</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first </span><span style="color: #A1A1A1">// returns (&quot;Alice&quot;, &quot;Angela&quot;)</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">family.Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">John</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?.parent </span><span style="color: #A1A1A1">// returns &quot;Tom&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> family.Siblings</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, ?</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">(</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">sibling1</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">sibling2</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// prints &quot;(James, Angela)&quot;, &quot;(Angela, James)&quot;</span></span>
<span class="line"></span></code></pre>
<p><em>(Note that the order of <code>sibling1</code> and <code>sibling2</code> is significant for the inference engine - since it has no way to know the <code>Sibling</code> relation is symmetric - the results included what appears like duplicates, in the next example we'll apply <code>.distinctUnorderedPairs()</code> on the result sequence to filter out the duplicates)</em></p>
<p>A relation's fact database may be non-destructively altered using the <code>with</code> operator, applied over the containing object:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> alteredFamlily </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> family </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Lea</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Chris</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> Parent</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Alice</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">James</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sibling1, sibling2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> alteredFamlily.Siblings</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.distinctUnorderedPairs</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">(</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">sibling1</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">sibling2</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// prints &quot;(Angela, Lea)&quot;, &quot;(Angela, Chris)&quot;, &quot;(Lea, Chris)&quot;</span></span>
<span class="line"></span></code></pre>
<p>Here is factorial defined as a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Factorial</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, result: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		Subtraction</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> previousNumber</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		Factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">previousNumber, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> previousFactorial</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		Product</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, previousFactorial, result</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;(5, 120)&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first.result</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;120&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Since Factorial is a relation we could potentially query for any one of its parameters</span></span>
<span class="line"><span style="color: #A1A1A1">// Here we&#39;ll query which number has the factorial of 5040</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #E65C00">5040</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;(7, 5040)&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Factorial</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #E65C00">5040</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?.number</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Prints &quot;7&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="relation-predicates%2C-functions-and-streams">Relation predicates, functions and streams <a class="header-anchor" href="#relation-predicates%2C-functions-and-streams">§</a></h2>
<p>In order to express numeric relations like <code>GreaterThan</code>, <code>Subtraction</code> and <code>Product</code> we will need some means to link relations with plain functions:</p>
<ul>
<li>The <code>predicate</code> declaration defines a simple predicate function returning <code>true</code> or <code>false</code>.</li>
<li>The <code>function</code> declaration defines a simple function returning a tuple representing a single term assignment</li>
<li>The <code>stream</code> declaration defines a stream method yielding a sequence of term assignments.</li>
<li>Every relation method parameter must be annotated as either <code>in</code> or <code>out</code>, where <code>in</code> parameter must be returned unmodified in the resulting tuple and <code>out</code> parameters must receive a value.</li>
</ul>
<p>For example, here's how the <code>GreaterThan</code> relation is defined. There are several overloads defined for different combinations of input and output terms (modified by <code>in</code> and <code>out</code> respectively):</p>
<p>The <code>(in, in)</code> overload, in which both terms are known values is implemented using a predicate function, simply tests whether the first term is greater than the second one:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> GreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num1 &gt; num2</span></span>
<span class="line"></span></code></pre>
<p>The <code>(in, out)</code> overload, in which the first term is a value and the second unknown, defines a stream method yielding a sequence of tuples where the first element is always (and must always be!) <code>num1</code> and the second enumerates all the values smaller than <code>num1</code>.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> GreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1, i</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// yields (num1, num1 - 1), (num1, num1 - 2), (num1, num1 - 3), ...</span></span>
<span class="line"></span></code></pre>
<p>The <code>(out, in)</code> overload defines a stream method yielding a sequence of tuples where the first element enumerates all the values greater than <code>num2</code> and the second is always <code>num2</code>.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> GreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i, num2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// yields (num2 + 1, num2), (num2 + 2, num2), (num2 + 3, num2), ...</span></span>
<span class="line"></span></code></pre>
<p>Since <code>in</code> parameters are always returned as-is in the resulting tuple, we can avoid stating them in the <code>yield</code> statement by using <code>continue</code>- like syntax, which allows omitting arguments that were not assigned by the function. The following is equivalent:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> GreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> i </span><span style="color: #A1A1A1">// implicitly equivalent to yielding the tuple (num1, i)</span></span>
<span class="line"></span></code></pre>
<p><em>(An <code>(out, out)</code> overload might also be defined, in theory, though it would be significantly more challenging to implement as it would need to somehow &quot;fairly&quot; cover all possible combinations of two integers where the first one is greater than the second)</em></p>
<p>Here's how the <code>Subtraction</code> relation is defined:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Subtraction</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> num2 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> difference</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1, num2, num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> num2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1, num1 </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> num2, num2, difference</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// For illustration, here&#39;s a stream method defined for the more complex</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// case where both num1 and num2 are unknowns:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">stream</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> num2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> difference: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// yield the case for num1 == 0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// Alternate between positive and negative values for num1</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">i, i </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">yield</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #5B5B5B">i, </span><span style="color: #000000">-</span><span style="color: #5B5B5B">i </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> difference, difference</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// For the case where difference = 2 this would yield:</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #A1A1A1">// (0, -2, 2), (1, -1, 2), (-1, -3, 2), (2, 0, 2), (-2, -4, 2), ....</span></span>
<span class="line"></span></code></pre>
<p>The <code>if</code> keyword allows branch-like functionality for relation blocks:</p>
<p>Here's the infamous &quot;Fizz-Buzz&quot; problem, this time implemented using a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Divides</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> x, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> y</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> FizzBuzz</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, output: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		InRange</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">15</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> Divides</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index, </span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">output, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">index</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Buzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span></span>
<span class="line"><span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?.output </span><span style="color: #A1A1A1">// returns &quot;FizzBuzz&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">FizzBuzz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">_, str</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, ?</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">str</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints &quot;1&quot;, &quot;2&quot;, &quot;Fizz&quot;, &quot;4&quot;, &quot;Buzz&quot;, &quot;Fizz&quot; ....</span></span>
<span class="line"></span></code></pre>
<p><code>if</code> blocks also handle cases where the conditional cannot be resolved:</p>
<p>For example, in the case where <code>FizzBuzz(?, &quot;Fizz&quot;)</code> is queried, since <code>index</code> isn't bound to anything on the <code>if</code> conditional, the inference engine unconditionally evaluates the branch, as well as any other unresolvable conditional branches, which in this example includes all of them (the <code>otherwise</code> branch is considered unresolvable as well):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index, _</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> FizzBuzzer.FizzBuzz</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Fizz</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">index</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints 3, 6, 9, 12, 18, 21, ....</span></span>
<span class="line"></span></code></pre>
<p>Here's the absolute value implemented as a relation using an <code>if</code> conditional:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Abs</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, abs: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> GreaterThanOrEquals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, abs</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			Negation</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> negation</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">abs, negation</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">Abs</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">100</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span></span>
<span class="line"><span style="color: #5B5B5B">Abs</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">65</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">Abs</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">65</span><span style="color: #5B5B5B">, ?</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?.abs </span><span style="color: #A1A1A1">// returns 65</span></span>
<span class="line"><span style="color: #5B5B5B">Abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, </span><span style="color: #E65C00">65</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?.number </span><span style="color: #A1A1A1">// returns -65</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// This will query for any two numbers where the second is the absolute value of the first:</span></span>
<span class="line"><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">number, abs</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> Abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, ?</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">(</span><span style="color: #B43AFF">{</span><span style="color: #AA6631">number</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">, </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">abs</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">)</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// prints &quot;(0, 0)&quot;, &quot;(-1, 1)&quot;, &quot;(1, -1)&quot;, &quot;(-2, 2)&quot;, ....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// (As a heuristic, the inference engine alternates between the unresolvable conditional</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// branches to avoid getting &quot;trapped&quot; in case one of them produces an infinite</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// amount of results)</span></span>
<span class="line"></span></code></pre>
<p>Sometimes we would like to iterate over <strong>all</strong> the possible results of a relation. A common case would be when asserting over a property of a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> MemberOf</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> member, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; list.includes</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">member</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> member, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> x </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, list</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, smallerValue: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		foreach MemberOf</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> member, list</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">member, smallerValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns false</span></span>
<span class="line"><span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], </span><span style="color: #000000">-</span><span style="color: #E65C00">5</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"></span></code></pre>
<p>It would be interesting to consider the query <code>AllMembersGreaterThan([3, 2, 4, 5], ?)</code>, which asks for one or more values that are smaller than all the elements of the list.</p>
<p>Let's consider the execution of:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">AllMembersGreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">], ?</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>If we were to unroll the <code>foreach</code> loop to multiple steps it would look somewhat like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Produces 2, 1, 0, -1, -2, -3, .... for smallerValue</span></span>
<span class="line"><span style="color: #5B5B5B">GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">GreaterThan</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, smallerValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Once <code>smallerValue</code> receives a value in <code>GreaterThan(3, ?)</code> the next evaluations of <code>GreaterThan</code> test for that value. If it doesn't satisfy them, the inference engine backtracks until a value for <code>smallerValue</code> is found that satisfies all the members (i.e. in this case <code>1</code>, which is smaller than all the members).</p>
<p>As you may notice this is a highly inefficient way to calculate this! Consider the case where <code>list = [3, 2, 4, -1000000]</code>. It would require more than one million backtracking attempts to find the first satisfying result <code>-1000001</code>!</p>
<p>A more efficient way would be to to define an overload based on a <code>relation function</code> that quickly finds the minimum of the list and yields all the values smaller than it:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> smallerValue: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">list.minimum</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">..</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #0059E8">infinity</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">list, i</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Note that to ensure that the <code>(in, out)</code> case is never processed by the slower, backtracking-based overload, its <code>smallerValue</code> parameter can be marked as <code>in</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> list: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> smallerValue: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>In the next section we'll show a purely rule-based way to efficiently implement the <code>AllMembersGreaterThan</code> relation, which makes use of the <code>reduce</code> higher-order relation.</p>
</section>
<section>
<h2 id="higher-order-relations">Higher-order relations <a class="header-anchor" href="#higher-order-relations">§</a></h2>
<p>Just like functions can accept other functions as arguments, we can define relations that accept other relations as arguments:</p>
<p>Here's an implementation of the <code>map</code> function, generalized to a relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Mapped&lt;E, R&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> MappingRelation </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">relation</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">value: E, resultValue: R</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[], [], ?</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[head, ...tail]: List&lt;E&gt;, [resultHead,...resultTail]: List&lt;R&gt;, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> mappingRelation: MappingRelation</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		mappingRelation</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">head, resultHead</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">tail, resultTail</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Here's an example that represents a mapping between one list to a second list containing its members' preceding values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Successor</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">predicate</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; x </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">x, y </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> x: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> y: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">y </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, y</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #5B5B5B">Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l1, l2, Successor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.exists </span><span style="color: #A1A1A1">// returns true</span></span>
<span class="line"><span style="color: #5B5B5B">Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l1, ?, Successor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first </span><span style="color: #A1A1A1">// returns ([2, 3, 4, 5], [1, 2, 3, 4], Successor)</span></span>
<span class="line"><span style="color: #5B5B5B">Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">l1, ?, Successor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [1, 2, 3, 4]</span></span>
<span class="line"><span style="color: #5B5B5B">Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, l2, Successor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [2, 3, 4, 5]</span></span>
<span class="line"><span style="color: #5B5B5B">Mapped</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">?, l1, Successor</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.first?[</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// returns [3, 4, 5, 6]</span></span>
<span class="line"></span></code></pre>
<p>Here's <code>reduce</code> expressed as a higher order relation:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> Reduced&lt;E, R&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">type</span><span style="color: #5B5B5B"> ReducingRelation </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">relation</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> element: E, </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> currentResult: R, newResult: R</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[], </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">nothing</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> [head, ...tail]: List&lt;E&gt;,</span></span>
<span class="line"><span style="color: #5B5B5B">		  </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> reducer: ReducingRelation,</span></span>
<span class="line"><span style="color: #5B5B5B">		  </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> initialResult: R,</span></span>
<span class="line"><span style="color: #5B5B5B">		  result: R</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		reducer</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">head, initialResult, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> newResult</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">tail, []</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">result, newResult</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			Reduced</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">tail, reducer, newResult, result</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Using the <code>reduced</code> relation we now can provide a more efficient rule-based implementation for <code>AllMembersGreaterThan</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> MinimumOf2</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">val1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, val2: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, minimum: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> SmallerOrEqual</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">val1, val2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">minimum, val1</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			Equals</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">minimum, val2</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> SmallestValue</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">fact</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">[], </span><span style="color: #0059E8">nothing</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, smallestValue: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		Reduced</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values, MinimumOf2, </span><span style="color: #0059E8">infinity</span><span style="color: #5B5B5B">, smallestValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">relation</span><span style="color: #5B5B5B"> AllMembersGreaterThan</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">rule</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, smallerValue: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		SmallestValue</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">list, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> smallestValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		SmallerThan</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">smallestValue, smallerValue</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="immutability-and-determinism-in-the-logic-programming-subsystem">Immutability and determinism in the logic programming subsystem <a class="header-anchor" href="#immutability-and-determinism-in-the-logic-programming-subsystem">§</a></h2>
<p>Relations are fully immutable. A rule's arguments can be either assigned (meaning they are bound to a concrete value) or unassigned. If they are assigned they cannot accept a new value (there's simply no mechanism to do that) and if they are unassigned they can only be assigned once by a subgoal.</p>
<p>Determinism (which is related to the property of referential transparency), means that an invocation of a relation with the same arguments would always yield the same results, and in the same order. Determinism is preserved since:</p>
<ul>
<li>There is no <code>action relation</code>. Relations do not have any side-effects.</li>
<li>Objects containing relations cannot be modified in-place. Facts cannot be added or removed from a relation unless the object is copied first (as is done with the <code>with</code> operator).</li>
<li>The inference engine is designed to always perform the search in the same order (even if the search is parallelized), so given the same clauses and fact database, it would always produce identical results (more specifically, it is meant that it would produce the same results <strong>for a given runtime session</strong>, changes in the ordering of declarations or files, or different versions of the compiler, might cause variations in the ordering).</li>
</ul>
</section>
</section>
<section>
<h1 id="knowledge-driven-programming">Knowledge-driven programming <a class="header-anchor" href="#knowledge-driven-programming">§</a></h1>
<section>
<h2 id="introduction-1">Introduction <a class="header-anchor" href="#introduction-1">§</a></h2>
<p><strong>Knowledge-driven programming</strong> is a form of declarative programming where programs are structured around semantically encoded information entities, rather than computations. It does not involve conventional subroutines (i.e. named functions or relations). Instead, knowledge-driven programs specify general inference rules describing methods for generating new knowledge from existing knowledge.</p>
<p>Knowledge-driven programs (or program subsets, if within a hybrid language) are synthesized by composing a computational graph mapping an initial set of known information entities to a target set of unknown information entities.</p>
<p>Unlike logic programs, knowledge-driven programs don't involve any runtime search. All <strong>planning and synthesis is done at compile-time</strong>, such that the resulting runtime code can be optimized to run at a performance closer to the machine's native capabilities.</p>
</section>
<section>
<h2 id="contexts%2C-properties-and-mappings">Contexts, properties and mappings <a class="header-anchor" href="#contexts%2C-properties-and-mappings">§</a></h2>
<p>A knowledge-driven program consists of contexts, properties and mapping rules.</p>
<p>A <strong>context</strong> is a knowledge schema in which information entities (properties) and inference rules (mappings) can be defined.</p>
<p>A <strong>property</strong> is an information entity representing a unique semantic identity.</p>
<p>A <strong>mapping rule</strong> is an unnamed inference rule specifying a method for deriving one or more unknown properties from one or more known properties, within a given context.</p>
<p>A <strong>context instance</strong> (also called a <strong>knowledge scope</strong>) is a materialized form of a context, analogous to how an object is a materialized form of a class. A context instance can be viewed as a simple immutable knowledge base. It can be initialized with a set of known property values, and then queried for unknown ones.</p>
<p>For example, this context describes the basic kinematic relations between distance, time and speed.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	time: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> time, speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; time </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	time </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> distance, speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	speed </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> distance, time </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span></code></pre>
<p><code>.... given ....</code> defines a mapping rule that specifies a method for a property to be computed given the knowledge of the values of other properties.</p>
<p>If the set of required properties can be automatically inferred from the body of the rule, the <code>given</code> clause may be omitted:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	time: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; time </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	time </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span></code></pre>
<p>A context may be instantiated similarly to a class, though unlike a class, it has no minimal set of required members. All of its properties are effectively &quot;optional&quot;, in a sense, as they may be either provided or inferred using one or more of its mapping rules (or alternatively, they may not be knowable at all - yet the instantiation would still be perfectly valid).</p>
<p>We'll instantiate the <code>BasicKinematics</code> context with values for <code>distance</code> and <code>time</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> kinematics </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> BasicKinematics </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"></span></code></pre>
<p>Once instantiated, its properties may be referenced directly, as if they were values. We'll query for the <code>speed</code> property:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.speed </span><span style="color: #A1A1A1">// &#39;speed&#39; gets the value 2.0</span></span>
<span class="line"></span></code></pre>
<p>Despite the fact that no value was provided for <code>speed</code>, the compiler was able to locate a set of mapping rules that enabled it to be computed, given the information we provided (here <code>distance</code> and <code>time</code>). The details of the particular rules the compiler selects are not a part of the program itself. The compiler may choose any rules it decides on, including rules the programmer is not aware of.</p>
<p>In this case, only one simple rule was needed:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span></code></pre>
<p>However, consider a slightly more complex case, where an additional property is introduced:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	time: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Assume this property is measured in meters per seconds</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInMph: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; time </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	time </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"><span style="color: #5B5B5B">	speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	speedInMph </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; speed </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span></span>
<span class="line"><span style="color: #5B5B5B">	speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; speedInMph </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span></span>
<span class="line"></span></code></pre>
<p>Now querying for <code>speedInMph</code></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> kinematics </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> BasicKinematics </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.speedInMph </span><span style="color: #A1A1A1">// &#39;speed&#39; gets the value 4.47388</span></span>
<span class="line"></span></code></pre>
<p>requires two rules:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time </span><span style="color: #A1A1A1">// speed = 2.0</span></span>
<span class="line"><span style="color: #5B5B5B">speedInMph </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; speed </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// speedInMph = 4.47388</span></span>
<span class="line"></span></code></pre>
<p>So far, this may not look much different than computed fields, albeit with the ability to define distinct computations for different combinations of known and unknown properties. In the next sections we'll introduce the concepts of embeddings, preconditions and semantic associations, which should demonstrate how its capabilities go well beyond being just a form of &quot;computed fields on steroids&quot;.</p>
</section>
<section>
<h2 id="context-embedding">Context embedding <a class="header-anchor" href="#context-embedding">§</a></h2>
<p>At the end of the previous section we've mentioned the notion of describing speed in a unit other than the default (say, in miles per hour instead of meters per second).</p>
<p>If we wanted to include additional measurement units, we could add more properties and mapping rules to <code>BasicKinematics</code>, but that wouldn't be a good style.  Instead, it would be better to define a new context dedicated only for speed units, for example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Speed</span></span>
<span class="line"><span style="color: #5B5B5B">	metersPerSecond: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	milesPerHour: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	kilometersPerHour: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; milesPerHour </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span></span>
<span class="line"><span style="color: #5B5B5B">	milesPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; metersPerSecond </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span></span>
<span class="line"><span style="color: #5B5B5B">	metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; kilometersPerHour </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">6</span></span>
<span class="line"><span style="color: #5B5B5B">	kilometersPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; metersPerSecond </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">6</span></span>
<span class="line"></span></code></pre>
<p>But now we need some way to &quot;combine&quot; the knowledge we've expressed in this secondary context with the one in <code>BasicKinematics</code>.</p>
<p>We can do that by embedding <code>Speed</code> inside of <code>BasicKinematics</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	time: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: Speed</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; time </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> speed.metersPerSecond</span></span>
<span class="line"><span style="color: #5B5B5B">	time </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> speed.metersPerSecond</span></span>
<span class="line"><span style="color: #5B5B5B">	speed.metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; distance </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span></code></pre>
<p>When a context is embedded in this way, its properties effectively become &quot;namespaced&quot; in the parent context, so they can be accessed from within mapping rules, or become their target - such as the rule that computes <code>speed.metersPerSecond</code> above, as if <code>metersPerSecond</code> was a part of the parent context itself.</p>
<p>Now speed can be read in multiple units of measurement:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> kinematics </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> BasicKinematics </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speedInMph </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.speed.milesPerHour</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speedInKph </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.speed.kilometersPerHour</span></span>
<span class="line"></span></code></pre>
<p>As well as be provided in units other than <code>metersPerSecond</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> kinematics </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> BasicKinematics </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, speed.milesPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">15</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.distance</span></span>
<span class="line"></span></code></pre>
<p>The notion of providing a value to a nested property like <code>speed.milesPerHour</code> may seem a bit strange at first since it isn't something we're used to do with classes and objects, but remember that the embedded context really does become an integral part of the parent context, and that contexts, unlike classes, don't have a predefined set of required members, so a notation like <code>speed.milesPerHour = 15.0</code> may make more sense, as there's no need to think of <code>Speed</code> as needing to be &quot;constructed&quot; as an independent entity.</p>
</section>
<section>
<h2 id="default-property-values">Default property values <a class="header-anchor" href="#default-property-values">§</a></h2>
<p>Properties may be set with default values. Default values must be knowable at compile-time.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// type of &#39;name&#39; is inferred as &#39;string&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;person1.name&#39; gets te default value &#39;Anonymous&#39;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Ines</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;person2.name&#39; gets the value &#39;Ines&#39;</span></span>
<span class="line"></span></code></pre>
<p>A property specifying a default value cannot be the target of a mapping rule:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	nickname: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	name </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; nickname </span><span style="color: #A1A1A1">// This is invalid, since &#39;name&#39; is assured to always have a value</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="mapping-rule-preconditions">Mapping rule preconditions <a class="header-anchor" href="#mapping-rule-preconditions">§</a></h2>
<p>A mapping rule precondition is a predicate that must be satisfied in order for a mapping rule to be available for use.</p>
<p>The simplest form of a precondition is a predicate dependent on the truth-value of a Boolean property, like in this example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AbsoluteValue</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	inputIsNegative: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"><span style="color: #5B5B5B">	inputIsNegative </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input &lt; </span><span style="color: #E65C00">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	result </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> inputIsNegative </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	result </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> inputIsNegative </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input</span></span>
<span class="line"></span></code></pre>
<p><code>inputIsNegative</code> will receive <code>true</code> if <code>input</code> is greater or equal to 0 and <code>false</code> otherwise. Consequently, <code>result</code> will receive <code>input * -1</code> if <code>inputIsNegative</code> is true, and <code>input</code> otherwise.</p>
<p>An alternate rule for <code>result</code>, for the case where <code>inputIsNegative == false</code>, ensures the compiler can unconditionally determine that <code>result</code> is always knowable when <code>input</code> is known. When such a complementary rule is not provided, the property may become <em>conditionally knowable</em> and only be used within constrained circumstances (this variation is covered at a later section about <em>conditionally knowable properties</em>).</p>
<p>You may now realize that the ability to define simple preconditions on the truth-value of Boolean properties opens up the possibility for arbitrarily complex preconditions, since the Boolean property's mapping rules may potentially involve highly sophisticated computations.</p>
<p>However, introducing a new Boolean property for every precondition is not very convenient or elegant. It would be nicer to be able to use a more compact syntax. This is made possible by <strong>ad-hoc preconditions</strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AbsoluteValue</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	result </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &lt; </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	result </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #A1A1A1">// Having no precondition is interpreted as a fallback case</span></span>
<span class="line"></span></code></pre>
<p>An ad-hoc precondition like <code>given input &lt; 0</code> implicitly introduces a Boolean property and an associated mapping rule that computes its truth-value. The second rule (<code>given input</code>) does not include a predicate, and acts as a fallback to &quot;absorb&quot; the case when <code>input</code> is known but no other rule has been successfully matched to it.</p>
<p>Using an alternative syntax, the precondition can be refactored out to resemble the appearance of a conditional (though in fact it is not really a &quot;true&quot; conditional, since it doesn't introduce its own scope). This may be chosen for stylistic reasons, but will also be useful in the case where there are multiple rules sharing one or more identical preconditions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AbsoluteValue</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &lt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="precondition-pattern-matching">Precondition pattern matching <a class="header-anchor" href="#precondition-pattern-matching">§</a></h2>
<p>Preconditions may match patterns as well as capture their component parts.</p>
<p>This example defines a context which recognizes and parses a phone number pattern, specified by a regular expression, where the parsed <code>area</code> and <code>number</code> components are introduced as variables into the body of the rule:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">/^</span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">][</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">\</span><span style="color: #000000">-</span><span style="color: #B43AFF">{</span><span style="color: #5B5B5B">[</span><span style="color: #E65C00">0</span><span style="color: #000000">-</span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">]</span><span style="color: #000000">+</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">$</span><span style="color: #000000">/</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> PhoneNumber</span></span>
<span class="line"><span style="color: #5B5B5B">	str: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> str </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> PhoneNumberRegExp </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">area, num</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		isValid, areaCode, number </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, area, num</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> str</span></span>
<span class="line"><span style="color: #5B5B5B">		isValid, areaCode, number </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;&quot;</span></span>
<span class="line"></span></code></pre>
<p>A second example defines a context that extracts the first and last elements of a list using a pattern expression:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> MyList</span></span>
<span class="line"><span style="color: #5B5B5B">	items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> [</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> f, …, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> l]</span></span>
<span class="line"><span style="color: #5B5B5B">		first, last </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; f, l</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items</span></span>
<span class="line"><span style="color: #5B5B5B">		first, last </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">nothing</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">nothing</span></span>
<span class="line"></span></code></pre>
<p>Notice how <strong>mapping rules can be shared by multiple properties</strong> simultaneously. This also implies that in order to compute any single property that’s included in the rule, all remaining properties have to be computed as well.</p>
</section>
<section>
<h2 id="mappers">Mappers <a class="header-anchor" href="#mappers">§</a></h2>
<p>Up until now the only way to make use of contexts has been via explicit instantiation like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> absoluteValue </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> AbsoluteValue </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">-</span><span style="color: #E65C00">11</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> absoluteValue.result </span><span style="color: #A1A1A1">// result gets the value 11</span></span>
<span class="line"></span></code></pre>
<p>This syntax may become too cumbersome in many cases. An alternative would be using a <strong>mapper</strong> to define a simple function-like method which accepts a set of known properties as parameters, and returns one or more unknown ones as return values:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> abs</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">AbsoluteValue.input</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; AbsoluteValue.result</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> x </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> abs</span><span style="color: #B43AFF">(</span><span style="color: #000000">-</span><span style="color: #E65C00">11</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// x gets the value 11</span></span>
<span class="line"></span></code></pre>
<p>Like conventional functions, mapper signatures can be overloaded:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> getDistance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">SimpleKinematics.Time,</span></span>
<span class="line"><span style="color: #5B5B5B">				   SimpleKinematics.speed.metersPerSecond</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; SimpleKinematics.distance</span></span>
<span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> getDistance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">SimpleKinematics.Time,</span></span>
<span class="line"><span style="color: #5B5B5B">				   SimpleKinematics.speed.kilometersPerHour</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; SimpleKinematics.distance</span></span>
<span class="line"></span></code></pre>
<p>Mapper parameters may receive aliases (though they are not generally necessary since semantic identities are always unique) and be invoked with named arguments:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> getDistance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">time: SimpleKinematics.Time,</span></span>
<span class="line"><span style="color: #5B5B5B">				   speed: SimpleKinematics.speed.kilometersPerHour</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; SimpleKinematics.distance</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getDistance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">54</span><span style="color: #5B5B5B">, speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">75</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Or alternatively, using full semantic identity references:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getDistance</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">SimpleKinematics.Time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">54</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">						   SimpleKinematics.speed.kilometersPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">75</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="pseudo-functions">Pseudo-functions <a class="header-anchor" href="#pseudo-functions">§</a></h2>
<p>Mappers help make contexts more usable by enabling them to be applied via function-like method calls. However, in many cases, the opposite may also be useful. We may want to describe more trivial computations by a simpler, function-like syntax.</p>
<p><strong>Pseudo-functions</strong> provide syntactic sugar to enable contexts to be declared via compact function-like declarations:</p>
<p>For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AddNumbers</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">, num2: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">sum: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">    sum </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> num1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> num2</span></span>
<span class="line"></span></code></pre>
<p>Would be desugared to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AddNumbers</span></span>
<span class="line"><span style="color: #5B5B5B">	num1: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	num2: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	sum: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num1 </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> num2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num1, num2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; sum</span></span>
<span class="line"></span></code></pre>
<p>If the return variable name is not given, it can still be referenced via the default <code>out</code> property. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> MultiplyByTwo</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"></span></code></pre>
<p>Would be desugared to:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> MultiplyByTwo</span></span>
<span class="line"><span style="color: #5B5B5B">	num: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">out</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; num </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">this</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">num</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">out</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="recursive-instantiation-and-embedding">Recursive instantiation and embedding <a class="header-anchor" href="#recursive-instantiation-and-embedding">§</a></h2>
<p>So far, we've only dealt with very simple problems that did not require much algorithmic &quot;depth&quot;. Say now we want to approach a slightly more complex computations, like the factorial.</p>
<p>Based on the syntax we've introduced so far. We could write something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Factorial</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">out</span><span style="color: #5B5B5B"> output </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">while</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B"> input </span><span style="color: #0059E8">advance</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">+=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">continue</span><span style="color: #5B5B5B"> output </span><span style="color: #000000">*=</span><span style="color: #5B5B5B"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> output</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Input must be nonnegative</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>Well, that might work, but wouldn't it be nicer if we could write it in a manner that is more idiomatic of the knowledge-driven style? One approach would be to recursively create an instance of <code>Factorial</code> within the body of the mapping rule itself:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Factorial</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> previousFactorial </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Factorial </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B">.input </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> previousFactorial.result</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Input must be nonnegative</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>This approach is called <strong>recursive instantiation</strong>, and works quite similarly to how functions may invoke themselves, or class members create an instance of their own class.</p>
<p>However, there's another, possibly more thought-provoking alternative. In a previous section we've embedded one context (<code>Speed</code>) inside another (<code>BasicKinematics</code>). What if we could embed <code>Factorial</code> inside of <code>Factorial</code> itself?</p>
<p>Long story short, it turns out there's no reason why that shouldn't be possible! There you go:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Factorial</span></span>
<span class="line"><span style="color: #5B5B5B">	input: </span><span style="color: #0059E8">integer</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Notice how the type of &#39;previousFactorial&#39; is Factorial itself!</span></span>
<span class="line"><span style="color: #5B5B5B">	previousFactorial: Factorial</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		previousFactorial.input </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> previousFactorial.result</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input</span></span>
<span class="line"><span style="color: #5B5B5B">		result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Failure</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Input must be nonnegative</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>But how? why? Well that's because contexts are not the same as classes. They don't require a minimal amount of information to become materialized. A context instance represents a knowledge scope <em>possibly</em> accommodating information artifacts of various semantic identities (some of which may actually lie outside the realm of the context's own schema, as you'll see on future sections). It is not primarily intended as a data structure or as an assortment of value-bound methods.</p>
<p>If <code>Factorial</code> is embedded inside of <code>Factorial</code> itself, all that means is that an instance of <code>Factorial</code> would also incorporate a secondary inner scope that happens to share its own knowledge schema, and which can be initialized with a different set of known and unknown properties than itself.</p>
<p>This kind of &quot;self nesting&quot; is called <strong>recursive embedding</strong>.</p>
<p>The way it's utilized in <code>Factorial</code> is that there's one mapping rule that infers into the recursively embedded context:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	previousFactorial.input </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span></code></pre>
<p>Informally, what this mapping rule says is that <em>'when input is greater than one, the input of the previous factorial is same as this one, minus one'</em>.</p>
<p>There's a second reference to <code>previousFactorial</code> in the subsequent mapping rule:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> input &gt; </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #5B5B5B">	result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; input </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> previousFactorial.result</span></span>
<span class="line"></span></code></pre>
<p>This one says that <em>'when input is greater than one, the result of this factorial is the input multiplied by the result of the previous factorial'</em>.</p>
<p>Together these rules help form a declarative description of how the factorial can be computed, without the need to define explicit control flow or even ordering of operations.</p>
<p>This same approach can be used to describe more complex computations. For example, here is a purely knowledge-driven implementation of the quicksort algorithm:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Quicksort</span></span>
<span class="line"><span style="color: #5B5B5B">	items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	sortedItems: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	smallerThanPivot: </span><span style="color: #0059E8">this</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;this&#39; type is synonymous with &#39;Quicksort&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	greaterOrEqualToPivot: </span><span style="color: #0059E8">this</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">		sortedItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; []</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items</span></span>
<span class="line"><span style="color: #5B5B5B">		pivot </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; items[items.length </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">] </span><span style="color: #A1A1A1">// &#39;pivot&#39; declaration is combined with a mapping rule</span></span>
<span class="line"><span style="color: #5B5B5B">		smallerThanPivot.items </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; [items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; pivot]</span></span>
<span class="line"><span style="color: #5B5B5B">		greaterOrEqualToPivot.items </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; [items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> pivot]</span></span>
<span class="line"><span style="color: #5B5B5B">		sortedItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; smallerThanPivot.sortedItems </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> greaterOrEqualToPivot.sortedItems</span></span>
<span class="line"></span></code></pre>
<p>Here are natural language translations of the mapping rules included in <code>Quicksort</code>, described in an altered order:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> []</span></span>
<span class="line"><span style="color: #5B5B5B">	sortedItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; []</span></span>
<span class="line"></span></code></pre>
<p>means: <em>'When the input is an empty list, the sorted items list is empty as well'</em>.</p>
<p>and</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #5B5B5B">	sortedItems </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; smallerThanPivot.sortedItems </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> greaterOrEqualToPivot.sortedItems</span></span>
<span class="line"></span></code></pre>
<p>means: <em>'When the input item list is nonempty, the sorted items list is a concatenation of the sorted versions of the items that are smaller than the pivot and greater or equal to the pivot'</em>.</p>
<p>and</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #5B5B5B">	smallerThanPivot.items </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;  [items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; pivot]</span></span>
<span class="line"><span style="color: #5B5B5B">	greaterOrEqualToPivot.items </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; [items </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> pivot]</span></span>
<span class="line"></span></code></pre>
<p>means: <em>'The items fed to the &quot;smaller than pivot&quot; context are the input items, filtered to the ones that are smaller than the pivot. Similarly, the &quot;greater or equal to the pivot&quot; context is fed the items that are greater or equal to the pivot'</em>.</p>
<p>and finally:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> items</span></span>
<span class="line"><span style="color: #5B5B5B">	pivot </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; items[items.length </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>means: <em>'The pivot is the value in the middle of the item list'</em>.</p>
</section>
<section>
<h2 id="universal-identifiers">Universal identifiers <a class="header-anchor" href="#universal-identifiers">§</a></h2>
<p>Each context and property is associated with a unique <strong>semantic identity</strong>, which may be referenced via a local identifier (e.g. <code>Quicksort.items</code>) or a global URI. This is similar to how the semantic web enables various pieces of information to be uniquely identified and their meaning precisely disambiguated.</p>
<p>For example, the <code>Quicksort</code> context may be referenced by a URI such as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #B43AFF">&lt;</span><span style="color: #0059E8">publisher.com/lib/Quicksort.isl#Quicksort</span><span style="color: #B43AFF">&gt;</span></span>
<span class="line"></span></code></pre>
<p>and its <code>sortedItems</code> property as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #B43AFF">&lt;</span><span style="color: #0059E8">publisher.com/lib/Quicksort.isl#Quicksort.sortedItems</span><span style="color: #B43AFF">&gt;</span></span>
<span class="line"></span></code></pre>
<p>Unlike the semantic web, however, the URI is also expected to be a true, functioning URL, pointing to the correct source file where the identity is defined. In this way, there is no need for libraries or modules. References to individual contexts and properties can be made via the exact location of the source file.</p>
<p>In terms of versioning, ideally, there shouldn't be a real need for version numbers, since semantic identities are expected to have precise and unchanging meanings.</p>
<p>Nonetheless, It is technically possible to publish two or more distinct semantic identities sharing the same name by including a version number in the URI path.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #B43AFF">&lt;</span><span style="color: #0059E8">publisher.com/lib/2.0.0/Quicksort.isl#Quicksort.sortedItems</span><span style="color: #B43AFF">&gt;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="semantic-links">Semantic links <a class="header-anchor" href="#semantic-links">§</a></h2>
<p>With an approach analogous to the semantic web, we could also define identities for more &quot;abstract&quot; concepts. For example we could define an identity for the abstract idea of a &quot;sort&quot;:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Sort</span></span>
<span class="line"><span style="color: #5B5B5B">	items: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	sortedItems: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"></span></code></pre>
<p>And it will similarly receive URIs like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">&lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Sort.isl#Sort&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">&lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Sort.isl#Sort.items&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">&lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Sort.isl#Sort.sortedItems&gt;</span></span>
<span class="line"></span></code></pre>
<p>Now, what if using this more abstract context, we could somehow annotate <code>Quicksort</code> as being a form of <code>Sort</code>, such that by only referencing properties of <code>Sort</code> the compiler could transparently make use of the mapping rules and auxiliary properties given in <code>Quicksort</code>?</p>
<p>In object-oriented programming, what is usually done is setting <code>Quicksort</code> as a &quot;subclass&quot; of <code>Sort</code>. However, that's not really what we want to achieve. What we really want is for <code>Quicksort.items</code> and <code>Quicksort.sortedItems</code> to represent the <strong>exact same semantics</strong> as <code>Sort.items</code> and <code>Sort.sortedItems</code>, respectively. We don't want the properties of <code>Sort</code> to represent something more &quot;vague&quot; than the properties of <code>Quicksort</code>.</p>
<p>This subtle change in mindset opens up some very interesting possibilities. So instead of going in the traditional line of thinking of <code>Quicksort extends Sort</code>. We'll do something else. We'll annotate individual properties of <code>Quicksort</code> to be semantically equivalent to the corresponding properties of <code>Sort</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Quicksort</span></span>
<span class="line"><span style="color: #5B5B5B">	items </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Sort.isl#Sort.items&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	sortedItems </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Sort.isl#Sort.sortedItems&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>These connections are called <strong>semantic links</strong>. What they mean is that every mapping rule that applies to <code>Quicksort.items</code>, would also apply to <code>Sort.items</code>, and vice-versa: every mapping rule that applies to <code>Sort.items</code> would apply back to <code>Quicksort.items</code>. Same between <code>Sort.sortedItems</code> and <code>Quicksort.sortedItems</code>.</p>
<p>This means we can now write something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> sortContext </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">sort.isl#Sort&gt; </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> items </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> sortContext.sortedItems </span><span style="color: #A1A1A1">// &#39;result&#39; gets the value &#39;[1, 2, 3, 4, 5]&#39;</span></span>
<span class="line"></span></code></pre>
<p>Notice what happened here: we've created an instance of a supposedly &quot;abstract&quot; context, which only defined two properties: <code>items</code> and <code>sortedItems</code> and no mapping rules of its own, and yet the compiler was able to find a way to transform between these properties, without the code mentioning any reference to a concrete implementation.</p>
<p>It is as if, in an object-oriented language, you'd create an instance of an abstract class and then &quot;magically&quot; expect its virtual methods to work when you call them directly. It might sound strange at first, but that's not a far-fetched analogy.</p>
<p>At this point you may start to realize just how powerful this idea is, and how much such a subtle alteration made it diverge from traditional object-oriented thinking.</p>
<p>This type of association may also be characterized as a form of <strong>knowledge augmentation</strong> as it &quot;augments&quot; the breadth of knowledge associated with a semantic identity. Here we've augmented the compiler's knowledge about the <code>items</code> and <code>sortedItems</code> properties of both <code>Sort</code> and <code>Quicksort</code>.</p>
</section>
<section>
<h2 id="bidirectional-mapping-rules-and-semantic-queries">Bidirectional mapping rules and semantic queries <a class="header-anchor" href="#bidirectional-mapping-rules-and-semantic-queries">§</a></h2>
<p>Let's try to take it even a step further. How about going back to our initial <code>BasicKinematics</code> example and generalizing it such that it could work for any unit of measurement for distance, speed and time? And this time we'll use semantic links instead of embeddings, to emulate a system of &quot;commonsense knowledge&quot;:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> CommonsenseKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Units.isl#Distance.meters&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	speed </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Units.isl#Speed.metersPerSecond&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">	time </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; &lt;publisher.com</span><span style="color: #000000">/</span><span style="color: #5B5B5B">lib</span><span style="color: #000000">/</span><span style="color: #5B5B5B">Units.isl#Time.seconds&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; speed </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> time</span></span>
<span class="line"></span></code></pre>
<p><code>distance &lt;=&gt; speed * time</code> is an example of a <strong>bidirectional mapping rule</strong>. It shares the same notation as a semantic link, but it isn't really the same thing. It is an abbreviated way to define multiple complementary mapping rules that are composed of simple, invertible, algebraic operations like addition, multiplication and division.</p>
<p>The <code>Distance</code>, <code>Speed</code> and <code>Time</code> contexts are defined as:</p>
<p><em>(for brevity some property declarations have been combined with bidirectional mapping rules)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Distance</span></span>
<span class="line"><span style="color: #5B5B5B">	meters: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	kilometers </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; meters </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1000</span></span>
<span class="line"><span style="color: #5B5B5B">	feet </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; meters </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">3048</span></span>
<span class="line"><span style="color: #5B5B5B">	yards </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; feet </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"><span style="color: #5B5B5B">	miles </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; yards </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1760</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Speed</span></span>
<span class="line"><span style="color: #5B5B5B">	metersPerSecond: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	kilometersPerHour </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; metersPerSecond </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">6</span></span>
<span class="line"><span style="color: #5B5B5B">	milesPerHour </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; metersPerSecond </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">23694</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Time</span></span>
<span class="line"><span style="color: #5B5B5B">	seconds: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	minutes </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; seconds </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">60</span></span>
<span class="line"><span style="color: #5B5B5B">	hours </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; minutes </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">60</span></span>
<span class="line"></span></code></pre>
<p>Now we can write something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speedMph </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Speed.milesPerHour </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// speedMph gets the value 17.04545</span></span>
<span class="line"><span style="color: #5B5B5B">	Distance.yards </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1500</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">	Time.minutes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> distanceMiles </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Distance.miles </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// distanceMiles gets the value 156.11951</span></span>
<span class="line"><span style="color: #5B5B5B">	Speed.kilometersPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">33</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">,</span></span>
<span class="line"><span style="color: #5B5B5B">	Time.hours </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Same computations, but generalized to reusable mappers:</span></span>
<span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> computeSpeedMph</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Distance.yards, Time.minutes</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Speed.milesPerHour</span></span>
<span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> computeDistanceMiles</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Speed.kilometersPerHour, Time.hours</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Distance.miles</span></span>
<span class="line"></span></code></pre>
<p>We've used a form of syntax we haven't seen before: <code>let x = .... given ....</code>.</p>
<p>This form of expression poses an &quot;abstract&quot; <strong>semantic query</strong> that may mix semantic identities from various different contexts. Notice the code never mentioned any reference to <code>CommonsenseKinematics</code>. Instead, the rules <code>CommonsenseKinematics</code> exported, via semantic linking, became attached to <code>Speed</code>, <code>Distance</code> and <code>Time</code> and the compiler was able to figure out how to compose a series of computations, which included numerous unit conversions, to successfully derive the desired information.</p>
<p>In fact, what this &quot;query&quot; notation actually does, behind the scenes, is to define an anonymous ad-hoc context where each property is associated with a particular semantic identity in a one-way fashion. The first query, when de-sugared, would look roughly like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> AdHocContext</span></span>
<span class="line"><span style="color: #5B5B5B">	distanceYards: Distance.yards</span></span>
<span class="line"><span style="color: #5B5B5B">	speedMph: Speed.milesPerHour</span></span>
<span class="line"><span style="color: #5B5B5B">	timeMinutes: Time.minutes</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speedMph </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">AdHocContext </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> distanceYards </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1500</span><span style="color: #5B5B5B">, timeMinutes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">.speedMph</span></span>
<span class="line"></span></code></pre>
<p>This &quot;one-way&quot; kind of association is called a <em>semantic role</em>. It will be covered in the next section.</p>
</section>
<section>
<h2 id="semantic-roles">Semantic roles <a class="header-anchor" href="#semantic-roles">§</a></h2>
<p>A <strong>semantic role</strong> provides a way to link a local property to a foreign property without fully embodying its semantics.</p>
<p>A property may take up any number of distinct roles. Each role can only be taken once. A role cannot be shared between two or more properties within the same context.</p>
<p>A role, unlike a semantic link, does not cause mapping rules involving the <em>representing</em> (i.e. local) property to apply back to the <em>represented</em> (i.e. foreign) property.</p>
<p>Therefore it cannot really be said to be a form of knowledge augmentation, but rather of <strong>knowledge specialization</strong>.</p>
<p>Consider a very simple example. Say we wanted to define a context that would contain a name and also include a property containing its all-uppercase version, as well as an all-lowercase one.</p>
<p>First we'll define two contexts that describe the uppercase and lowercase transforms:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Uppercase</span></span>
<span class="line"><span style="color: #5B5B5B">	plain: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	uppercase: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Lowercase</span></span>
<span class="line"><span style="color: #5B5B5B">	plain: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lowercase: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Next define the main context. We'll use some helper mappers to simplify the code:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> uppercase</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Uppercase.plain</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Uppercase.uppercase</span></span>
<span class="line"><span style="color: #0059E8">mapper</span><span style="color: #5B5B5B"> lowercase</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Lowercase.plain</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Lowercase.lowercase</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Name</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	nameUppercase: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; uppercase</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">name</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	nameLowercase: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; lowercase</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">name</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>That is okay, but there's a simpler way. We can use semantic roles to say that the <code>name</code> property &quot;pretends&quot; to be a plain (unprocessed) string, with respect to the semantics of <code>Uppercase</code> and <code>Lowercase</code>, and that <code>nameUppercase</code> and <code>nameLowercase</code> &quot;pretend&quot; to act like their respective processed properties (<code>Uppercase.uppercase</code> and <code>Lowercase.lowercase</code>):</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Name</span></span>
<span class="line"><span style="color: #5B5B5B">	name: Uppercase.plain, Lowercase.plain</span></span>
<span class="line"><span style="color: #5B5B5B">	nameUppercase: Uppercase.uppercase</span></span>
<span class="line"><span style="color: #5B5B5B">	nameLowercase: Lowercase.lowercase</span></span>
<span class="line"></span></code></pre>
<p>This looks much simpler.</p>
<p>The neat thing about it is that there's not even a need to introduce any mapping rules. The behaviors we wanted emerged naturally just by annotating a few &quot;tags&quot; in strategic positions. There wasn't even a need to say that <code>name</code>, or any of the other properties, have the type <code>string</code>, since it also followed from the annotations.</p>
<p>On a more technical note, what is actually happening here is that the <code>Uppercase</code> and <code>Lowercase</code> contexts are effectively being &quot;superimposed&quot; over the <code>Name</code> context. This also means that any other properties they may have had could have been inferred with values, but would be totally &quot;invisible&quot; unless they were exposed in the form of roles within <code>Name</code>. This kind of &quot;layering&quot; could be described as a weak form of <strong>information hiding</strong> that's quite different than how it's expressed in traditional object-oriented programming.</p>
</section>
<section>
<h2 id="roles-and-context-substitution">Roles and context substitution <a class="header-anchor" href="#roles-and-context-substitution">§</a></h2>
<p>Now, it also turns out that roles can emulate some of the hierarchical relationships that we are used to in object-oriented programming, albeit in a more granular fashion.</p>
<p>Consider this classic example used to demonstrate object-oriented hierarchical relationships:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Shape</span></span>
<span class="line"><span style="color: #5B5B5B">	area: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Circle</span></span>
<span class="line"><span style="color: #5B5B5B">    area: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Pi </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">radius</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">    radius: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Square</span></span>
<span class="line"><span style="color: #5B5B5B">    area: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; side</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">    side: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span></code></pre>
<p>We want to describe something called <code>Shape</code> that has an <code>area</code> property. And two other things called <code>Circle</code> and <code>Square</code> that also have an <code>area</code> property, as well as other properties we don't necessarily care about here (<code>radius</code> and <code>side</code>).</p>
<p>The traditional way would be to say that <code>Circle extends Shape</code> and <code>Square extends Shape</code> but that's not what we're going for (in fact, contexts don't actually support the <code>extends</code> keyword at all).</p>
<p>What we'll do instead is say that the <code>area</code> property of <code>Circle</code> and <code>Square</code> &quot;represents&quot; the area property of the <code>Shape</code> context:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Shape</span></span>
<span class="line"><span style="color: #5B5B5B">	area: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Circle</span></span>
<span class="line"><span style="color: #5B5B5B">    area: Shape.area </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; Pi </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">radius</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">    radius: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Square</span></span>
<span class="line"><span style="color: #5B5B5B">    area: Shape.area </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; side</span><span style="color: #000000">^</span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">    side: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span></code></pre>
<p>Now let's pose a scenario that will help us understand the meaning of this relationship. Say we define another context that holds two Shapes, and contains a property, together with a mapping rule that computes their total area:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> TwoShapes</span></span>
<span class="line"><span style="color: #5B5B5B">	shape1: Shape</span></span>
<span class="line"><span style="color: #5B5B5B">	shape2: Shape</span></span>
<span class="line"><span style="color: #5B5B5B">	totalArea: </span><span style="color: #0059E8">decimal</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; shape1.area </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> shape2.area</span></span>
<span class="line"></span></code></pre>
<p>Now I write something like this:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> twoShapes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> TwoShapes </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	shape1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Circle </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> radius </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	shape2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Square </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> side </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> totalArea </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> twoShapes.totalArea </span><span style="color: #A1A1A1">// Is this always computable?</span></span>
<span class="line"></span></code></pre>
<p>I assigned a placeholder for a <code>Shape</code> with instances of <code>Circle</code> and <code>Square</code>, despite the fact there are no formal relationships between these types!</p>
<p>Both <code>Circle</code> and <code>Square</code> have <code>area</code> properties that embrace the semantics of the <code>area</code> property of <code>Shape</code>, so it makes sense that they can substitute for it. However, it might sound surprising but this relationship wasn't strictly necessary to enable the substitution. Fundamentally, there are no fixed hierarchies, <strong>any context type can be assigned to any other context type</strong>.</p>
<p>More formally, this kind of type relationship may be described as a form of <strong>ad-hoc behavioral subtyping</strong>.</p>
<p>But how does the compiler determine these assignments are safe? and how does it know if <code>totalArea</code> is computable at all? We never initialized an explicit value to the <code>area</code> properties of <code>Circle</code> or <code>Square</code>. How can it be confident that <code>shape1.area + shape2.area</code> even means anything?</p>
<p>The answer is that there is no general way for the compiler to immediately determine that a given property is knowable. Instead, the compiler performs a localized analysis of each property reference and tries to sort out, on a case by case basis, which referenced properties are knowable, and which aren't. This form of static analysis is achieved by employing <em>instance types</em>, which are the subject of the next section.</p>
</section>
<section>
<h2 id="instance-types">Instance types <a class="header-anchor" href="#instance-types">§</a></h2>
<p>An <strong>instance type</strong> is a form of refinement type used by the compiler to contextually model the knowability of different properties, given the particular circumstances of the surrounding code.</p>
<p>Let's look at the last code example from the previous section:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> twoShapes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> TwoShapes </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	shape1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Circle </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> radius </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	shape2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Square </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> side </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> totalArea </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> twoShapes.totalArea</span></span>
<span class="line"></span></code></pre>
<p>I'll try to demonstrate how the compiler ensures the reference to <code>twoShapes.totalArea</code> is safe.</p>
<p>First, say we wrote something simpler like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> circle </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Circle </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> radius </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"></span></code></pre>
<p>The compiler would infer the type of <code>circle</code> as:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">Circle </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> radius, area</span></span>
<span class="line"></span></code></pre>
<p>It is clear why <code>radius</code> is included, since it was assigned an explicit value, but why is <code>area</code> there?</p>
<p>The answer is that from a knowledge-driven perspective, there's no substantial distinction between an information entity that is provided as &quot;fact&quot; and one that's computed. They are both considered <em>knowable</em>.</p>
<p>Now by using this method, the compiler can prove that <code>twoShapes.totalArea</code> is knowable:</p>
<p>The expression <code>Circle with radius = 5.0</code> gets the type <code>Circle with radius, area</code></p>
<p>The expression <code>Square with side = 7.5</code> gets the type <code>Square with side, area</code></p>
<p>Now once assigned into the <code>shape1</code> and <code>shape2</code> properties of the <code>TwoShapes</code> context, these types are both cast to the type <code>Shape with area</code>.</p>
<p>Now <code>twoShapes</code> consequently receives the type <code>TwoShapes with shape1.area, shape2.area, totalArea</code> and thus the <code>twoShapes.totalArea</code> property has been statically proven to be knowable:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> twoShapes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> TwoShapes </span><span style="color: #0059E8">with</span></span>
<span class="line"><span style="color: #5B5B5B">	shape1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Circle </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> radius </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;shape1&#39; gets the type &#39;Shape with area&#39;</span></span>
<span class="line"><span style="color: #5B5B5B">	shape2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Square </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> side </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;shape2&#39; gets the type &#39;Shape with area&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// &#39;twoShapes&#39; gets the type &#39;TwoShapes with shape1.area, shape2.area, totalArea&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> totalArea </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> twoShapes.totalArea </span><span style="color: #A1A1A1">// totalArea has been proven to be computable</span></span>
<span class="line"></span></code></pre>
<p>Instance types can be stated explicitly as an ad-hoc way to specify a set of required members for a context instance. This enables the context instance to emulate some of the characteristics of a traditional object structure:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Example</span></span>
<span class="line"><span style="color: #5B5B5B">	personInfo: Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName, age</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> validInstance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Example </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> personInfo </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Miguel</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">57</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Okay</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> invalidInstance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Example </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> personInfo </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">34</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Fails to compile</span></span>
<span class="line"></span></code></pre>
<p>Instance types may also explicitly state members that must <em>not</em> be provided during initialization, e.g.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Example</span></span>
<span class="line"><span style="color: #5B5B5B">	personInfo: Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> firstName, lastName, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> age</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="incremental-instance-initialization">Incremental instance initialization <a class="header-anchor" href="#incremental-instance-initialization">§</a></h2>
<p>Context instances are fully immutable object-like entities. However, similarly to conventional Island objects, <strong>instances may be initialized in an incremental fashion</strong>, where each added property causes its instance type to be altered in a stepwise manner (these type changes are analyzed at compile-time thus provide full soundness guarantees).</p>
<p>For example, instead of setting all properties on the initial instantiation of the <code>Kinematics</code> context, they can be gradually added later, even from within conditionals:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> kinematics: BasicKinematics</span></span>
<span class="line"><span style="color: #A1A1A1">// At this point, &#39;kinematics&#39; is effectively &quot;empty&quot;. Its type is &#39;BasicKinematics&#39;.</span></span>
<span class="line"><span style="color: #A1A1A1">// It has no known properties and cannot be used for anything.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">kinematics.distance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #A1A1A1">// Now it has one known property, and its type has changed to &#39;BasicKinematics with distance&#39;,</span></span>
<span class="line"><span style="color: #A1A1A1">// though it is still not very useful since not much new knowledge can be inferred from it.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> ....someCondition....</span></span>
<span class="line"><span style="color: #5B5B5B">	kinematics.time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	kinematics.time </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This branch must also initialize a value for &#39;time&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Its type has changed again, now to &#39;BasicKinematics with distance, time&#39;.</span></span>
<span class="line"><span style="color: #A1A1A1">// The value for the &#39;time&#39; property was set within a conditional, but that&#39;s</span></span>
<span class="line"><span style="color: #A1A1A1">// okay, since the compiler ensured that all branches assigned a value</span></span>
<span class="line"><span style="color: #A1A1A1">// (otherwise, a compilation error would have occured).</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Now the &#39;speed&#39; value can be computed, since sufficient information is available for it:</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> speed </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> kinematics.speed</span></span>
<span class="line"></span></code></pre>
<p>A <strong>property that has a default value cannot be late-initialized</strong>. To remedy this, the default value must be explicitly removed using the <code>no</code> operator. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Person</span></span>
<span class="line"><span style="color: #5B5B5B">	name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anonymous</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// &#39;person.name&#39; gets the default value &quot;Anonymous&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// This is invalid! &#39;name&#39; property has already been set to the default value:</span></span>
<span class="line"><span style="color: #5B5B5B">person.name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anja</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>However:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> person </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> Person </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> name </span><span style="color: #A1A1A1">// &#39;person.name&#39; gets no value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Now this works:</span></span>
<span class="line"><span style="color: #5B5B5B">person.name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Anja</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="anonymous-contexts">Anonymous contexts <a class="header-anchor" href="#anonymous-contexts">§</a></h2>
<p><strong>Anonymous contexts</strong> are context declarations included directly within a type annotation.</p>
<p>They can provide a convenient way to assign similar roles for two or more distinct properties:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Name</span></span>
<span class="line"><span style="color: #5B5B5B">	firstName: </span><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">		plain: Uppercase.plain, Lowercase.plain</span></span>
<span class="line"><span style="color: #5B5B5B">		uppercase: Uppercase.uppercase</span></span>
<span class="line"><span style="color: #5B5B5B">		lowercase: Lowercase.lowercase</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	lastName: </span><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">		plain: Uppercase.plain, Lowercase.plain</span></span>
<span class="line"><span style="color: #5B5B5B">		uppercase: Uppercase.uppercase</span></span>
<span class="line"><span style="color: #5B5B5B">		lowercase: Lowercase.lowercase</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	fullNameUpperCase </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; firstName.uppercase </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> “ “ </span><span style="color: #000000">|</span><span style="color: #5B5B5B"> lastName.upperCase</span></span>
<span class="line"></span></code></pre>
<p>A variant of this syntax can also be used to <strong>integrate an ad-hoc context instance directly into the local procedural scope</strong>, such that via incremental initialization, its properties can be used as if they were plain local variables:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #A1A1A1">// Declaring &#39;context&#39; with no identifier imports its properties into the local scope.</span></span>
<span class="line"><span style="color: #A1A1A1">// Thus, in addition to defining the anonymous context type, it also introduces</span></span>
<span class="line"><span style="color: #A1A1A1">// a nameless, &quot;ghost&quot; instance for it.</span></span>
<span class="line"><span style="color: #A1A1A1">//</span></span>
<span class="line"><span style="color: #A1A1A1">// Alternatively, &#39;let someName: context&#39; would have namespaced the properties under</span></span>
<span class="line"><span style="color: #A1A1A1">// the &#39;someName.&#39; prefix, but otherwise behave identically.</span></span>
<span class="line"><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">	name: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	age: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span></span>
<span class="line"><span style="color: #5B5B5B">		greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> age</span></span>
<span class="line"><span style="color: #5B5B5B">		greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">name </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Luna</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This assigns directly into the anonymous instance&#39;s &#39;name&#39; property.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> someCondition</span></span>
<span class="line"><span style="color: #5B5B5B">	age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">46</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Hello Luna of 46 years of age!&quot;</span></span>
<span class="line"><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">	age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">15</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This branch must also assign a value for the &#39;age&#39; property</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints &quot;Hello young Luna of 15 years of age!&quot;</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="conditionally-knowable-properties">Conditionally knowable properties <a class="header-anchor" href="#conditionally-knowable-properties">§</a></h2>
<p>Let's look more closely at the previous section's example. Notice the two mapping rules that define the value of <code>greeting</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> age</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span></code></pre>
<p>Together these rules ensure that <code>greeting</code> is knowable whenever <code>age</code> is knowable. Now what if we take away the second rule, meaning that <code>greeting</code> would only be knowable in the case where <code>age &gt;= 18</code>?:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span></span>
<span class="line"><span style="color: #5B5B5B">	greeting </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">name</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> of </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">age</span><span style="color: #B43AFF">}</span><span style="color: #AA6631"> years of age!</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// No other rules exist :(</span></span>
<span class="line"></span></code></pre>
<p>Now we have to somehow ensure that <code>age &gt;= 18</code> before <code>greeting</code> can be safely accessed. But how is it possible to achieve that? requiring a &quot;guard&quot;-like <code>if</code> statement? declaring an assertion type?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getAgeFromSomewhere</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #5B5B5B"> </span><span style="color: #000000">or</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B"> &gt; age </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// is &#39;greeting&#39; always knowable?</span></span>
<span class="line"></span></code></pre>
<p>The thing is, with the exception of &quot;toy&quot; examples like the above, which may be solved using an &quot;off-the-shelf&quot; theorem prover (though with some amount of extra computational effort), it is not very easy for the compiler to statically ensure that some arbitrary user-provided formula logically entails the expected one (here <code>age &gt;= 18</code>).. So, sadly, that's not really a viable option, at least not in general.. :(</p>
<p><strong>But wait a minute!</strong> maybe that's not really needed! The compiler already knows what the target precondition is, right? so why not let it test for it <em>by itself</em>?</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getAgeFromSomewhere</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">I don&#39;t know what to do?!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>What is going on here?? Looks like a skeletal <code>match</code> body with a <code>case</code> clause having no conditions attached? Is this some sort of an April fools' joke?</p>
<p>Well, actually no, it's not a joke!</p>
<p>The compiler already knows what is the set of conditions required for <code>greeting</code> to be knowable, so it simply fills them automatically. You can think of <code>case</code> as meaning <code>case ???</code> where <code>???</code> represents a &quot;hole&quot;.</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">age </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> getAge</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> ??? </span><span style="color: #A1A1A1">// the compiler automatically fills in &#39;age &gt;= 18&#39; in place of ???</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">greeting</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">I don&#39;t know what to do?!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>This example wasn't very illustrative since it only had one case. Here's a different one:</p>
<p>Say the user inputs a string. The string may either be:</p>
<ol>
<li>A phone number.</li>
<li>A license plate number.</li>
<li>A credit card number.</li>
</ol>
<p>In each case I want to extract a different piece of information:</p>
<ol>
<li>Extract the country code.</li>
<li>Extract the plate's prefix characters.</li>
<li>Extract the card's four last digits.</li>
</ol>
<p>I'll define an anonymous context containing the required properties and mapping rules, but add no fallback for the case where the user's input is invalid:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">	userInput: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	phoneCountryCode: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	licensePlatePrefixChars: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	creditCardLastDigits: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> userInput </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> PhoneNumberPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> countryCode, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		phoneCountryCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> countryCode</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> userInput </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> LicensePlatePattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> prefixChars, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		licensePlatePrefixChars </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> prefixChars</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> userInput </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> CreditCardPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">_, _, _, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> fourLastDigits</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		creditCardLastDigits </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> fourLastDigits</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// No fallback is given for the case where &#39;userInput&#39; doesn&#39;t match</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// any of the other rules.</span></span>
<span class="line"></span></code></pre>
<p>Now I want the program to print a different prompt for the different cases where each piece of information is known, so I'll write:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">userInput </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readUserInput</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your phone number&#39;s country code is </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">phoneCountryCode</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your license plate prefix characters are </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">licensePlatePrefixChars</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your credit card&#39;s last digits are </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">creditCardLastDigits</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your input was invalid!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<p>For each <code>case</code> block, the compiler synthesized a condition that represents the weakest possible assertion required to ensure that all the properties referenced within it are knowable.</p>
<p>It is possible, however, that two or more cases may both be satisfied at the same time. In this scenario, the first one listed will be selected. It's also possible that due to lack of care or awareness, the conditions inferred wouldn't correctly represent the intention the programmer had in mind.</p>
<p>To help guard against issues of this kind, the editor experience will automatically visualize the inferred conditions for each case, so that the programmer can get immediate feedback and adjust accordingly.</p>
<p>If the programmer wishes to append <strong>custom preconditions</strong> of their own to a particular case, they can use the <code>expect</code> statement:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">userInput </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readUserInput</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> userInput.length </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">8</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This would be included in the inferred condition</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your phone number&#39;s country code is </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">phoneCountryCode</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>Case statement blocks <strong>can be nested</strong>. Nested cases may be required if a new value is received via an effect, such as reading a value from user input:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">	firstUserInput: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	secondUserInput: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> firstUserInput </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> PhoneNumberPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">any</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> areaCode, ...</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		phoneAreaCode </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> areaCode</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> secondUserInput </span><span style="color: #0059E8">matches</span><span style="color: #5B5B5B"> ContinentPattern </span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> continent</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		continentCategory </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; continent</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">firstUserInput </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readUserInput</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Your phone area code is </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">phoneAreaCode</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Which continent are you from?</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	secondUserInput </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> readUserInput</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// This nested case block is required since the outer one can&#39;t assert on the</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// value of &#39;secondUserInput&#39; as it is acquired via an effect within the body</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// of the case itself:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> continentCategory </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> Continent.Eurasia</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello Eurasian!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> continentCategory </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> Continent.Africa</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello African!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">I could not understand your input :(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #0059E8">case</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"><span style="color: #0059E8">otherwise</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="pattern-contexts">Pattern contexts <a class="header-anchor" href="#pattern-contexts">§</a></h2>
<p>By now, it may start to become evident that pattern recognizers could be highly effective tools for knowledge-driven programming. In the previous section, we've seen how matching can be partially &quot;automated&quot; when patterns are given as preconditions. We can also take it a step further, and reference patterns directly via their own dedicated contexts.</p>
<p>A <strong>pattern context</strong>, analogous to a <code>function context</code>, is a pattern recognizer where its parameters and return values are interpreted as part of a context. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">pattern</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> PhoneNumberPattern</span><span style="color: #B43AFF">()</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">of</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">countryCode: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, areaCode: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, prefix: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B">, lineNumber: </span><span style="color: #0059E8">string</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">					</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	&lt;.... recognizer body ....&gt;</span></span>
<span class="line"></span></code></pre>
<p>would be translated to something like:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> PhoneNumberPattern</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B">: </span><span style="color: #0059E8">string</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This property represents for the recognizer&#39;s input stream</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// Each of the recognizer output values gets its own property:</span></span>
<span class="line"><span style="color: #5B5B5B">	countryCode: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	areaCode: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	prefix: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	lineNumber: </span><span style="color: #0059E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #A1A1A1">// This (illustrative) rule implements the recognizer body:</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">in</span></span>
<span class="line"><span style="color: #5B5B5B">		countryCode, areaCode, prefix, lineNumber </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt;</span></span>
<span class="line"><span style="color: #5B5B5B">			&lt;.... recognizer body ....&gt;</span></span>
<span class="line"></span></code></pre>
<p><em>(note this is only an illustrative translation, since mapping rule bodies can't directly contain recognizer code)</em></p>
<p>So now we can greatly simplify the previous section's context definition by treating its patterns as contexts and binding to their input and output properties via roles:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">	userInput: PhoneNumberPattern.</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B">, LicensePlatePattern.</span><span style="color: #0059E8">in</span><span style="color: #5B5B5B">, CreditCardPattern.</span><span style="color: #0059E8">in</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	phoneCountryCode: PhoneNumberPattern.countryCode</span></span>
<span class="line"><span style="color: #5B5B5B">	licensePlatePrefixChars: LicensePlatePattern.prefixChars</span></span>
<span class="line"><span style="color: #5B5B5B">	creditCardLastChars: CreditCardPattern.lastFourChars</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="anonymous-contexts-as-loop-state">Anonymous contexts as loop state <a class="header-anchor" href="#anonymous-contexts-as-loop-state">§</a></h2>
<p><em>(Sketch - Work in progress)</em></p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">repeat</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">		i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">next</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello World! </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">repeat</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">next</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello World! </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">i</span><span style="color: #B43AFF">}</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Let&#39;s play a game. Think of a number between 1 and 100.</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">I&#39;ll ask you a series of simple questions until I&#39;m able to guess what it is!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">	result: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">repeat</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">context</span></span>
<span class="line"><span style="color: #5B5B5B">		min </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">		max </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">100</span></span>
<span class="line"><span style="color: #5B5B5B">		mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">min </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> max</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">		userResponse: </span><span style="color: #0059E8">boolean</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> userResponse </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">true</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">next</span><span style="color: #5B5B5B"> max </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; mid</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> userResponse </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">false</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">next</span><span style="color: #5B5B5B"> min </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; mid</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> min </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> max</span></span>
<span class="line"><span style="color: #5B5B5B">			result </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; mid</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">end</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Is the number smaller than </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">mid</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">?</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	userResponse </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> receiveUserInput</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// User input is received as a Boolean value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">The number you thought of was </span><span style="color: #B43AFF">{</span><span style="color: #AA6631">result</span><span style="color: #B43AFF">}</span><span style="color: #AA6631">!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="role-coupling-and-semantic-indexing">Role coupling and semantic indexing <a class="header-anchor" href="#role-coupling-and-semantic-indexing">§</a></h2>
<p>Say we wanted to use roles to describe a simple computation that accepts a string-encoded decimal number and outputs the square of that number.</p>
<p>First we'll define contexts for the auxiliary computations:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> StringifiedNumber</span></span>
<span class="line"><span style="color: #5B5B5B">	source: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	stringified: </span><span style="color: #0059E8">string</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> NumberSquare</span></span>
<span class="line"><span style="color: #5B5B5B">	number: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	squared: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	....</span></span>
<span class="line"></span></code></pre>
<p>For the context that describes the main computation we'll define three properties, taking up four different roles:</p>
<ol>
<li>Represents the stringified number.</li>
<li>Represents both the un-stringified number and the input to the square computation.</li>
<li>Represents the the squared number.</li>
</ol>
<p>For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> StringifiedNumberSquared</span></span>
<span class="line"><span style="color: #5B5B5B">	stringified: StringifiedNumber.stringified</span></span>
<span class="line"><span style="color: #5B5B5B">	unstringified: StringifiedNumber.number, NumberSquare.number</span></span>
<span class="line"><span style="color: #5B5B5B">	squared: NumberSquare.squared</span></span>
<span class="line"></span></code></pre>
<p>We had to explicitly introduce the intermediate property <code>unstringified</code> in order to &quot;pipe&quot; the two computations together. Hadn't we done that, there was no way for the compiler to know for certain if that was what we wanted to do. It is true that both <code>StringifiedNumber.number</code> and <code>NumberSquare.number</code> share the same type - <code>decimal</code>, but that fact is not sufficient to deductively infer that these two must be bound together.</p>
<p>So, in a sense, if we didn't care about exposing <code>unstringified</code> as a property, all we really needed to state is that <code>StringifiedNumber.number</code> and <code>NumberSquare.number</code> are somehow &quot;glued&quot; together. This can be expressed by the special <strong>role coupling operator <code>=:=</code></strong>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> StringifiedNumberSquared</span></span>
<span class="line"><span style="color: #5B5B5B">	stringified: StringifiedNumber.stringified</span></span>
<span class="line"><span style="color: #5B5B5B">	StringifiedNumber.number </span><span style="color: #000000">=:=</span><span style="color: #5B5B5B"> NumberSquare.number </span><span style="color: #A1A1A1">// This is called a &quot;coupling rule&quot;</span></span>
<span class="line"><span style="color: #5B5B5B">	squared: NumberSquare.squared</span></span>
<span class="line"></span></code></pre>
<p>So how and why this works?</p>
<p>Remember that for every context instance, each semantic identity may only receive a single, unique value. So in effect, stating that the two semantic identities always get the same value is equivalent to introducing an intermediate property that takes both roles. The only difference is that here, this intermediate property becomes &quot;anonymous&quot;, so it isn't possible to access its value via the conventional <code>.</code> notation.</p>
<p>However, it is still possible to query its value via any of the roles it represents. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> valueOfAnonymousProperty </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> StringifiedNumberSquared[StringifiedNumber.number] </span><span style="color: #0059E8">given</span></span>
<span class="line"><span style="color: #5B5B5B">	StringifiedNumberSquared.stringified </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5.32</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// valueOfAnonymousProperty gets the value 5.32 of type &#39;double&#39;</span></span>
<span class="line"></span></code></pre>
<p><code>StringifiedNumberSquared[StringifiedNumber.number]</code> references a property value via its semantic identity, instead of an explicit identifier. This syntax is called <strong>semantic indexing</strong>. Any semantic identity can be used as an index, including ones that are not explicitly mentioned within the schema itself, such as intermediate properties indirectly employed by mapping rules imported via semantic roles or links.</p>
<p>For comparison, if we had instead queried for <code>StringifiedNumber.number</code> directly, e.g.:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> valueOfAnonymousProperty </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> StringifiedNumber.number </span><span style="color: #0059E8">given</span></span>
<span class="line"><span style="color: #5B5B5B">	StringifiedNumberSquared.stringified </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5.32</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// Error: no mapping rules were found to compute the desired information</span></span>
<span class="line"></span></code></pre>
<p>We'll get a compilation failure since the reference to <code>StringifiedNumber.number</code> signifies the general value of the identity, not the one that's specialized to the <code>StringifiedNumberSquared</code> context. A non-specialized value could only have been derived if we explicitly supplied values for members of <code>StringifiedNumber</code> itself, or indirectly via any of their semantic links (refer back to <code>CommonsenseKinematics</code> for an illustration of that kind of scenario).</p>
<p>Alternatively, semantic indexing can also be applied on the instance directly:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> instance </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> StringifiedNumberSquared </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> stringified </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">5.32</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> valueOfAnonymousProperty </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> instance[StringifiedNumber.number]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A1A1A1">// valueOfAnonymousProperty gets the value 5.32</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="context-expansion">Context expansion <a class="header-anchor" href="#context-expansion">§</a></h2>
<p>Let's go back to our initial <code>BasicKinematics</code> example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	distance: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	time: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	speed: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	distance </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; time </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"></span></code></pre>
<p>We would like to add a second speed property that measures in miles per hour. However, this time, let's say we can't directly edit the context declaration, as it was provided by an external source.</p>
<p>There's no trivial way to &quot;extend&quot; <code>BasicKinematics</code> via OO-like &quot;subtyping&quot;, since it is not a class.</p>
<p>However, contexts do support expansion, so we can add the property we want by using an expansion declaration that will only be visible from within our own code. Here are a number of solutions based on different approaches:</p>
<p>A property paired with a bidirectional mapping rule containing a semantic query:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInMilesPerHour </span><span style="color: #000000">&lt;=</span><span style="color: #5B5B5B">&gt; Speed.milesPerHour </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> Speed.metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> speed</span></span>
<span class="line"></span></code></pre>
<p>Roles:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInMetersPerSecond: Speed.metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; speed</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInMilesPerHour: Speed.milesPerHour</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInKilometersPerHour: Speed.kilometersPerHour</span></span>
<span class="line"></span></code></pre>
<p>Embed <code>Speed</code> context directly and map its <code>metersPerSecond</code> property to the value of <code>speed</code>:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">expansion</span><span style="color: #5B5B5B"> BasicKinematics</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInOtherUnits: Speed</span></span>
<span class="line"><span style="color: #5B5B5B">	speedInOtherUnits.metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; speed</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="stream-properties">Stream properties <a class="header-anchor" href="#stream-properties">§</a></h2>
<p>A property may also generate a stream of values.</p>
<p>...TODO...</p>
</section>
<section>
<h2 id="consistency-and-contradiction-checking">Consistency and contradiction checking <a class="header-anchor" href="#consistency-and-contradiction-checking">§</a></h2>
<p>One potential issue has to do with the way mapping rules allow multiple, possibly contradictory, computations to be defined for the same set of properties.</p>
<p>Trivially contradictory:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> TriviallyContradictory</span></span>
<span class="line"><span style="color: #5B5B5B">	num: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	num </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #5B5B5B">	num </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// This is technically legal code, but is obviously bogus.</span></span>
<span class="line"></span></code></pre>
<p>Contradictions may also happen between mapping rules going in different directions:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> BidirectionallyContradictory</span></span>
<span class="line"><span style="color: #5B5B5B">	propertyA: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"><span style="color: #5B5B5B">	propertyB: </span><span style="color: #0059E8">decimal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	propertyA </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> propertyB </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; propertyB </span><span style="color: #000000">/</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span></span>
<span class="line"><span style="color: #5B5B5B">	propertyB </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> propertyA </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; propertyA </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// Should this be allowed?</span></span>
<span class="line"></span></code></pre>
<p>In the case that both mapping rules only contain trivial algebraic operations, contradictions can be detected at compile time.</p>
<p>For more complex cases, one approach to automate the detection of these types of inconsistencies is by having a special debug mode where the compiler would automatically inject consistency tests whenever a mapping rule is being used.</p>
<p>For example, if <code>propertyA</code> is given a value <code>x</code>, and consequently <code>propertyB</code> is inferred with the value <code>f(x)</code>, the program would also include an assertion for the complementary rule where <code>propertyB</code> is given the resulting value (<code>f(x)</code>) and <code>propertyA</code> is the one that's inferred (its expected value would be <code>x</code>). A similar approach can also be used to ensure consistency in scenarios where there are multiple rules to infer the value of a particular property.</p>
</section>
<section>
<h2 id="unit-testing">Unit testing <a class="header-anchor" href="#unit-testing">§</a></h2>
<p>Knowledge-driven programming enable unit tests to be described via an extremely simple and generic template based on a single semantic query:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> .... </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> .... </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> .... &gt; .... </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> isEmpty</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">....</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> ....</span></span>
<span class="line"></span></code></pre>
<p>In general:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> &lt;</span><span style="color: #0059E8">boolean</span><span style="color: #5B5B5B"> experssion involving a semantic identifier&gt; </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> &lt;semantic identifer assignments&gt;</span></span>
<span class="line"></span></code></pre>
<p>For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> Speed.milesPerHour ~</span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">47388</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> Speed.metersPerSecond </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">0</span></span>
<span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> Distance.miles ~</span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">156</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">11951</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> Speed.kilometersPerHour </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">33</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, Time.hours </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">.</span><span style="color: #E65C00">5</span></span>
<span class="line"></span></code></pre>
<p>The way that programs are broken down to assortments of independently addressable values enables a higher level of granularity for white-box testing. It is possible to &quot;peek&quot; deeper into the inner workings of the algorithm by querying for its intermediate values. If a context involves recursive embedding, it is also possible to assert over the values of properties &quot;nested&quot; within one or more levels of recursion. For example:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> Factorial.previousFactorial.input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> Factorial.input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">6</span></span>
<span class="line"><span style="color: #0059E8">expect</span><span style="color: #5B5B5B"> Factorial.previousFactorial.previousFactorial.input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">given</span><span style="color: #5B5B5B"> Factorial.input </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">6</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="reactive-contexts">Reactive contexts <a class="header-anchor" href="#reactive-contexts">§</a></h2>
<p>...TODO...</p>
</section>
<section>
<h2 id="eli5%3A-illustrative-%22magic-room%22-analogies">ELI5: Illustrative &quot;magic room&quot; analogies <a class="header-anchor" href="#eli5%3A-illustrative-%22magic-room%22-analogies">§</a></h2>
<section>
<h3 id="contexts%2C-properties-and-mapping-rules">Contexts, properties and mapping rules <a class="header-anchor" href="#contexts%2C-properties-and-mapping-rules">§</a></h3>
<p>Think of a context as if it was a <em>blueprint</em> for an imaginary &quot;magic&quot; room.</p>
<p>The room may contain one or more boxes, which act as an analogy for its <em>properties</em>.</p>
<p>Each box may contain an item of a particular type, e.g. a ball, a pen, a doll etc. The kind of thing the box may contain is analogous to the <em>type</em> of a property (<code>string</code>, <code>integer</code> etc.).</p>
<p>The box is also characterized by a secondary quality, which is completely unique to it. This quality describes what purpose the box represents in relation to other boxes in the room, as well as to the room as a whole. This quality is analogous to its <em>semantic identity</em>.</p>
<p>The room can be cast with a one or more magic spells that cause items to appear inside of empty boxes. These spells may depend on the content of nonempty boxes, including boxes that received their content due to magic. These spells are analogous to <em>mapping rules</em>.</p>
</section>
<section>
<h3 id="embedded-context">Embedded context <a class="header-anchor" href="#embedded-context">§</a></h3>
<p>I create a blueprint for a room. I add all sorts of boxes to it.</p>
<p>I create a secondary room blueprint and add some other boxes to it.</p>
<p>Now I also add another, very special kind of box to the second room. This special box is actually a container for an entire room! I set the blueprint for the room in the box to be the first room's blueprint.</p>
<p>Now I can freely cast spells that involve the boxes that reside inside of the room that's inside the special box, as if these boxes were a part of the outer room.</p>
</section>
<section>
<h3 id="recursively-embedded-context">Recursively embedded context <a class="header-anchor" href="#recursively-embedded-context">§</a></h3>
<p>Same as previous, only the blueprint I use for the room inside the special box, is the blueprint of the outer room itself!</p>
<p>This means that there is an &quot;infinite&quot; nesting of rooms and special boxes: If I look inside the special box I find a room, and inside that room a special box, containing another room, containing a special box, containing a room, repeating endlessly..</p>
<p>I notice there's a risk that I might get caught in an infinite loop of looking deeper and deeper into the contents of these nested rooms, so I design the spells such that they never look into these inner rooms to more than a finite depth.</p>
</section>
<section>
<h3 id="semantic-links-1">Semantic links <a class="header-anchor" href="#semantic-links-1">§</a></h3>
<p>I create a blueprint for a room. It starts out completely empty.</p>
<p>I put two boxes in the room. I set the first box so it can only contain a doll, and the second to only contain a picture.</p>
<p>Now I create a secondary room. The secondary room starts out empty as well.</p>
<p>I put two boxes in the second room.</p>
<p>I declare that the first box is a &quot;magic twin&quot; of the first box in the first room. Same for the second box and the second box in the first room. The twin relationship between the boxes means that any spell I cast that involves one, becomes effective over its twin as well (it doesn't mean both must contain the same exact item, though. The pairing is only made over the spells, not the materialized box contents).</p>
<p>In the second room, I cast a spell that says that if box 1 gets a doll, box 2 would receive a picture of that doll. I don't cast any further spells (that is, if box 2 receives a picture, nothing special necessarily happens to box 1).</p>
<p>I use the second room blueprint to generate a new virtual room. I put a doll in the first box. A picture of that doll appears in the second box.</p>
<p>I use the first room blueprint and generate a new virtual room. I put a doll in the first box. A picture of that doll appears in the second box as well!</p>
</section>
<section>
<h3 id="semantic-roles-1">Semantic roles <a class="header-anchor" href="#semantic-roles-1">§</a></h3>
<p>I create a new blueprint for a room. The room starts out completely empty.</p>
<p>I put two boxes in the room. I decide that both may only contain balls (i.e. I give both of them the same type, <code>Ball</code>).</p>
<p>Now, I cast a spell that says that whenever there's a ball in box 1, box 2 gets a ball as well, but with a complementary color. For example, if I put a blue ball in box 1, an orange ball magically appears in box 2. I cast a second spell so that the reverse would happen as well, i.e., if I put an orange ball in box 2, a blue ball will appear in box 1.</p>
<p>I create a secondary room blueprint. The second room also starts out completely empty.</p>
<p>I put two boxes in the second room.</p>
<p>I would like these boxes to imitate how the boxes in the first room relate to one another, so I set box 1 in the second room to take the &quot;role&quot; of box 1 in the first room, and box 2 in the second room to take the role of box 2 in the second room.</p>
<p>I generate a room from the first blueprint I made (the first room).</p>
<p>I put a red ball in the first box, and I magically get a green ball in the second box.</p>
<p>Now I generate a room from the second blueprint I've made (the second room).</p>
<p>I test to see if the same thing happens. I put a red ball in the first box, and I verify that I get a green ball in the second box.</p>
<p>Now I can add more boxes to the second room's blueprint, and cast more spells, which may involve the two initial boxes, but these spells will have no impact on the behavior of the boxes in the first room.</p>
</section>
<section>
<h3 id="semantic-query">Semantic query <a class="header-anchor" href="#semantic-query">§</a></h3>
<p>I set up a new room blueprint with a number of boxes.</p>
<p>I set the boxes to take the roles of many other boxes, from many different rooms.</p>
<p>For example, I set box 1 to pretend like it's box 5 from room 11, box 2 to pretend like it's box 4 from room 3, and box 3 to pretend like it's box 15 from room 5.</p>
<p>Now I add a forth box, and I set it up to pretend like it's box 6 from room 9.</p>
<p>I generate a new room from the blueprint I've made.</p>
<p>I put items in boxes 1, 2, 3, but leave 4 empty.</p>
<p>I wait and see what item appears in box 4.</p>
</section>
<section>
<h3 id="role-coupling-and-semantic-indexing-1">Role coupling and semantic indexing <a class="header-anchor" href="#role-coupling-and-semantic-indexing-1">§</a></h3>
<p>Room blueprint 1: I have two boxes, both accept only hats. I cast a spell such that the second box receives a hat that's twice larger than the one placed in the first.</p>
<p>Room blueprint 2: I have two boxes, both accept only hats. I cast a spell such that the second box receives a hat that's the complementary color relative to the one given on the first.</p>
<p>Room blueprint 3: I have two boxes, both accept only hats. I assign the first box the role of the first box in room 1, and the second of the second box in room 2.</p>
<p>I generate a room from the third blueprint.</p>
<p>I put a blue hat in the first box. Nothing happens!</p>
<p>I go back to the drawing board and realize that I forgot to connect the outcome of the spell from room 1 to the source to the spell from room 2.</p>
<p>I consider adding a third, intermediate box, that will contain the enlarged hat. However, I decide to instead cast a special spell that &quot;binds&quot; the roles of box 2 in room 1 and box 1 in room 2. This means that the room will also include a third, invisible box that would contain the enlarged hat, but I wouldn't be able to see it.</p>
<p>I try again. I generate a room from the third blueprint.</p>
<p>I put a blue hat in the first box. A twice-larger, red version of that hat appears in the second box.</p>
<p>I ask the room: <em>&quot;Can you please show me the content of the invisible box containing the enlarged hat&quot;</em>?</p>
<p>An enlarged, blue hat appears right in front of me, floating in the air.</p>
</section>
<section>
<h3 id="anonymous-context">Anonymous context <a class="header-anchor" href="#anonymous-context">§</a></h3>
<p>The room contains a special box, containing a room. The inner room is not based on a secondary blueprint, but is an integral component of the blueprint of the outer room itself.</p>
</section>
<section>
<h3 id="context-expansion-1">Context expansion <a class="header-anchor" href="#context-expansion-1">§</a></h3>
<p>I'm relying on a room blueprint that was provided to me by an external source.</p>
<p>Instead of directly modifying the original blueprint (which I can't), I can add a bunch of additional boxes and spells that would only effect my own experience of it.</p>
</section>
<section>
<h3 id="invalid-context-instantiation">Invalid context instantiation <a class="header-anchor" href="#invalid-context-instantiation">§</a></h3>
<p>I have two boxes in the room blueprint, which are set to only contain pens.</p>
<p>I cast a spell such that if the first has a pen of some color, the other will receive a pen of the same color.</p>
<p>I create a new room from the blueprint and put pens in <em>both</em> boxes. One blue, but the other red.</p>
<p>The room explodes.</p>
</section>
<section>
<h3 id="contradictory-mapping-rules">Contradictory mapping rules <a class="header-anchor" href="#contradictory-mapping-rules">§</a></h3>
<p>I have two boxes in the room blueprint, which are set to only contain pens.</p>
<p>I cast a spell such that if the first box has a red pen, the second will receive a blue pen.</p>
<p>Now I cast second spell that if the second box has a blue pen, the first will receive a green pen.</p>
<p>I can't use this blueprint, since it is invalid.</p>
</section>
</section>
</section>
<section>
<h1 id="misc.-topics">Misc. topics <a class="header-anchor" href="#misc.-topics">§</a></h1>
<section>
<h2 id="lists-and-streams-as-array-index-specifiers">Lists and streams as array index specifiers <a class="header-anchor" href="#lists-and-streams-as-array-index-specifiers">§</a></h2>
<p>A list can be sliced using secondary list to specify an ordered subset of indices to be read from a list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> indexes </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums[indexes] </span><span style="color: #A1A1A1">// result = [50, 30, 70]</span></span>
<span class="line"></span></code></pre>
<p>More generally, the same effect can be achieved using any stream of integers:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> indexStream </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> result </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums[indexStream] </span><span style="color: #A1A1A1">// result = [90, 60, 30]</span></span>
<span class="line"></span></code></pre>
<p>And for modifying an existing list:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> nums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">10</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">20</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">30</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">40</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">50</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">60</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">70</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">80</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">90</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> indexStream </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">9</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> i </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; i</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B">ifiedNums </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> nums </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> [indexStream] </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">900</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">600</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">300</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #A1A1A1">// modifiedNums = [10, 20, 300, 40, 50, 600, 70, 80, 900]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> indicesToRemove </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">7</span><span style="color: #5B5B5B">]</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B">ifiedNums2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B">ifiedNums </span><span style="color: #0059E8">with</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">no</span><span style="color: #5B5B5B"> [indicesToRemove]</span></span>
<span class="line"><span style="color: #A1A1A1">// modifiedNums2 = [10, 20, 300, 600, 80, 900]</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="recursion-sugar-and-the-param-modifier">Recursion sugar and the <code>param</code> modifier <a class="header-anchor" href="#recursion-sugar-and-the-param-modifier">§</a></h2>
<p>So far, we've tried to design convenient loops and comprehensions that abstract over recursive iteration patterns. We can also take some of those ideas back on the other direction - to make plain recursions simpler and more convenient to use.</p>
<p>The <code>recurse</code> keyword acts a lot like <code>continue</code> by allowing to only state the alterations needed for a recursive call, relative to the method's received argument set. In this example the return value is a named tuple, who's members double as parameters by being declared with the <code>param</code> keyword:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B43AFF">(</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> count: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">param r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #5B5B5B">, param r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">return</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">recurse</span><span style="color: #5B5B5B"> count </span><span style="color: #000000">-=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, r1 </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">a</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, r2 </span><span style="color: #000000">|=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">b</span><span style="color: #5B5B5B">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">4</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// r1 = &quot;aaaa&quot;, r2 = &quot;bbbb&quot;</span></span>
<span class="line"></span></code></pre>
<p><em>(Technical note: for convenience <code>return</code> can be used both as a statement and expression in a <code>case</code> and <code>when</code> clause body)</em></p>
<p>Note that by modifying the returned tuple members with the <code>param</code> keyword, they act like any other parameter and can be passed arguments when the method is called:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">r1, r2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> repeatAandB</span><span style="color: #B43AFF">(</span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, r1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello </span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, r2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">World </span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #A1A1A1">// r1 = &quot;Hello aaaa&quot;, r2 = &quot;World bbbb&quot;</span></span>
<span class="line"></span></code></pre>
<p>With these features, combined with named return variables, we can further simplify the recursive binary search code from a previous chapter:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> binarySearch</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">values: List&lt;</span><span style="color: #0059E8">integer</span><span style="color: #5B5B5B">&gt;, target: </span><span style="color: #0059E8">integer</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">function</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> values.length</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">: </span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">mid </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">div</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B">?</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">if</span><span style="color: #5B5B5B"> low &gt; high</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">nothing</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">else</span></span>
<span class="line"><span style="color: #5B5B5B">			</span><span style="color: #0059E8">match</span><span style="color: #5B5B5B"> values[mid]</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> target </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">return</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">case</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> &lt; target </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">recurse</span><span style="color: #5B5B5B"> low </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">+</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"><span style="color: #5B5B5B">				</span><span style="color: #0059E8">otherwise</span><span style="color: #5B5B5B"> </span><span style="color: #000000">=</span><span style="color: #5B5B5B">&gt; </span><span style="color: #0059E8">recurse</span><span style="color: #5B5B5B"> high </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> mid </span><span style="color: #000000">-</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> iterate</span><span style="color: #B43AFF">()</span></span>
<span class="line"></span></code></pre>
</section>
<section>
<h2 id="deep-comparison">Deep comparison <a class="header-anchor" href="#deep-comparison">§</a></h2>
<p>Comparisons are always done by value and traverse deep structural hierarchies:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> t1 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> t2 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> t3 </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> </span><span style="color: #B43AFF">(</span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">, </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hi</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, [</span><span style="color: #E65C00">5</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">4</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">3</span><span style="color: #5B5B5B">, </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">]</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">t1 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> t2</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints true</span></span>
<span class="line"><span style="color: #5B5B5B">print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">t2 </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> t3</span><span style="color: #B43AFF">)</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// prints false</span></span>
<span class="line"></span></code></pre>
</section>
</section>
<section>
<h1 id="design-decisions-still-under-consideration">Design decisions still under consideration <a class="header-anchor" href="#design-decisions-still-under-consideration">§</a></h1>
<section>
<h2 id="syntax-i-would-like-to-improve">Syntax I would like to improve <a class="header-anchor" href="#syntax-i-would-like-to-improve">§</a></h2>
<p><strong>Some syntax I find potentially confusing but haven't, to date, found better alternatives for:</strong></p>
<hr>
<p>Using the <code>stream</code> keyword only for pure generators. Based on this logic, a &quot;stream&quot; of data read from a file isn't eligible to be called a &quot;stream&quot;?</p>
<hr>
<p>Using the <code>delegate</code> keyword for worker methods. Is this the best option? Maybe every <code>action</code> could be modified to become a <code>delegate</code> instead? (or maybe <code>action delegate</code>??)</p>
<hr>
<p><code>delegate</code> <code>out</code> and <code>in</code> channels currently use the <code>&lt;-</code> operator. Is it really necessary? Not having it would probably look cleaner.</p>
<hr>
<p>Should <code>enumeration</code> be shortened to <code>enum</code>?</p>
<hr>
<p>In Python, a statement block head usually ends with a <code>:</code> to signify the upcoming content block. I've decided I'm not doing that in Island (same for not having <code>then</code> after <code>if</code>). This brings some situations that are not trivially intuitive to read.</p>
<p>On issue is with multi-line block opening statements (e.g. <code>for ....</code>, <code>if ....</code>) may become difficult to visually differentiate from block content:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">if</span><span style="color: #5B5B5B">  something1 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something2 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something3 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something4 </span><span style="color: #000000">and</span></span>
<span class="line"><span style="color: #5B5B5B">    something5 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something6 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something7 </span><span style="color: #000000">and</span><span style="color: #5B5B5B"> something8</span></span>
<span class="line"><span style="color: #5B5B5B">	doSomething</span><span style="color: #B43AFF">()</span><span style="color: #5B5B5B"> </span><span style="color: #A1A1A1">// It&#39;s not visually clear this statement is within the body of the conditional.</span></span>
<span class="line"></span></code></pre>
<p>In knowledge-driven programming context syntax, when mapping rules are written as blocks, the syntax becomes too sparse:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">context</span><span style="color: #5B5B5B"> Example</span></span>
<span class="line"><span style="color: #5B5B5B">	val: </span><span style="color: #0059E8">integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	val</span></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">for</span><span style="color: #5B5B5B"> i </span><span style="color: #0059E8">in</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">1</span><span style="color: #5B5B5B">..</span><span style="color: #E65C00">10</span></span>
<span class="line"><span style="color: #5B5B5B">			....</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">		</span><span style="color: #0059E8">return</span><span style="color: #5B5B5B"> something</span></span>
<span class="line"></span></code></pre>
<p>Overload block syntax also feels a bit too sparse to me, especially when the overload bodies are written as statement blocks:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">action</span><span style="color: #5B5B5B"> doSomething</span></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">true</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age </span><span style="color: #000000">&gt;=</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">animal</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, isMammal: </span><span style="color: #0059E8">false</span><span style="color: #5B5B5B">, owner: Person </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> age &lt; </span><span style="color: #E65C00">18</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello young animal lover!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5B5B5B">	</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">category: </span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">person</span><span style="color: #5B5B5B">&quot;</span><span style="color: #5B5B5B">, id: </span><span style="color: #000000">/</span><span style="color: #5B5B5B">[a..zA..Z]</span><span style="color: #000000">+/</span><span style="color: #B43AFF">)</span></span>
<span class="line"><span style="color: #5B5B5B">		print</span><span style="color: #B43AFF">(</span><span style="color: #5B5B5B">&quot;</span><span style="color: #AA6631">Hello random person!</span><span style="color: #5B5B5B">&quot;</span><span style="color: #B43AFF">)</span></span>
<span class="line"></span></code></pre>
<hr>
<p>The <code>it</code> keyword doesn't feel like the best possible fit for the query comprehension syntax:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbersDoubled </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [numbers </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">select</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">it</span><span style="color: #5B5B5B"> </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>Seems like <code>it</code> should represent <code>numbers</code> itself not an element of it.</p>
<p>Using <code>item</code> looks nicer:</p>
<pre class="shiki" style="background-color: #FCFCFC"><code><span class="line"><span style="color: #0059E8">let</span><span style="color: #5B5B5B"> evenNumbersDoubled </span><span style="color: #000000">=</span><span style="color: #5B5B5B"> [numbers </span><span style="color: #0059E8">where</span><span style="color: #5B5B5B"> item </span><span style="color: #000000">mod</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B"> </span><span style="color: #000000">==</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">0</span><span style="color: #5B5B5B"> </span><span style="color: #0059E8">select</span><span style="color: #5B5B5B"> item </span><span style="color: #000000">*</span><span style="color: #5B5B5B"> </span><span style="color: #E65C00">2</span><span style="color: #5B5B5B">]</span></span>
<span class="line"></span></code></pre>
<p>but I'm not sure if I want to make it a reserved keyword.</p>
</section>
<section>
<h2 id="built-in-types">Built-in types <a class="header-anchor" href="#built-in-types">§</a></h2>
<ul>
<li>Should <code>integer</code> be infinite or finite precision? How about having <code>integer&lt;64&gt;</code>, <code>integer&lt;32&gt;</code> etc.?</li>
<li>Should <code>decimal</code> be infinite or finite precision?</li>
<li>Should <code>string</code> be renamed to <code>text</code>? (since <code>string</code> is not a completely descriptive name).</li>
<li>Should constant-length arrays be natively supported?</li>
</ul>
</section>
</section>
<section>
<h1 id="todo">TODO <a class="header-anchor" href="#todo">§</a></h1>
<section>
<h2 id="namespaces">Namespaces <a class="header-anchor" href="#namespaces">§</a></h2>
</section>
<section>
<h2 id="modules">Modules <a class="header-anchor" href="#modules">§</a></h2>
</section>
<section>
<h2 id="attributes">Attributes <a class="header-anchor" href="#attributes">§</a></h2>
</section>
<section>
<h2 id="infix-operators">Infix operators <a class="header-anchor" href="#infix-operators">§</a></h2>
</section>
<section>
<h2 id="metaprogramming-and-reflection">Metaprogramming and reflection <a class="header-anchor" href="#metaprogramming-and-reflection">§</a></h2>
</section>
<section>
<h2 id="symbolic-data-structures">Symbolic data structures <a class="header-anchor" href="#symbolic-data-structures">§</a></h2>
</section>
<section>
<h2 id="memoization">Memoization <a class="header-anchor" href="#memoization">§</a></h2>
</section>
<section>
<h2 id="compile-time-execution">Compile-time execution <a class="header-anchor" href="#compile-time-execution">§</a></h2>
</section>
</section>
<section>
<h1 id="closing-chapter">Closing chapter <a class="header-anchor" href="#closing-chapter">§</a></h1>
<section>
<h2 id="influences">Influences <a class="header-anchor" href="#influences">§</a></h2>
<p>This work would not have been possible without ideas inspired by or built-upon the collective design effort invested towards many contemporary and past languages. In particular:</p>
<ul>
<li><strong>TypeScript</strong>: class member syntax, anonymous method syntax, type annotation syntax, generics syntax, type alias syntax, method type syntax, optional type syntax, <code>this</code> type semantics, join (intersection) types, <code>any</code> type, <code>never</code> type, type cast and assertion syntax.</li>
<li><strong>C#</strong>: expansions (called &quot;extension everything&quot; by the C# designers), some query syntax (LINQ), computed fields (properties), <code>in</code> and <code>out</code> type modifiers, disambiguation of conflicting inherited members by type prefixing.</li>
<li><strong>JavaScript</strong>: array syntax, destructuring and rest parameter syntax, <code>arguments</code> keyword.</li>
<li><strong>Python</strong>: indent-based blocks, generators and comprehensions.</li>
<li><strong>Haskell</strong>: type features (type classes), variant types (tagged unions).</li>
<li><strong>Scala</strong>: companion objects.</li>
<li><strong>Kotlin</strong>: <code>it</code> keyword.</li>
<li><strong>Oz</strong>, <strong>Go</strong>: concurrency, messaging.</li>
<li><strong>Pascal</strong>: <code>div</code> and <code>mod</code> keywords.</li>
<li><strong>Prolog</strong>, <strong>Datalog</strong>, <strong>Oz</strong>: (functional-) logic programming.</li>
</ul>
</section>
<section>
<h2 id="feedback-for-this-document">Feedback for this document <a class="header-anchor" href="#feedback-for-this-document">§</a></h2>
<p>The repository is located at <a href="https://github.com/island-lang/island-lang.github.io">github.com/island-lang/island-lang.github.io</a></p>
<p>Feel free to ask questions, report errors or make constructive suggestions.</p>
</section>
<section>
<h2 id="who-wrote-this%3F">Who wrote this? <a class="header-anchor" href="#who-wrote-this%3F">§</a></h2>
<p>Hi, my name is Rotem Dan (IPA: ˈʁɒːtem ˈdän). I'm a software developer who loves designing programming languages!</p>
<p>You can contact me via email at <span id="email-address-1"><span id="email-address-2"><span id="email-address-3">.</p>
</section>
<section>
<h2 id="copyrights">Copyrights <a class="header-anchor" href="#copyrights">§</a></h2>
<p>Copyright © Rotem Dan<br />
2017 - 2021</p>
</section>
</section>

</main>

<footer>
	<p id="last-modified">
		<i>Last edited: December 9, 2021</i>
	</p>
</footer>
</body>
</html>
